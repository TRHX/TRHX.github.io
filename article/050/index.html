<!-- 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
-->

<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Force https -->

    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">


<!-- Title -->
<title>网洛者反爬练习平台第七题：JSVMPZL 初体验 - BOB&#39;S BLOG</title>

<!-- Icon -->
<link rel="icon" href="/img/favicon.ico">

<!-- Fonts -->
<link rel="preload" href="//fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" as="style" onload="this.onload=null, this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="//fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>

<!-- Font Awesome -->
<!-- https://fontawesome.dashgame.com/ -->
<!-- <link rel="stylesheet" href="https://cdn.itbob.cn/css/font-awesome@5.6.3/all.min.css"> -->
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/5.15.4/css/all.min.css">
<!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css"> -->


    <!-- KaTeX -->
    <!-- //cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css -->
    <link rel="preload" href="//cdn.itbob.cn/css/katex@0.12.0/katex.min.css" as="style" onload="this.onload=null, this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="//cdn.itbob.cn/css/katex@0.12.0/katex.min.css"></noscript>


<!-- Style -->

<link rel="stylesheet" href="/styles/main.css">

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-pure@1.0.1/dist/main.css"> -->

<!-- Analytics -->

    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement('script');
                hm.src = 'https://hm.baidu.com/hm.js?6ca34ddce088f8434f3c7509576819f2';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


<!-- Busuanzi -->
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script async src="//cdn.itbob.cn/js/busuanzi@2.3/busuanzi.pure.mini.js"></script>

<!-- Typeit -->
<!-- https://www.typeitjs.com/ -->
<script src="//unpkg.com/typeit@8.7.0/dist/index.umd.js"></script>

<!-- Fancybox -->

    <link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css">
    <script src="//cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"> </script>
    <script src="//cdn.itbob.cn/js/fancybox@3.5.7/fancybox.js"> </script>

<!-- <script>
  $('[data-fancybox="images"]').fancybox({//可选
    thumbs : {
      autoStart : true //缩略图
    }
  });
  $('[data-fancybox]').fancybox({//启用函数，必须
    protect: true //图片右键不能下载，可选
  });
</script> -->

<!-- Console -->
<script>
    function makeMulti (string) {
        let l = new String(string)
        l = l.substring(l.indexOf("/*") + 3, l.lastIndexOf("*/"))
        return l
    }
    let string = function () {
      /* 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
      */
    }
    console.log(makeMulti(string));
    console.log("\n %c © ITBOB'S BLOG %c https://www.itbob.cn %c © ITRHX'S BLOG %c https://www.itrhx.com \n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;")
</script>

    <meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BOB'S BLOG" type="application/atom+xml">
</head>
    <body>
        <div class="main gt-bg-theme-color-first">
            <div class="main-content">
                <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/img/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first" id="typeitspan">
            <!-- BOB&#39;S BLOG -->
        </div>
    </a>
    <!-- <span id="typeitspan"></span> -->
    <script>
        new TypeIt('#typeitspan', {
        strings: "BOB'S BLOG",
        speed: 150, 
        afterComplete: function (instance) {
            instance.destroy();
        }
        }).go();
    </script>
    <button aria-label="Navbar Toggler" class="navbar-toggler" type="button" id="changeNavbar">
        <i class="gt-c-content-color-first" style="font-size: 18px;">
            <svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 448 512" height="18px" fill="currentColor">
                <path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z" />
            </svg>
        </i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center; ">
            
                
                    <div class="nav-item">
                        <a href="/" class="menu gt-a-link" target="_self">首页</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/archives/" class="menu gt-a-link" target="_self">归档</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/tags/" class="menu gt-a-link" target="_self">标签</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/friends/" class="menu gt-a-link" target="_self">友链</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/about/" class="menu gt-a-link" target="_self">关于</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="https://www.travellings.cn/go.html" target="_blank">
                            <img src="https://cdn.itbob.cn/img/travelling.gif" class="nofancybox" alt="开往-友链接力" width="auto" height="25px">
                        </a>
                    </div>
                
            
        </div>
    </div>
</nav>

<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function() {
        let element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else { 
            element.style.display = 'none';
        }
    }
</script>

                <div class="post-container">
    <div class="post-detail gt-bg-theme-color-second gt-c-content-color-first">
        <article class="gt-post-content">
            <h1 class="post-title">网洛者反爬练习平台第七题：JSVMPZL 初体验</h1>
            <div class="post-info">
                <time class="post-time gt-c-content-color-first">
                    <i class="fa fa-calendar-alt"></i> 首发于: 2022-04-06丨
                </time>
                <span id="busuanzi_container_page_pv">
                    <i class="fas fa-eye"></i> 阅读量: <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>丨
                </span>
                
                    <span class="post-count">
                        <i class="fa fa-keyboard"></i> 字数统计: 4.5k丨
                    </span>
                    <span class="post-count">
                        <i class="fa fa-hourglass-half"></i> 阅读时长: 23分丨
                    </span>
                
                
                    
                        <!-- <i class="fa fa-tag"></i> -->
                        <i class="fas fa-hashtag"></i>
                        <a href="/tags/%E7%88%AC%E8%99%AB/" class="post-tag">
                            爬虫</a>
                    
                        <!-- <i class="fa fa-tag"></i> -->
                        <i class="fas fa-hashtag"></i>
                        <a href="/tags/JS-%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98/" class="post-tag">
                            JS 逆向实战</a>
                    
                
            </div>
            <hr>
            <div class="post-content gt-c-content-color-first">
                <p><img src="https://cdn.itbob.cn/img/cover/javascript_reverse.png" alt="javascript_reverse"></p>
<p><strong><center><font color="red" size="5px" weight="bolder">欢迎加入爬虫逆向微信交流群：添加微信 IT-BOB（备注交流群）</font></center></strong></p>
<h2><span id="wen-zhang-mu-lu">文章目录</span></h2>
<hr>
<!-- toc -->
<ul>
<li><a href="#sheng-ming">声明</a></li>
<li><a href="#ni-xiang-mu-biao">逆向目标</a></li>
<li><a href="#ni-xiang-guo-cheng">逆向过程</a>
<ul>
<li><a href="#hook-guan-jian-fang-fa">Hook 关键方法</a></li>
<li><a href="#ri-zhi-duan-dian-cha-zhuang-diao-shi">日志断点 / 插桩调试</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<hr>
<h2><span id="sheng-ming">声明</span></h2>
<p><strong><font color="red">本文章中所有内容仅供学习交流使用，不用于其他任何目的，不提供完整代码，抓包内容、敏感网址、数据接口等均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关！</font></strong></p>
<p><strong><font color="red">本文章未经许可禁止转载，禁止任何修改后二次传播，擅自使用本文讲解的技术而导致的任何意外，作者均不负责，若有侵权，请通过邮件 <a href="mailto:admin@itbob.cn">admin@itbob.cn</a> 联系我立即删除！</font></strong></p>
<h2><span id="ni-xiang-mu-biao">逆向目标</span></h2>
<ul>
<li>目标：网洛者反反爬虫练习平台第七题：JSVMPZL 初体验</li>
<li>链接：<a target="_blank" rel="noopener" href="http://spider.wangluozhe.com/challenge/7">http://spider.wangluozhe.com/challenge/7</a></li>
<li>简介：平台注册需要邀请码，站长在群里，可后台回复交流群加群获取，或者直接加网站底部站长QQ获取。要求采集100页的全部数字，并计算所有数据加和。主要难点在于 vvv 大佬开发的 JS 混淆框架：jsvmpzl</li>
</ul>
<p><img src="https://cdn.itbob.cn/img/article/050/01.png" alt="01"></p>
<h2><span id="ni-xiang-guo-cheng">逆向过程</span></h2>
<p>直接搜索，或者跟栈，可以轻松找到加密入口，打开 F12 有两个反调试，一是无限 debugger，右键 Never pause here 即可，二是定时器，控制台输入 <code>for (let i = 1; i &lt; 99999; i++) window.clearInterval(i);</code> 过掉即可。</p>
<p><img src="https://cdn.itbob.cn/img/article/050/02.png" alt="02"></p>
<p>跟进 <code>y__()</code>，就可以看到 jsvmpzl 混淆的代码了，如果有做过猿人学平台的题，会发现此混淆和猿人学第 18 题（ <a target="_blank" rel="noopener" href="https://match.yuanrenxue.com/match/18">https://match.yuanrenxue.com/match/18</a> ）是一样的，在 <code>y__()</code> 第一行下个断点，观察 <code>__v_()</code> 第一个参数 <code>_</code>，<code>_[2][0]</code> 你会发现有关 MD5 算法的一些特征，如下图所示：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/03.png" alt="03"></p>
<p>那么我们直接大胆猜测一下，是不是就是某个数据经过 MD5 之后就是 <code>_signature</code> 了呢？再继续调试一下，注意 <code>arguments</code> 的变化：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/04.png" alt="04"></p>
<p>很明显这个 <code>window.byted_acrawler(window.sign())</code> 应该就是生成 <code>_signature</code> 的语句，这个方法和某字节系的 <code>_signature</code> 生成的方法名称是一样的，直接在控制台输出一下可以拿到值，其中 <code>window.sign()</code> 是取的时间戳：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/05.png" alt="05"></p>
<p>我们前面猜测是 MD5，直接验证一下，发现并不是的，即便是同一个时间戳，经过 <code>window.byted_acrawler()</code> 后得到的值每次也都不一样：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/06.png" alt="06"></p>
<h3><span id="hook-guan-jian-fang-fa">Hook 关键方法</span></h3>
<p>经过前面的分析，既然标准的 MD5 不行，那有没有可能是魔改的 MD5 呢？首先找个 JavaScript 标准的 MD5 代码看一下，比如：<a target="_blank" rel="noopener" href="http://pajhome.org.uk/crypt/md5/md5.html">http://pajhome.org.uk/crypt/md5/md5.html</a></p>
<p><img src="https://cdn.itbob.cn/img/article/050/07.png" alt="07"></p>
<p>可以注意到，源码里面有很多 <code>md5_ff</code>、<code>md5_gg</code>、<code>md5_hh</code>、<code>md5_ii</code> 的方法，最后一个值都是固定的，那么有没有可能此题就是在标准 MD5 的基础上修改了一些默认值呢？所以我们可以直接 Hook 这些关键方法，在控制台输出传入的值，来一一对比一下，看看默认值是否是一样的，为了方便观察，我们还可以为输出语句加上颜色，Hook 代码如下：</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">let</span> oldFF = _[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_ff&#x27;</span>];
<span class="hljs-keyword">let</span> oldGG = _[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_gg&#x27;</span>];
<span class="hljs-keyword">let</span> oldHH = _[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_hh&#x27;</span>];
<span class="hljs-keyword">let</span> oldII = _[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_ii&#x27;</span>];

<span class="hljs-keyword">let</span> color_white_red = <span class="hljs-string">&quot;color: white; background: red;&quot;</span>
<span class="hljs-keyword">let</span> color_white_grey = <span class="hljs-string">&quot;color: white; background: grey;&quot;</span>
<span class="hljs-keyword">let</span> color_white_darkcyan = <span class="hljs-string">&quot;color: white; background: darkcyan;&quot;</span>
<span class="hljs-keyword">let</span> color_white_green = <span class="hljs-string">&quot;color: white; background: green;&quot;</span>
<span class="hljs-keyword">let</span> color_white_orange = <span class="hljs-string">&quot;color: white; background: orange;&quot;</span>

_[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_ff&#x27;</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c, d, e, f, g</span>) </span>&#123;
    <span class="hljs-keyword">debugger</span>;
    <span class="hljs-keyword">let</span> result = oldFF(a, b, c, d, e, f, g);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;%c Function: %c md5_ff %c Result: %c %s %c Params: %c %s, %s, %s, %s, %s, %s, %s &quot;</span>, color_white_red, color_white_grey, color_white_red, color_white_grey, result, color_white_red, color_white_grey, a, b, c, d, e, f, g)
    <span class="hljs-keyword">return</span> result;
&#125;;

_[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_gg&#x27;</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c, d, e, f, g</span>) </span>&#123;
    <span class="hljs-keyword">debugger</span>;
    <span class="hljs-keyword">let</span> result = oldGG(a, b, c, d, e, f, g);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;%c Function: %c md5_gg %c Result: %c %s %c Params: %c %s, %s, %s, %s, %s, %s, %s &quot;</span>, color_white_red, color_white_darkcyan, color_white_red, color_white_darkcyan, result, color_white_red, color_white_darkcyan, a, b, c, d, e, f, g)
    <span class="hljs-keyword">return</span> result;
&#125;;

_[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_hh&#x27;</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c, d, e, f, g</span>) </span>&#123;
    <span class="hljs-keyword">debugger</span>;
    <span class="hljs-keyword">let</span> result = oldHH(a, b, c, d, e, f, g);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;%c Function: %c md5_hh %c Result: %c %s %c Params: %c %s, %s, %s, %s, %s, %s, %s &quot;</span>, color_white_red, color_white_green, color_white_red, color_white_green, result, color_white_red, color_white_green, a, b, c, d, e, f, g)
    <span class="hljs-keyword">return</span> result;
&#125;;

_[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;md5_ii&#x27;</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c, d, e, f, g</span>) </span>&#123;
    <span class="hljs-keyword">debugger</span>;
    <span class="hljs-keyword">let</span> result = oldII(a, b, c, d, e, f, g);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;%c Function: %c md5_ii %c Result: %c %s %c Params: %c %s, %s, %s, %s, %s, %s, %s &quot;</span>, color_white_red, color_white_orange, color_white_red, color_white_orange, result, color_white_red, color_white_orange, a, b, c, d, e, f, g)
    <span class="hljs-keyword">return</span> result;
&#125;;</code></pre>
<p>Hook 代码写得比较死板，熟悉 JS 的大佬可自己优化一下，注意注入代码的时机，清除定时器后，断点运行到 <code>y__()</code> 方法后再注入，然后取消断点，一直下一步，就可以在控制台看到输出的参数了，如下图所示：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/08.png" alt="08"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/09.png" alt="09"></p>
<p>与默认参数进行对比，可以发现 <code>md5_hh()</code> 里有两个默认参数被修改了：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/10.png" alt="10"></p>
<p>默认的 <code>-722521979</code> 改成了 <code>-722521939</code>、<code>76029189</code> 改成了 <code>76029185</code>，本地代码修改一下即可：</p>
<pre><code class="hljs javascript"><span class="hljs-comment">/* ==================================</span>
<span class="hljs-comment"># @Time    : 2021-12-23</span>
<span class="hljs-comment"># @Author  : ITBOB.CN</span>
<span class="hljs-comment"># @FileName: challenge_7.js</span>
<span class="hljs-comment"># @Software: PyCharm</span>
<span class="hljs-comment"># ================================== */</span>


<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message</span>
<span class="hljs-comment"> * Digest Algorithm, as defined in RFC 1321.</span>
<span class="hljs-comment"> * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009</span>
<span class="hljs-comment"> * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet</span>
<span class="hljs-comment"> * Distributed under the BSD License</span>
<span class="hljs-comment"> * See http://pajhome.org.uk/crypt/md5 for more info.</span>
<span class="hljs-comment"> */</span>

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Configurable variables. You may need to tweak these to be compatible with</span>
<span class="hljs-comment"> * the server-side, but the defaults work in most cases.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">var</span> hexcase = <span class="hljs-number">0</span>;   <span class="hljs-comment">/* hex output format. 0 - lowercase; 1 - uppercase        */</span>
<span class="hljs-keyword">var</span> b64pad  = <span class="hljs-string">&quot;&quot;</span>;  <span class="hljs-comment">/* base-64 pad character. &quot;=&quot; for strict RFC compliance   */</span>

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * These are the functions you&#x27;ll usually want to call</span>
<span class="hljs-comment"> * They take string arguments and return either hex or base-64 encoded strings</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hex_md5</span>(<span class="hljs-params">s</span>)    </span>&#123; <span class="hljs-keyword">return</span> rstr2hex(rstr_md5(str2rstr_utf8(s))); &#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b64_md5</span>(<span class="hljs-params">s</span>)    </span>&#123; <span class="hljs-keyword">return</span> rstr2b64(rstr_md5(str2rstr_utf8(s))); &#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">any_md5</span>(<span class="hljs-params">s, e</span>) </span>&#123; <span class="hljs-keyword">return</span> rstr2any(rstr_md5(str2rstr_utf8(s)), e); &#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hex_hmac_md5</span>(<span class="hljs-params">k, d</span>)</span>
<span class="hljs-function">  </span>&#123; <span class="hljs-keyword">return</span> rstr2hex(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d))); &#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b64_hmac_md5</span>(<span class="hljs-params">k, d</span>)</span>
<span class="hljs-function">  </span>&#123; <span class="hljs-keyword">return</span> rstr2b64(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d))); &#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">any_hmac_md5</span>(<span class="hljs-params">k, d, e</span>)</span>
<span class="hljs-function">  </span>&#123; <span class="hljs-keyword">return</span> rstr2any(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d)), e); &#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Perform a simple self-test to see if the VM is working</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">md5_vm_test</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> hex_md5(<span class="hljs-string">&quot;abc&quot;</span>).toLowerCase() == <span class="hljs-string">&quot;900150983cd24fb0d6963f7d28e17f72&quot;</span>;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Calculate the MD5 of a raw string</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rstr_md5</span>(<span class="hljs-params">s</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> binl2rstr(binl_md5(rstr2binl(s), s.length * <span class="hljs-number">8</span>));
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Calculate the HMAC-MD5, of a key and some data (raw strings)</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rstr_hmac_md5</span>(<span class="hljs-params">key, data</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> bkey = rstr2binl(key);
  <span class="hljs-keyword">if</span>(bkey.length &gt; <span class="hljs-number">16</span>) bkey = binl_md5(bkey, key.length * <span class="hljs-number">8</span>);

  <span class="hljs-keyword">var</span> ipad = <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>), opad = <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>);
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)
  &#123;
    ipad[i] = bkey[i] ^ <span class="hljs-number">0x36363636</span>;
    opad[i] = bkey[i] ^ <span class="hljs-number">0x5C5C5C5C</span>;
  &#125;

  <span class="hljs-keyword">var</span> hash = binl_md5(ipad.concat(rstr2binl(data)), <span class="hljs-number">512</span> + data.length * <span class="hljs-number">8</span>);
  <span class="hljs-keyword">return</span> binl2rstr(binl_md5(opad.concat(hash), <span class="hljs-number">512</span> + <span class="hljs-number">128</span>));
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Convert a raw string to a hex string</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rstr2hex</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">try</span> &#123; hexcase &#125; <span class="hljs-keyword">catch</span>(e) &#123; hexcase=<span class="hljs-number">0</span>; &#125;
  <span class="hljs-keyword">var</span> hex_tab = hexcase ? <span class="hljs-string">&quot;0123456789ABCDEF&quot;</span> : <span class="hljs-string">&quot;0123456789abcdef&quot;</span>;
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">var</span> x;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; input.length; i++)
  &#123;
    x = input.charCodeAt(i);
    output += hex_tab.charAt((x &gt;&gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0x0F</span>)
           +  hex_tab.charAt( x        &amp; <span class="hljs-number">0x0F</span>);
  &#125;
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Convert a raw string to a base-64 string</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rstr2b64</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">try</span> &#123; b64pad &#125; <span class="hljs-keyword">catch</span>(e) &#123; b64pad=<span class="hljs-string">&#x27;&#x27;</span>; &#125;
  <span class="hljs-keyword">var</span> tab = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">var</span> len = input.length;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">3</span>)
  &#123;
    <span class="hljs-keyword">var</span> triplet = (input.charCodeAt(i) &lt;&lt; <span class="hljs-number">16</span>)
                | (i + <span class="hljs-number">1</span> &lt; len ? input.charCodeAt(i+<span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">8</span> : <span class="hljs-number">0</span>)
                | (i + <span class="hljs-number">2</span> &lt; len ? input.charCodeAt(i+<span class="hljs-number">2</span>)      : <span class="hljs-number">0</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)
    &#123;
      <span class="hljs-keyword">if</span>(i * <span class="hljs-number">8</span> + j * <span class="hljs-number">6</span> &gt; input.length * <span class="hljs-number">8</span>) output += b64pad;
      <span class="hljs-keyword">else</span> output += tab.charAt((triplet &gt;&gt;&gt; <span class="hljs-number">6</span>*(<span class="hljs-number">3</span>-j)) &amp; <span class="hljs-number">0x3F</span>);
    &#125;
  &#125;
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Convert a raw string to an arbitrary string encoding</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rstr2any</span>(<span class="hljs-params">input, encoding</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> divisor = encoding.length;
  <span class="hljs-keyword">var</span> i, j, q, x, quotient;

  <span class="hljs-comment">/* Convert to an array of 16-bit big-endian values, forming the dividend */</span>
  <span class="hljs-keyword">var</span> dividend = <span class="hljs-built_in">Array</span>(<span class="hljs-built_in">Math</span>.ceil(input.length / <span class="hljs-number">2</span>));
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; dividend.length; i++)
  &#123;
    dividend[i] = (input.charCodeAt(i * <span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-number">8</span>) | input.charCodeAt(i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>);
  &#125;

  <span class="hljs-comment">/*</span>
<span class="hljs-comment">   * Repeatedly perform a long division. The binary array forms the dividend,</span>
<span class="hljs-comment">   * the length of the encoding is the divisor. Once computed, the quotient</span>
<span class="hljs-comment">   * forms the dividend for the next step. All remainders are stored for later</span>
<span class="hljs-comment">   * use.</span>
<span class="hljs-comment">   */</span>
  <span class="hljs-keyword">var</span> full_length = <span class="hljs-built_in">Math</span>.ceil(input.length * <span class="hljs-number">8</span> /
                                    (<span class="hljs-built_in">Math</span>.log(encoding.length) / <span class="hljs-built_in">Math</span>.log(<span class="hljs-number">2</span>)));
  <span class="hljs-keyword">var</span> remainders = <span class="hljs-built_in">Array</span>(full_length);
  <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; full_length; j++)
  &#123;
    quotient = <span class="hljs-built_in">Array</span>();
    x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; dividend.length; i++)
    &#123;
      x = (x &lt;&lt; <span class="hljs-number">16</span>) + dividend[i];
      q = <span class="hljs-built_in">Math</span>.floor(x / divisor);
      x -= q * divisor;
      <span class="hljs-keyword">if</span>(quotient.length &gt; <span class="hljs-number">0</span> || q &gt; <span class="hljs-number">0</span>)
        quotient[quotient.length] = q;
    &#125;
    remainders[j] = x;
    dividend = quotient;
  &#125;

  <span class="hljs-comment">/* Convert the remainders to the output string */</span>
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">for</span>(i = remainders.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--)
    output += encoding.charAt(remainders[i]);

  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Encode a string as utf-8.</span>
<span class="hljs-comment"> * For efficiency, this assumes the input is valid utf-16.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2rstr_utf8</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">var</span> i = -<span class="hljs-number">1</span>;
  <span class="hljs-keyword">var</span> x, y;

  <span class="hljs-keyword">while</span>(++i &lt; input.length)
  &#123;
    <span class="hljs-comment">/* Decode utf-16 surrogate pairs */</span>
    x = input.charCodeAt(i);
    y = i + <span class="hljs-number">1</span> &lt; input.length ? input.charCodeAt(i + <span class="hljs-number">1</span>) : <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-number">0xD800</span> &lt;= x &amp;&amp; x &lt;= <span class="hljs-number">0xDBFF</span> &amp;&amp; <span class="hljs-number">0xDC00</span> &lt;= y &amp;&amp; y &lt;= <span class="hljs-number">0xDFFF</span>)
    &#123;
      x = <span class="hljs-number">0x10000</span> + ((x &amp; <span class="hljs-number">0x03FF</span>) &lt;&lt; <span class="hljs-number">10</span>) + (y &amp; <span class="hljs-number">0x03FF</span>);
      i++;
    &#125;

    <span class="hljs-comment">/* Encode output as utf-8 */</span>
    <span class="hljs-keyword">if</span>(x &lt;= <span class="hljs-number">0x7F</span>)
      output += <span class="hljs-built_in">String</span>.fromCharCode(x);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x &lt;= <span class="hljs-number">0x7FF</span>)
      output += <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0xC0</span> | ((x &gt;&gt;&gt; <span class="hljs-number">6</span> ) &amp; <span class="hljs-number">0x1F</span>),
                                    <span class="hljs-number">0x80</span> | ( x         &amp; <span class="hljs-number">0x3F</span>));
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x &lt;= <span class="hljs-number">0xFFFF</span>)
      output += <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0xE0</span> | ((x &gt;&gt;&gt; <span class="hljs-number">12</span>) &amp; <span class="hljs-number">0x0F</span>),
                                    <span class="hljs-number">0x80</span> | ((x &gt;&gt;&gt; <span class="hljs-number">6</span> ) &amp; <span class="hljs-number">0x3F</span>),
                                    <span class="hljs-number">0x80</span> | ( x         &amp; <span class="hljs-number">0x3F</span>));
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x &lt;= <span class="hljs-number">0x1FFFFF</span>)
      output += <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0xF0</span> | ((x &gt;&gt;&gt; <span class="hljs-number">18</span>) &amp; <span class="hljs-number">0x07</span>),
                                    <span class="hljs-number">0x80</span> | ((x &gt;&gt;&gt; <span class="hljs-number">12</span>) &amp; <span class="hljs-number">0x3F</span>),
                                    <span class="hljs-number">0x80</span> | ((x &gt;&gt;&gt; <span class="hljs-number">6</span> ) &amp; <span class="hljs-number">0x3F</span>),
                                    <span class="hljs-number">0x80</span> | ( x         &amp; <span class="hljs-number">0x3F</span>));
  &#125;
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Encode a string as utf-16</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2rstr_utf16le</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; input.length; i++)
    output += <span class="hljs-built_in">String</span>.fromCharCode( input.charCodeAt(i)        &amp; <span class="hljs-number">0xFF</span>,
                                  (input.charCodeAt(i) &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>);
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2rstr_utf16be</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; input.length; i++)
    output += <span class="hljs-built_in">String</span>.fromCharCode((input.charCodeAt(i) &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>,
                                   input.charCodeAt(i)        &amp; <span class="hljs-number">0xFF</span>);
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Convert a raw string to an array of little-endian words</span>
<span class="hljs-comment"> * Characters &gt;255 have their high-byte silently ignored.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rstr2binl</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> output = <span class="hljs-built_in">Array</span>(input.length &gt;&gt; <span class="hljs-number">2</span>);
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; output.length; i++)
    output[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; input.length * <span class="hljs-number">8</span>; i += <span class="hljs-number">8</span>)
    output[i&gt;&gt;<span class="hljs-number">5</span>] |= (input.charCodeAt(i / <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; (i%<span class="hljs-number">32</span>);
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Convert an array of little-endian words to a string</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binl2rstr</span>(<span class="hljs-params">input</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; input.length * <span class="hljs-number">32</span>; i += <span class="hljs-number">8</span>)
    output += <span class="hljs-built_in">String</span>.fromCharCode((input[i&gt;&gt;<span class="hljs-number">5</span>] &gt;&gt;&gt; (i % <span class="hljs-number">32</span>)) &amp; <span class="hljs-number">0xFF</span>);
  <span class="hljs-keyword">return</span> output;
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Calculate the MD5 of an array of little-endian words, and a bit length.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binl_md5</span>(<span class="hljs-params">x, len</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-comment">/* append padding */</span>
  x[len &gt;&gt; <span class="hljs-number">5</span>] |= <span class="hljs-number">0x80</span> &lt;&lt; ((len) % <span class="hljs-number">32</span>);
  x[(((len + <span class="hljs-number">64</span>) &gt;&gt;&gt; <span class="hljs-number">9</span>) &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-number">14</span>] = len;

  <span class="hljs-keyword">var</span> a =  <span class="hljs-number">1732584193</span>;
  <span class="hljs-keyword">var</span> b = -<span class="hljs-number">271733879</span>;
  <span class="hljs-keyword">var</span> c = -<span class="hljs-number">1732584194</span>;
  <span class="hljs-keyword">var</span> d =  <span class="hljs-number">271733878</span>;

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i += <span class="hljs-number">16</span>)
  &#123;
    <span class="hljs-keyword">var</span> olda = a;
    <span class="hljs-keyword">var</span> oldb = b;
    <span class="hljs-keyword">var</span> oldc = c;
    <span class="hljs-keyword">var</span> oldd = d;

    a = md5_ff(a, b, c, d, x[i+ <span class="hljs-number">0</span>], <span class="hljs-number">7</span> , -<span class="hljs-number">680876936</span>);
    d = md5_ff(d, a, b, c, x[i+ <span class="hljs-number">1</span>], <span class="hljs-number">12</span>, -<span class="hljs-number">389564586</span>);
    c = md5_ff(c, d, a, b, x[i+ <span class="hljs-number">2</span>], <span class="hljs-number">17</span>,  <span class="hljs-number">606105819</span>);
    b = md5_ff(b, c, d, a, x[i+ <span class="hljs-number">3</span>], <span class="hljs-number">22</span>, -<span class="hljs-number">1044525330</span>);
    a = md5_ff(a, b, c, d, x[i+ <span class="hljs-number">4</span>], <span class="hljs-number">7</span> , -<span class="hljs-number">176418897</span>);
    d = md5_ff(d, a, b, c, x[i+ <span class="hljs-number">5</span>], <span class="hljs-number">12</span>,  <span class="hljs-number">1200080426</span>);
    c = md5_ff(c, d, a, b, x[i+ <span class="hljs-number">6</span>], <span class="hljs-number">17</span>, -<span class="hljs-number">1473231341</span>);
    b = md5_ff(b, c, d, a, x[i+ <span class="hljs-number">7</span>], <span class="hljs-number">22</span>, -<span class="hljs-number">45705983</span>);
    a = md5_ff(a, b, c, d, x[i+ <span class="hljs-number">8</span>], <span class="hljs-number">7</span> ,  <span class="hljs-number">1770035416</span>);
    d = md5_ff(d, a, b, c, x[i+ <span class="hljs-number">9</span>], <span class="hljs-number">12</span>, -<span class="hljs-number">1958414417</span>);
    c = md5_ff(c, d, a, b, x[i+<span class="hljs-number">10</span>], <span class="hljs-number">17</span>, -<span class="hljs-number">42063</span>);
    b = md5_ff(b, c, d, a, x[i+<span class="hljs-number">11</span>], <span class="hljs-number">22</span>, -<span class="hljs-number">1990404162</span>);
    a = md5_ff(a, b, c, d, x[i+<span class="hljs-number">12</span>], <span class="hljs-number">7</span> ,  <span class="hljs-number">1804603682</span>);
    d = md5_ff(d, a, b, c, x[i+<span class="hljs-number">13</span>], <span class="hljs-number">12</span>, -<span class="hljs-number">40341101</span>);
    c = md5_ff(c, d, a, b, x[i+<span class="hljs-number">14</span>], <span class="hljs-number">17</span>, -<span class="hljs-number">1502002290</span>);
    b = md5_ff(b, c, d, a, x[i+<span class="hljs-number">15</span>], <span class="hljs-number">22</span>,  <span class="hljs-number">1236535329</span>);

    a = md5_gg(a, b, c, d, x[i+ <span class="hljs-number">1</span>], <span class="hljs-number">5</span> , -<span class="hljs-number">165796510</span>);
    d = md5_gg(d, a, b, c, x[i+ <span class="hljs-number">6</span>], <span class="hljs-number">9</span> , -<span class="hljs-number">1069501632</span>);
    c = md5_gg(c, d, a, b, x[i+<span class="hljs-number">11</span>], <span class="hljs-number">14</span>,  <span class="hljs-number">643717713</span>);
    b = md5_gg(b, c, d, a, x[i+ <span class="hljs-number">0</span>], <span class="hljs-number">20</span>, -<span class="hljs-number">373897302</span>);
    a = md5_gg(a, b, c, d, x[i+ <span class="hljs-number">5</span>], <span class="hljs-number">5</span> , -<span class="hljs-number">701558691</span>);
    d = md5_gg(d, a, b, c, x[i+<span class="hljs-number">10</span>], <span class="hljs-number">9</span> ,  <span class="hljs-number">38016083</span>);
    c = md5_gg(c, d, a, b, x[i+<span class="hljs-number">15</span>], <span class="hljs-number">14</span>, -<span class="hljs-number">660478335</span>);
    b = md5_gg(b, c, d, a, x[i+ <span class="hljs-number">4</span>], <span class="hljs-number">20</span>, -<span class="hljs-number">405537848</span>);
    a = md5_gg(a, b, c, d, x[i+ <span class="hljs-number">9</span>], <span class="hljs-number">5</span> ,  <span class="hljs-number">568446438</span>);
    d = md5_gg(d, a, b, c, x[i+<span class="hljs-number">14</span>], <span class="hljs-number">9</span> , -<span class="hljs-number">1019803690</span>);
    c = md5_gg(c, d, a, b, x[i+ <span class="hljs-number">3</span>], <span class="hljs-number">14</span>, -<span class="hljs-number">187363961</span>);
    b = md5_gg(b, c, d, a, x[i+ <span class="hljs-number">8</span>], <span class="hljs-number">20</span>,  <span class="hljs-number">1163531501</span>);
    a = md5_gg(a, b, c, d, x[i+<span class="hljs-number">13</span>], <span class="hljs-number">5</span> , -<span class="hljs-number">1444681467</span>);
    d = md5_gg(d, a, b, c, x[i+ <span class="hljs-number">2</span>], <span class="hljs-number">9</span> , -<span class="hljs-number">51403784</span>);
    c = md5_gg(c, d, a, b, x[i+ <span class="hljs-number">7</span>], <span class="hljs-number">14</span>,  <span class="hljs-number">1735328473</span>);
    b = md5_gg(b, c, d, a, x[i+<span class="hljs-number">12</span>], <span class="hljs-number">20</span>, -<span class="hljs-number">1926607734</span>);

    a = md5_hh(a, b, c, d, x[i+ <span class="hljs-number">5</span>], <span class="hljs-number">4</span> , -<span class="hljs-number">378558</span>);
    d = md5_hh(d, a, b, c, x[i+ <span class="hljs-number">8</span>], <span class="hljs-number">11</span>, -<span class="hljs-number">2022574463</span>);
    c = md5_hh(c, d, a, b, x[i+<span class="hljs-number">11</span>], <span class="hljs-number">16</span>,  <span class="hljs-number">1839030562</span>);
    b = md5_hh(b, c, d, a, x[i+<span class="hljs-number">14</span>], <span class="hljs-number">23</span>, -<span class="hljs-number">35309556</span>);
    a = md5_hh(a, b, c, d, x[i+ <span class="hljs-number">1</span>], <span class="hljs-number">4</span> , -<span class="hljs-number">1530992060</span>);
    d = md5_hh(d, a, b, c, x[i+ <span class="hljs-number">4</span>], <span class="hljs-number">11</span>,  <span class="hljs-number">1272893353</span>);
    c = md5_hh(c, d, a, b, x[i+ <span class="hljs-number">7</span>], <span class="hljs-number">16</span>, -<span class="hljs-number">155497632</span>);
    b = md5_hh(b, c, d, a, x[i+<span class="hljs-number">10</span>], <span class="hljs-number">23</span>, -<span class="hljs-number">1094730640</span>);
    a = md5_hh(a, b, c, d, x[i+<span class="hljs-number">13</span>], <span class="hljs-number">4</span> ,  <span class="hljs-number">681279174</span>);
    d = md5_hh(d, a, b, c, x[i+ <span class="hljs-number">0</span>], <span class="hljs-number">11</span>, -<span class="hljs-number">358537222</span>);
    <span class="hljs-comment">// 注释掉的是默认值</span>
    <span class="hljs-comment">// c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);</span>
    c = md5_hh(c, d, a, b, x[i+ <span class="hljs-number">3</span>], <span class="hljs-number">16</span>, -<span class="hljs-number">722521939</span>);
    <span class="hljs-comment">// b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);</span>
    b = md5_hh(b, c, d, a, x[i+ <span class="hljs-number">6</span>], <span class="hljs-number">23</span>,  <span class="hljs-number">76029185</span>);
    a = md5_hh(a, b, c, d, x[i+ <span class="hljs-number">9</span>], <span class="hljs-number">4</span> , -<span class="hljs-number">640364487</span>);
    d = md5_hh(d, a, b, c, x[i+<span class="hljs-number">12</span>], <span class="hljs-number">11</span>, -<span class="hljs-number">421815835</span>);
    c = md5_hh(c, d, a, b, x[i+<span class="hljs-number">15</span>], <span class="hljs-number">16</span>,  <span class="hljs-number">530742520</span>);
    b = md5_hh(b, c, d, a, x[i+ <span class="hljs-number">2</span>], <span class="hljs-number">23</span>, -<span class="hljs-number">995338651</span>);

    a = md5_ii(a, b, c, d, x[i+ <span class="hljs-number">0</span>], <span class="hljs-number">6</span> , -<span class="hljs-number">198630844</span>);
    d = md5_ii(d, a, b, c, x[i+ <span class="hljs-number">7</span>], <span class="hljs-number">10</span>,  <span class="hljs-number">1126891415</span>);
    c = md5_ii(c, d, a, b, x[i+<span class="hljs-number">14</span>], <span class="hljs-number">15</span>, -<span class="hljs-number">1416354905</span>);
    b = md5_ii(b, c, d, a, x[i+ <span class="hljs-number">5</span>], <span class="hljs-number">21</span>, -<span class="hljs-number">57434055</span>);
    a = md5_ii(a, b, c, d, x[i+<span class="hljs-number">12</span>], <span class="hljs-number">6</span> ,  <span class="hljs-number">1700485571</span>);
    d = md5_ii(d, a, b, c, x[i+ <span class="hljs-number">3</span>], <span class="hljs-number">10</span>, -<span class="hljs-number">1894986606</span>);
    c = md5_ii(c, d, a, b, x[i+<span class="hljs-number">10</span>], <span class="hljs-number">15</span>, -<span class="hljs-number">1051523</span>);
    b = md5_ii(b, c, d, a, x[i+ <span class="hljs-number">1</span>], <span class="hljs-number">21</span>, -<span class="hljs-number">2054922799</span>);
    a = md5_ii(a, b, c, d, x[i+ <span class="hljs-number">8</span>], <span class="hljs-number">6</span> ,  <span class="hljs-number">1873313359</span>);
    d = md5_ii(d, a, b, c, x[i+<span class="hljs-number">15</span>], <span class="hljs-number">10</span>, -<span class="hljs-number">30611744</span>);
    c = md5_ii(c, d, a, b, x[i+ <span class="hljs-number">6</span>], <span class="hljs-number">15</span>, -<span class="hljs-number">1560198380</span>);
    b = md5_ii(b, c, d, a, x[i+<span class="hljs-number">13</span>], <span class="hljs-number">21</span>,  <span class="hljs-number">1309151649</span>);
    a = md5_ii(a, b, c, d, x[i+ <span class="hljs-number">4</span>], <span class="hljs-number">6</span> , -<span class="hljs-number">145523070</span>);
    d = md5_ii(d, a, b, c, x[i+<span class="hljs-number">11</span>], <span class="hljs-number">10</span>, -<span class="hljs-number">1120210379</span>);
    c = md5_ii(c, d, a, b, x[i+ <span class="hljs-number">2</span>], <span class="hljs-number">15</span>,  <span class="hljs-number">718787259</span>);
    b = md5_ii(b, c, d, a, x[i+ <span class="hljs-number">9</span>], <span class="hljs-number">21</span>, -<span class="hljs-number">343485551</span>);

    a = safe_add(a, olda);
    b = safe_add(b, oldb);
    c = safe_add(c, oldc);
    d = safe_add(d, oldd);
  &#125;
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(a, b, c, d);
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * These functions implement the four basic operations the algorithm uses.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">md5_cmn</span>(<span class="hljs-params">q, a, b, x, s, t</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">md5_ff</span>(<span class="hljs-params">a, b, c, d, x, s, t</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> md5_cmn((b &amp; c) | ((~b) &amp; d), a, b, x, s, t);
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">md5_gg</span>(<span class="hljs-params">a, b, c, d, x, s, t</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> md5_cmn((b &amp; d) | (c &amp; (~d)), a, b, x, s, t);
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">md5_hh</span>(<span class="hljs-params">a, b, c, d, x, s, t</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> md5_cmn(b ^ c ^ d, a, b, x, s, t);
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">md5_ii</span>(<span class="hljs-params">a, b, c, d, x, s, t</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Add integers, wrapping at 2^32. This uses 16-bit operations internally</span>
<span class="hljs-comment"> * to work around bugs in some JS interpreters.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe_add</span>(<span class="hljs-params">x, y</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">var</span> lsw = (x &amp; <span class="hljs-number">0xFFFF</span>) + (y &amp; <span class="hljs-number">0xFFFF</span>);
  <span class="hljs-keyword">var</span> msw = (x &gt;&gt; <span class="hljs-number">16</span>) + (y &gt;&gt; <span class="hljs-number">16</span>) + (lsw &gt;&gt; <span class="hljs-number">16</span>);
  <span class="hljs-keyword">return</span> (msw &lt;&lt; <span class="hljs-number">16</span>) | (lsw &amp; <span class="hljs-number">0xFFFF</span>);
&#125;

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Bitwise rotate a 32-bit number to the left.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bit_rol</span>(<span class="hljs-params">num, cnt</span>)</span>
<span class="hljs-function"></span>&#123;
  <span class="hljs-keyword">return</span> (num &lt;&lt; cnt) | (num &gt;&gt;&gt; (<span class="hljs-number">32</span> - cnt));
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSignature</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">return</span> hex_md5(<span class="hljs-built_in">Date</span>.parse(<span class="hljs-built_in">Date</span>()).toString())
&#125;

<span class="hljs-built_in">console</span>.log(getSignature())</code></pre>
<p>Python 调用代码：</p>
<pre><code class="hljs python"><span class="hljs-comment"># ==================================</span>
<span class="hljs-comment"># --*-- coding: utf-8 --*--</span>
<span class="hljs-comment"># @Time    : 2021-12-23</span>
<span class="hljs-comment"># @Author  : ITBOB.CN</span>
<span class="hljs-comment"># @FileName: challenge_7.py</span>
<span class="hljs-comment"># @Software: PyCharm</span>
<span class="hljs-comment"># ==================================</span>


<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> execjs
<span class="hljs-keyword">import</span> requests


challenge_api = <span class="hljs-string">&quot;http://spider.wangluozhe.com/challenge/api/7&quot;</span>
headers = &#123;
    <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;Cookie 替换成你的&quot;</span>,
    <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;spider.wangluozhe.com&quot;</span>,
    <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://spider.wangluozhe.com&quot;</span>,
    <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://spider.wangluozhe.com/challenge/7&quot;</span>,
    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&quot;</span>,
    <span class="hljs-string">&quot;X-Requested-With&quot;</span>: <span class="hljs-string">&quot;XMLHttpRequest&quot;</span>
&#125;


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_signature</span>():</span>
    now = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(time.time())) + <span class="hljs-string">&quot;000&quot;</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;challenge_7.js&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:
        wlz_js = execjs.<span class="hljs-built_in">compile</span>(f.read())
    <span class="hljs-comment"># signature = wlz_js.call(&quot;getSignature&quot;)</span>
    signature = wlz_js.call(<span class="hljs-string">&quot;hex_md5&quot;</span>, now)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;signature: &quot;</span>, signature)
    <span class="hljs-keyword">return</span> signature


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    result = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">101</span>):
        data = &#123;
            <span class="hljs-string">&quot;page&quot;</span>: page,
            <span class="hljs-string">&quot;count&quot;</span>: <span class="hljs-number">10</span>,
            <span class="hljs-string">&quot;_signature&quot;</span>: get_signature()
        &#125;
        response = requests.post(url=challenge_api, headers=headers, data=data).json()
        <span class="hljs-built_in">print</span>(response)
        <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> response[<span class="hljs-string">&quot;data&quot;</span>]:
            result += d[<span class="hljs-string">&quot;value&quot;</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;结果为: &quot;</span>, result)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
    main()</code></pre>
<p>这里还有一点小细节，如果是 Python 生成时间戳传入 JS 的 <code>hex_md5</code> 方法的话，要保证时间戳的最后三位为0，不然校验通不过，通常的写法是 <code>str(int(time.time() * 1000))</code>，这里要改一下：<code>str(int(time.time())) + &quot;000&quot;</code>，不用 Python 的话，也可以在 JS 里写个方法直接返回 <code>hex_md5(Date.parse(Date()).toString())</code> 也行。</p>
<p><strong>还有一个问题就是如果你找的 MD5 代码不规范，准确来说是和题目使用的 MD5 代码不太一样的话，有可能本地要改的地方就不止这两处了，所以尽量找一个方法名都一样的JS，能省不少事儿。</strong></p>
<h3><span id="ri-zhi-duan-dian-cha-zhuang-diao-shi">日志断点 / 插桩调试</span></h3>
<p>除了 Hook 以外，我们还可以通过插桩调试的方式，将整个生成 <code>_signature</code> 的流程、涉及到的参数、生成的值，都通过日志的形式打印出来，逆向分析其逻辑。PS：插桩，即日志断点，鼠标右键选择 <code>Add logpoint</code> 即可添加一个日志断点，相当于 <code>console.log()</code>，此功能是 Chrome 73 版本新增的。</p>
<p><img src="https://cdn.itbob.cn/img/article/050/11.png" alt="11"></p>
<ul>
<li><strong>Add breakpoint</strong>：添加普通断点；</li>
<li><strong>Add conditional breakpoint</strong>：添加条件断点，满足条件才断下；</li>
<li><strong>Add logpoint</strong>：添加日志断点；</li>
<li><strong>Never pause here</strong>：永不在此处断下；</li>
<li><strong>Add script to ignore list</strong>：网站的部分 JS，比如 <code>jquery.min.js</code> 之类的库文件，我们单步调试的时候并不想进入到该文件中，那么可以将此类文件右键添加忽略掉。</li>
</ul>
<p>关键的日志断点有以下三处：</p>
<ul>
<li>第 605 行，<code>arguments</code> 为当前传入函数的参数值；</li>
<li>第 141 行，<code>___.join(vV_)</code> 为当前调用的方法名称，也会输出方法中的参数名称；</li>
<li>第 591 行，<code>__V(_, ___(u_), 0, 0, _U__).apply(void 0, y__(v___))</code> 为当前方法执行完毕的结果。</li>
</ul>
<p>肯定有人会疑惑，如何知道应该在这三个地方下日志断点呢？答案是只能自己单步、多步调试，找规律、仔细观察，就像交流群里的小小白大佬说的一样，屁股坐烂就行了。当然也不是只有这三个地方能输出对应的信息，有可能其他地方也可以，这就要看你自己调试了。</p>
<p><img src="https://cdn.itbob.cn/img/article/050/12.png" alt="12"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/13.png" alt="13"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/14.png" alt="14"></p>
<p>除了这三个地方的日志断点以外，建议还可以在第 606 行打个断点，这样每次执行一个方法就断下，本地就可以跟着同步调试，挨个对比传入的参数和得到的结果，不至于一下子输出的东西太多，不方便查找。</p>
<p>第一步，<code>gnature = window.byted_acrawler(window.sign())</code>：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/15.png" alt="15"></p>
<p>下一步，sign 方法，取时间戳：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/16.png" alt="16"></p>
<p>下一步，调用 <code>hex_md5()</code> 方法：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/17.png" alt="17"></p>
<p>从这里就可以开始本地同步调试了，本地 MD5 下断点调试，可以看到得到的值不一样：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/18.png" alt="18"></p>
<p>下一步，调用 <code>str2binl()</code> 方法，和本地得到的值是一样的：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/19.png" alt="19"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/20.png" alt="20"></p>
<p>下一步，调用 <code>core_md5()</code> 方法，得到的值和本地就不一样了，这里大致可以确定此方法内部与标准算法有差别了：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/21.png" alt="21"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/22.png" alt="22"></p>
<p>下一步，调用 <code>md5_ff()</code> 方法，得到的值是一样的：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/23.png" alt="23"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/24.png" alt="24"></p>
<p>以此类推，最终会找到两个不一样的地方，即 <code>md5_hh()</code> 两个默认参数被修改了。</p>
<p><code>-722521979</code> 被改成了 <code>-722521939</code>：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/25.png" alt="25"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/26.png" alt="26"></p>
<p><code>76029189</code> 被改成了 <code>76029185</code>：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/27.png" alt="27"></p>
<p><img src="https://cdn.itbob.cn/img/article/050/28.png" alt="28"></p>
<p>最终提交结果，验证成功：</p>
<p><img src="https://cdn.itbob.cn/img/article/050/29.png" alt="29"></p>
<!-- flag of hidden posts -->
            </div>
        </article>
    </div>
    <br>
    
    

    
    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>

    <div id="gitalk-container"></div>

    <script>
    var gitalk = new Gitalk({
        clientID: 'd19a84b9d9a2ddb2c6b9',
        clientSecret: 'cec9feae5129a6106edc68ce06d167be8eb06021',
        repo: 'trhx.github.io',
        owner: 'TRHX',
        admin: ['TRHX'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false       // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
    </script>


    
</div>

                <div class="site-footer gt-c-content-color-first">
    <div class="footer-main">
        <!-- 建议保留版权信息或者添加主题信息到友链，感谢您的理解 -->
        <!-- 文件位置：layout/_includes/footer.ejs -->
        <!-- <span style="text-align: right; float: right;">
            Theme 
            <a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a>
             | Powered by
            <a href="https://hexo.io" target="_blank">Hexo</a>
        </span>
        <span style="text-align: left;"></span> -->
        <span>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fas fa-user"></i> UV
                </span>
                <span class="badge-value bg-pink" id="busuanzi_value_site_uv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fas fa-user-plus"></i> PV
                </span>
                <span class="badge-value bg-blue" id="busuanzi_value_site_pv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-keyboard"></i> Word Count
                </span>
                <span class="badge-value bg-firebrick post-count">222.2k</span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-cog fa-spin"></i> Powered by
                </span>
                <span class="badge-value bg-brightgreen"><a href="https://hexo.io" target="_blank">Hexo</a></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-paper-plane"></i> Theme
                </span>
                <span class="badge-value bg-orange"><a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a></span>
            </div>
        </span>
        <br/>
        <br/>

        <span style="text-align: center; float: center;">
            Copyright <i class="fa fa-copyright"></i> 2018 - <script>document.write(new Date().getFullYear());</script> <a href="https://www.itbob.cn/" target="_blank">ITBOB.CN</a> 丨
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
                <i class="fab fa-creative-commons"></i>
                <i class="fab fa-creative-commons-by"></i>
                <i class="fab fa-creative-commons-nc"></i>
                <i class="fab fa-creative-commons-nd"></i>
            </a> 丨
            <!-- <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> 丨 -->
            <span id="sitetime">正在载入网站运行时间...</span>
            <script>
                function siteTime(){
                    window.setTimeout("siteTime()", 1000);
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth()+1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    /* 
                    Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
                    year - 作为date对象的年份，为4位年份值
                    month - 0-11之间的整数，做为date对象的月份
                    day - 1-31之间的整数，做为date对象的天数
                    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
                    minutes - 0-59之间的整数，做为date对象的分钟数
                    seconds - 0-59之间的整数，做为date对象的秒数
                    microseconds - 0-999之间的整数，做为date对象的毫秒数
                    */
                    var t1 = Date.UTC(2018,08,10,17,38,00); //北京时间2018-8-10 17:38:00
                    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
                    var diff = t2-t1;
                    var diffYears = Math.floor(diff/years);
                    var diffDays = Math.floor((diff/days)-diffYears*365);
                    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
                    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
                    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
                    document.getElementById("sitetime").innerHTML="小破站已运行了 "
                    + "<font style='color:#FE3C65;font-weight:bold'>" + diffYears + "</font>" + " 年 "
                    + "<font style='color:#FFA500;font-weight:bold'>" + diffDays + "</font>" + " 天 "
                    + "<font style='color:#1DBF97;font-weight:bold'>" + diffHours + "</font>" + " 小时 "
                    + "<font style='color:#8A2BE2;font-weight:bold'>" + diffMinutes + "</font>" + " 分 "
                    + "<font style='color:#007EC6;font-weight:bold'>" + diffSeconds + "</font>" + " 秒 ";
                }
                siteTime();
            </script>
        </span>
        <br/>
        <br/>
        <span>
            <img src="https://cdn.itbob.cn/img/footer/icp.png" class="nofancybox" alt="ICP" style="width:auto; height:20px; margin-bottom:-4px"><a href="https://beian.miit.gov.cn/" target="_blank"> 鄂ICP备19003281号-7</a>丨
            <img src="https://cdn.itbob.cn/img/footer/moeicp.png" class="nofancybox" alt="MOE ICP" style="width:auto; height:18px; margin-bottom:-3.5px"><a href="https://icp.gov.moe/" target="_blank"> 萌ICP备20202022号</a>丨
            <img src="https://cdn.itbob.cn/img/footer/webify.png" class="nofancybox" alt="腾讯云开发 Webify" style="width:auto; height:25px; margin-bottom:-8px"><a href="https://webify.cloudbase.net/" target="_blank"> 云开发 Webify</a>丨
            <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img src="https://cdn.itbob.cn/img/footer/upyun.png" class="nofancybox" alt="又拍云赞助云存储" style="width:auto; height:19px; margin-bottom:-4px"></a> 赞助CDN/COS服务丨
            <a href="https://www.foreverblog.cn/" target="_blank"><img src="https://cdn.itbob.cn/img/footer/foreverblog.png" class="nofancybox" alt="十年之约" style="width:auto; height:15px; margin-bottom:-2px"></a>
        </span>
    </div>
</div>

<!-- <div class="sidebar_wo" id="leimu">
    <img src="https://cdn.itbob.cn/img/footer/leimuA.png" class="nofancybox" alt="雷姆" 
    onmouseover="this.src='https://cdn.itbob.cn/img/footer/leimuB.png'" 
    onmouseout="this.src='https://cdn.itbob.cn/img/footer/leimuA.png'" title="回到底部">
</div>
<div class="sidebar_wo" id="lamu">
    <img src="https://cdn.itbob.cn/img/footer/lamuA.png" class="nofancybox" alt="雷姆" 
    onmouseover="this.src='https://cdn.itbob.cn/img/footer/lamuB.png'" 
    onmouseout="this.src='https://cdn.itbob.cn/img/footer/lamuA.png'" title="回到顶部">
</div> -->

<script>
    /* 拉姆蕾姆回到顶部或底部按钮 */
    $(function() {
        $("#leimu img").eq(0).click(function() {
            $("html,body").animate({scrollTop:$(document).height()},800);
            return false;
        });
        $("#lamu img").eq(0).click(function() {
            $("html,body").animate({scrollTop:0},800);
            return false;
        });
    });
</script>

            </div>
        </div>
        <!-- <a id="back-to-top" class="back-to-top show hl fa fa-arrow-up" href="javascript:void(0)" title="回到顶部"></a> -->
        <a id="back-to-top" class="back-to-top2" href="javascript:void(0)" title="回到顶部">
            <img class="nofancybox" src="https://cdn.itbob.cn/img/back_to_top.png"/>
        </a>
        <script>
            (function () {
                // When to show the scroll link
                // higher number = scroll link appears further down the page   
                var upperLimit = 100;
                
                // Our scroll link element
                var scrollElem = $('#back-to-top');
            
                // Scroll to top speed
                var scrollSpeed = 500;
            
                // Show and hide the scroll to top link based on scroll position   
                scrollElem.hide();
                $(window).scroll(function () {            
                    var scrollTop = $(document).scrollTop();       
                    if ( scrollTop > upperLimit ) {
                        $(scrollElem).stop().fadeTo(200, 1); // fade back in           
                    }else{       
                        $(scrollElem).stop().fadeTo(200, 0); // fade out
                    }
                });

                // Scroll to top animation on click
                $(scrollElem).click(function(){
                    $('html, body').animate({scrollTop:0}, scrollSpeed); return false;
                });
            })();
        </script>
    </body>
</html>