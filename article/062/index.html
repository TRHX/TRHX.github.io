<!-- 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
-->

<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Force https -->

    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">


<!-- Title -->
<title>极验业务安全，深知 V2 业务风控逆向分析 - BOB&#39;S BLOG</title>

<!-- Icon -->
<link rel="icon" href="/img/favicon.ico">

<!-- Fonts -->
<link rel="preload" href="//fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" as="style" onload="this.onload=null, this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="//fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>

<!-- Font Awesome -->
<!-- https://fontawesome.dashgame.com/ -->
<!-- <link rel="stylesheet" href="https://cdn.itbob.cn/css/font-awesome@5.6.3/all.min.css"> -->
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/5.15.4/css/all.min.css">
<!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css"> -->


    <!-- KaTeX -->
    <!-- //cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css -->
    <link rel="preload" href="//cdn.itbob.cn/css/katex@0.12.0/katex.min.css" as="style" onload="this.onload=null, this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="//cdn.itbob.cn/css/katex@0.12.0/katex.min.css"></noscript>


<!-- Style -->

<link rel="stylesheet" href="/styles/main.css">

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-pure@1.0.1/dist/main.css"> -->

<!-- Analytics -->

    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement('script');
                hm.src = 'https://hm.baidu.com/hm.js?6ca34ddce088f8434f3c7509576819f2';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


<!-- Busuanzi -->
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script async src="//cdn.itbob.cn/js/busuanzi@2.3/busuanzi.pure.mini.js"></script>

<!-- Typeit -->
<!-- https://www.typeitjs.com/ -->
<script src="//unpkg.com/typeit@8.7.0/dist/index.umd.js"></script>

<!-- Fancybox -->

    <link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css">
    <script src="//cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"> </script>
    <script src="//cdn.itbob.cn/js/fancybox@3.5.7/fancybox.js"> </script>

<!-- <script>
  $('[data-fancybox="images"]').fancybox({//可选
    thumbs : {
      autoStart : true //缩略图
    }
  });
  $('[data-fancybox]').fancybox({//启用函数，必须
    protect: true //图片右键不能下载，可选
  });
</script> -->

<!-- Console -->
<script>
    function makeMulti (string) {
        let l = new String(string)
        l = l.substring(l.indexOf("/*") + 3, l.lastIndexOf("*/"))
        return l
    }
    let string = function () {
      /* 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
      */
    }
    console.log(makeMulti(string));
    console.log("\n %c © ITBOB'S BLOG %c https://www.itbob.cn %c © ITRHX'S BLOG %c https://www.itrhx.com \n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;")
</script>

    <meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BOB'S BLOG" type="application/atom+xml">
</head>
    <body>
        <div class="main gt-bg-theme-color-first">
            <div class="main-content">
                <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/img/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first" id="typeitspan">
            <!-- BOB&#39;S BLOG -->
        </div>
    </a>
    <!-- <span id="typeitspan"></span> -->
    <script>
        new TypeIt('#typeitspan', {
        strings: "BOB'S BLOG",
        speed: 150, 
        afterComplete: function (instance) {
            instance.destroy();
        }
        }).go();
    </script>
    <button aria-label="Navbar Toggler" class="navbar-toggler" type="button" id="changeNavbar">
        <i class="gt-c-content-color-first" style="font-size: 18px;">
            <svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 448 512" height="18px" fill="currentColor">
                <path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z" />
            </svg>
        </i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center; ">
            
                
                    <div class="nav-item">
                        <a href="/" class="menu gt-a-link" target="_self">首页</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/archives/" class="menu gt-a-link" target="_self">归档</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/tags/" class="menu gt-a-link" target="_self">标签</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/friends/" class="menu gt-a-link" target="_self">友链</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/about/" class="menu gt-a-link" target="_self">关于</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="https://www.travellings.cn/go.html" target="_blank">
                            <img src="https://cdn.itbob.cn/img/travelling.gif" class="nofancybox" alt="开往-友链接力" width="auto" height="25px">
                        </a>
                    </div>
                
            
        </div>
    </div>
</nav>

<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function() {
        let element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else { 
            element.style.display = 'none';
        }
    }
</script>

                <div class="post-container">
    <div class="post-detail gt-bg-theme-color-second gt-c-content-color-first">
        <article class="gt-post-content">
            <h1 class="post-title">极验业务安全，深知 V2 业务风控逆向分析</h1>
            <div class="post-info">
                <time class="post-time gt-c-content-color-first">
                    <i class="fa fa-calendar-alt"></i> 首发于: 2023-01-16丨
                </time>
                <span id="busuanzi_container_page_pv">
                    <i class="fas fa-eye"></i> 阅读量: <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>丨
                </span>
                
                    <span class="post-count">
                        <i class="fa fa-keyboard"></i> 字数统计: 3.1k丨
                    </span>
                    <span class="post-count">
                        <i class="fa fa-hourglass-half"></i> 阅读时长: 13分丨
                    </span>
                
                
                    
                        <!-- <i class="fa fa-tag"></i> -->
                        <i class="fas fa-hashtag"></i>
                        <a href="/tags/%E7%88%AC%E8%99%AB/" class="post-tag">
                            爬虫</a>
                    
                        <!-- <i class="fa fa-tag"></i> -->
                        <i class="fas fa-hashtag"></i>
                        <a href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98/" class="post-tag">
                            验证码逆向实战</a>
                    
                
            </div>
            <hr>
            <div class="post-content gt-c-content-color-first">
                <p><img src="https://cdn.itbob.cn/img/cover/captcha_reverse.png" alt="captcha_reverse"></p>
<center><font color="red" size="5px" weight="bolder">欢迎加入爬虫逆向微信交流群：添加微信 IT-BOB（备注交流群）</font></center>
<h2><span id="wen-zhang-mu-lu">文章目录</span></h2>
<hr>
<!-- toc -->
<ul>
<li><a href="#sheng-ming">声明</a></li>
<li><a href="#ni-xiang-mu-biao">逆向目标</a></li>
<li><a href="#shen-zhi-jian-jie">深知简介</a></li>
<li><a href="#zhua-bao-fen-xi">抓包分析</a></li>
<li><a href="#ni-xiang-fen-xi">逆向分析</a>
<ul>
<li><a href="#huo-qu-h-zhi">获取 h 值</a></li>
<li><a href="#huo-qu-e-zhi">获取 e 值</a></li>
<li><a href="#huo-qu-l-zhi">获取 l 值</a></li>
<li><a href="#jin-yi-bu-chu-li-l">进一步处理 l</a></li>
</ul>
</li>
<li><a href="#jie-guo-yan-zheng">结果验证</a></li>
</ul>
<!-- tocstop -->
<hr>
<h2><span id="sheng-ming">声明</span></h2>
<p><strong><font color="red">本文章中所有内容仅供学习交流使用，不用于其他任何目的，不提供完整代码，抓包内容、敏感网址、数据接口等均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关！</font></strong></p>
<p><strong><font color="red">本文章未经许可禁止转载，禁止任何修改后二次传播，擅自使用本文讲解的技术而导致的任何意外，作者均不负责，若有侵权，请通过邮件 <a href="mailto:admin@itbob.cn">admin@itbob.cn</a> 联系我立即删除！</font></strong></p>
<h2><span id="ni-xiang-mu-biao">逆向目标</span></h2>
<p><img src="https://cdn.itbob.cn/img/article/062/01.gif" alt="01"></p>
<ul>
<li>目标：某验深知 V2 业务风控逆向分析</li>
<li>主页：<code>aHR0cHM6Ly93d3cuZ2VldGVzdC5jb20vZGVtby9kay12Mi5odG1s</code></li>
</ul>
<h2><span id="shen-zhi-jian-jie">深知简介</span></h2>
<p>某验深知通过无感采集客户端数据，对用户的环境、标识、行为操作等进行智能化分析，结合业务场景有效识别有潜在风险的用户。整个识别过程不干扰用户，不打断业务既有流程。完整通讯流程如下：</p>
<p><img src="https://cdn.itbob.cn/img/article/062/02.jpg" alt="02"></p>
<h2><span id="zhua-bao-fen-xi">抓包分析</span></h2>
<p>访问首页，会引入一个 <code>v2.sense.js</code>，后面接了个 <code>id</code>，需要将其提取出来，后续有用到，当然一般情况下，同一个业务这个 <code>id</code> 应该是一样的，直接复制下来写死也行。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/03.png" alt="03"></p>
<p>接着有个 <code>gettype</code> 的请求，这里主要返回一些资源路径，其中有个 <code>gct.xxx.js</code>，这个 JS 名称每隔一段时间就会变化，这个 JS 会生成一个键值对，例如 <code>&#123;'xnbw': '1158444372'&#125;</code>，JS 变化，这个键值对也会变化，这个键值对参与了后面加密参数的生成，在某验系列产品中都有这个东西，少量测试将其固定发现也可以通过验证，盲猜大量请求或者某些校验严格的网站可能有影响，建议还是动态去请求这个 JS 来获取最新的键值对，这个后文具体再说。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/04.png" alt="04"></p>
<p>然后是 <code>judge</code> 的请求，这个请求页面一加载就完成了，不需要手动点击请求，其中 <code>Query String Parameters</code> 里有个 <code>app_id</code> 就是我们前面提到的 <code>id</code>，<code>Request Payload</code> 就是一串超长的字符串，这个也是我们需要逆向的参数。该请求如果验证成功，会返回一个 <code>session_id</code>。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/05.png" alt="05"></p>
<p><img src="https://cdn.itbob.cn/img/article/062/06.png" alt="06"></p>
<p>然后就是业务接口了，本例中业务接口是 <code>verify-dk-v2</code>，也就是一个登录接口，带上前面 <code>judge</code> 接口返回的 <code>session_id</code> 即可请求成功。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/07.png" alt="07"></p>
<p><img src="https://cdn.itbob.cn/img/article/062/08.png" alt="08"></p>
<h2><span id="ni-xiang-fen-xi">逆向分析</span></h2>
<p>由于我们逆向的参数 <code>Request Payload</code> 没有键名导致不能直接搜索关键字，所以只能跟栈或者下个 XHR 断点，跟栈可以在 <code>sense.2.3.0.js</code> 第 6144 行找到一个 <code>e + h[AUJ_(1173)]</code>，这个就是正确的 <code>Request Payload</code> 值。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/09.png" alt="09"></p>
<p>上图中其实核心代码就四行，后文也是围绕这四行代码来分析的：</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> h = o[AUJ_(<span class="hljs-number">1156</span>)]()
  , e = CoUE[ymDv(<span class="hljs-number">24</span>)](NFeB)
  , l = EbF_[ymDv(<span class="hljs-number">409</span>)](e, h[ymDv(<span class="hljs-number">1194</span>)])
  , e = DWYi[ymDv(<span class="hljs-number">1137</span>)](l)</code></pre>
<h3><span id="huo-qu-h-zhi">获取 h 值</span></h3>
<p>先来看 h 的值，由一个方法生成一个对象，对象里面分别是 <code>aeskey</code> 和 <code>rsa</code>，每次也都是随机变化的。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/10.png" alt="10"></p>
<p>继续跟到这个方法里，重点在于 e 和 t 的值，最后返回的就是 <code>&#123;aeskey: e, rsa: t&#125;</code>。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/11.png" alt="11"></p>
<p>先看这个 e 的值，也就是 <code>RwyT()</code> 方法，搞过某验其他产品的就知道这里是 16 位随机值。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/12.png" alt="12"></p>
<p>然后 t 的值，和某验其他系列产品一样，用到了 RSA 加密算法，这里图中 <code>BPqG()</code> 就是 RSA 算法，t 的值就是 RSA 加密后的结果，扣的时候注意找到算法开头的地方，将整个 <code>BPqG()</code> 方法扣下来即可。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/13.png" alt="13"></p>
<p><img src="https://cdn.itbob.cn/img/article/062/14.png" alt="14"></p>
<h3><span id="huo-qu-e-zhi">获取 e 值</span></h3>
<p>接下来是 e 的值，<code>e = CoUE[ymDv(24)](NFeB)</code>，很明显是将 <code>NFeB</code> 的值进行了处理，<code>NFeB</code> 是个对象，里面有一些 <code>data</code>、<code>id</code> 等信息，如下图所示：</p>
<p><img src="https://cdn.itbob.cn/img/article/062/15.png" alt="15"></p>
<p>所以我们得先找一下 <code>NFeB</code> 这个值是怎么来的，直接搜索发现只有四个地方，在第 6109 行就是定义的地方，挨个看，首先有个 s 参数，将 id 传入到一个函数进行处理，函数没啥特别的，直接扣就行，通常经过处理后，s 的值为空，即 <code>s=&quot;&quot;</code>。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/16.png" alt="16"></p>
<p>再来看有个 u 值，由一个方法生成了一大串包含很多感叹号的字符串，本案例实际测试中，直接将这个值置空也行，可能其他校验严格或者大批量请求的情况下，说不定也会校验的，所以我们最好也跟进去找一下生成逻辑。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/17.png" alt="17"></p>
<p>跟进这个方法，里面是一些浏览器环境的值，比如屏幕高宽、canvas、ua、浏览器插件、时间、时区、语言等等，基本上都能写死，后续会将这些值以 <code>!!</code> 相连接最终生成 u 的值。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/18.png" alt="18"></p>
<p>然后继续看，接下来是 c 值，是一个对象，值为 <code>&#123;&quot;key&quot;:0,&quot;value&quot;:[]&#125;</code>，我这里直接写死了。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/19.png" alt="19"></p>
<p>再往下就是 <code>NFeB</code> 了：</p>
<p><img src="https://cdn.itbob.cn/img/article/062/20.png" alt="20"></p>
<p>Unicode 转换一下，简单解一下混淆，就长下面这样：</p>
<pre><code class="hljs javascript">NFeB = &#123;
    <span class="hljs-string">&quot;id&quot;</span>: a[<span class="hljs-string">&quot;id&quot;</span>],
    <span class="hljs-string">&quot;page_id&quot;</span>: a[<span class="hljs-string">&quot;page_id&quot;</span>],
    <span class="hljs-string">&quot;lang&quot;</span>: a[<span class="hljs-string">&quot;lang&quot;</span>] || AUJ_(<span class="hljs-number">31</span>),
    <span class="hljs-string">&quot;data&quot;</span>: &#123;
        <span class="hljs-string">&quot;insights&quot;</span>: u || <span class="hljs-literal">null</span>,
        <span class="hljs-string">&quot;track_key&quot;</span>: c[<span class="hljs-string">&quot;value&quot;</span>] ? c[<span class="hljs-string">&quot;key&quot;</span>] : <span class="hljs-literal">null</span>,
        <span class="hljs-string">&quot;track&quot;</span>: c[<span class="hljs-string">&quot;value&quot;</span>] || <span class="hljs-literal">null</span>,
        <span class="hljs-string">&quot;ep&quot;</span>: o[<span class="hljs-string">&quot;KZrg&quot;</span>](i),
        <span class="hljs-string">&quot;eco&quot;</span>: <span class="hljs-built_in">window</span>[<span class="hljs-string">&quot;GEERANDOMTOKEN&quot;</span>] || <span class="hljs-string">&quot;&quot;</span>,
        <span class="hljs-string">&quot;ww3&quot;</span>: <span class="hljs-string">&quot;&quot;</span>
    &#125;
&#125;;</code></pre>
<p><code>id</code> 不用说，<code>page_id</code> 就是个时间戳，<code>lang</code> 中文就是 <code>zh-cn</code>，<code>insights</code> 是前面得到的 <code>u</code> 值，<code>track_key</code>、<code>track</code> 取 <code>c</code> 的键和值，<code>ep</code> 将 <code>i</code> 传入了一个函数进行处理，<code>i</code> 是固定的字符串 <code>client</code>，这个 <code>KZrg</code> 方法可以跟进去看看，里面其实有很多都是定值，唯一需要注意的是 <code>t[&quot;tm&quot;]</code> 这个值，和某验其他系列一样，是 <code>window.performance.timing</code> 的值，自己获取一下时间戳随机加减伪造一下就行了。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/21.png" alt="21"></p>
<p>然后就是 <code>eco</code> 的值，取的 <code>window.GEERANDOMTOKEN</code>，打印一下 window，除了有这个 token 以外，还可以看到 <code>localStore</code>、<code>session</code> 里面也有这个值。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/22.png" alt="22"></p>
<p><img src="https://cdn.itbob.cn/img/article/062/23.png" alt="23"></p>
<p>由于某验的 JS 都是混淆后的，不太好定位这个值生成的地方，所以拿出我们的 Hook 大法，先清除一下缓存，不然的话是 Hook 不到值的，Hook 代码如下：</p>
<pre><code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> token = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-built_in">Object</span>.defineProperty(<span class="hljs-built_in">window</span>, <span class="hljs-string">&#x27;GEERANDOMTOKEN&#x27;</span>, &#123;
        <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;GEERANDOMTOKEN-&gt;&#x27;</span>, val);
            <span class="hljs-keyword">debugger</span>;
            token = val;
            <span class="hljs-keyword">return</span> val;
        &#125;,
        <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">		</span>&#123;
            <span class="hljs-keyword">return</span> token;
        &#125;
    &#125;);
&#125;)();</code></pre>
<p><img src="https://cdn.itbob.cn/img/article/062/24.png" alt="24"></p>
<p>断下后往前跟栈，<code>window[o] = t</code>，<code>o</code> 就是 <code>GEERANDOMTOKEN</code>，<code>t</code> 就是我们想要的值。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/25.png" alt="25"></p>
<p>往上就可以找到 <code>t</code> 的生成方法，核心就是生成一个 32 位的随机字符串，然后加上时间戳，再进行 MD5 加密得到最终值，生成位置以及实现的代码如下：</p>
<p><img src="https://cdn.itbob.cn/img/article/062/26.png" alt="26"></p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> MD5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;md5&quot;</span>)


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getToken</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-keyword">var</span> t = MD5(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> t = [<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>,<span class="hljs-string">&quot;5&quot;</span>,<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-string">&quot;9&quot;</span>,<span class="hljs-string">&quot;A&quot;</span>,<span class="hljs-string">&quot;B&quot;</span>,<span class="hljs-string">&quot;C&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;F&quot;</span>,<span class="hljs-string">&quot;G&quot;</span>,<span class="hljs-string">&quot;H&quot;</span>,<span class="hljs-string">&quot;I&quot;</span>,<span class="hljs-string">&quot;J&quot;</span>,<span class="hljs-string">&quot;K&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>,<span class="hljs-string">&quot;N&quot;</span>,<span class="hljs-string">&quot;O&quot;</span>,<span class="hljs-string">&quot;P&quot;</span>,<span class="hljs-string">&quot;Q&quot;</span>,<span class="hljs-string">&quot;R&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;T&quot;</span>,<span class="hljs-string">&quot;U&quot;</span>,<span class="hljs-string">&quot;V&quot;</span>,<span class="hljs-string">&quot;W&quot;</span>,<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;Y&quot;</span>,<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>,<span class="hljs-string">&quot;e&quot;</span>,<span class="hljs-string">&quot;f&quot;</span>,<span class="hljs-string">&quot;g&quot;</span>,<span class="hljs-string">&quot;h&quot;</span>,<span class="hljs-string">&quot;i&quot;</span>,<span class="hljs-string">&quot;j&quot;</span>,<span class="hljs-string">&quot;k&quot;</span>,<span class="hljs-string">&quot;l&quot;</span>,<span class="hljs-string">&quot;m&quot;</span>,<span class="hljs-string">&quot;n&quot;</span>,<span class="hljs-string">&quot;o&quot;</span>,<span class="hljs-string">&quot;p&quot;</span>,<span class="hljs-string">&quot;q&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>,<span class="hljs-string">&quot;t&quot;</span>,<span class="hljs-string">&quot;u&quot;</span>,<span class="hljs-string">&quot;v&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>,<span class="hljs-string">&quot;z&quot;</span>], n = <span class="hljs-string">&quot;&quot;</span>, r = <span class="hljs-number">0</span>; r &lt; e; r++)
            n += t[<span class="hljs-built_in">parseInt</span>(<span class="hljs-number">61</span> * <span class="hljs-built_in">Math</span>.random(), <span class="hljs-number">10</span>)];
        <span class="hljs-keyword">return</span> n;
    &#125;(<span class="hljs-number">32</span>) + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime());
    <span class="hljs-keyword">return</span> t;
&#125;</code></pre>
<p>当你把以上这些参数都搞完了，你可能认为都齐了，其实不然，后面接着还有一句 <code>Yvwp(NFeB, r)</code>，将 r 的值增加到了 <code>NFeB</code> 里，这个 r 的值类似于 <code>&#123;olbo: &quot;1588069361&quot;&#125;</code>，这个键值对都是每隔一段时间会变的，这个在某验系列其他文章里也提过。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/27.png" alt="27"></p>
<p>进一步分析，这个 r 是传进来的，所以往上跟栈，有个 <code>r[psPG(1183)]()</code> 方法就生成了这个对象：</p>
<p><img src="https://cdn.itbob.cn/img/article/062/28.png" alt="28"></p>
<p>继续跟到这个方法里去，首先定义了 e 这个对象，然后赋值 <code>e = &#123;ep: &quot;test data&quot;, lang: &quot;zh&quot;&#125;</code>，然后经过 <code>window[tYlM(1126)]()</code> 方法处理后，e 里面就新增了 <code>&#123;olbo: &quot;1588069361&quot;&#125;</code>，后续将 ep 和 lang 两个值删除后返回。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/29.png" alt="29"></p>
<p>所以我们继续跟进 <code>window[tYlM(1126)]()</code> 方法，会跳转到 gct.xxxx.js 里，这个 JS 就是我们开头讲过的，他的名称会每隔一段时间变化，内容也会变，所以导致生成的键值对也会变化，继续跟，有个 <code>t[e] = xxx</code> 的语句，其中 e 和等号右边的值，就是我们需要的键值对。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/30.png" alt="30"></p>
<p>这个键值对在我们本地也可以动态获取，只需要请求正确的 JS 文件，将要调用的方法全局导出就行了，以下给一个我的处理方法示例（注意里面请求 url 已经脱敏处理，所以不可直接运行，自行抓包补上）：</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> execjs
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger


headers = &#123;
    <span class="hljs-string">&quot;user-agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&quot;</span>,
&#125;


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_gct</span>():</span>
    url = <span class="hljs-string">&quot;https://dkapi.脱敏处理.com/deepknow/v2/gettype&quot;</span>
    params = &#123;
        <span class="hljs-string">&quot;callback&quot;</span>: <span class="hljs-string">&quot;脱敏处理_&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>))
    &#125;
    response = requests.get(url, headers=headers, params=params).text
    response = json.loads(re.findall(<span class="hljs-string">r&quot;geetest_\d+\((.*?)\)&quot;</span>, response)[<span class="hljs-number">0</span>])
    <span class="hljs-comment"># gettype 接口返回的 gct.xxx.js 的地址</span>
    gct_path = <span class="hljs-string">&quot;https://static.脱敏处理.com&quot;</span> + response[<span class="hljs-string">&quot;gct_path&quot;</span>]
    logger.info(<span class="hljs-string">&quot;gct_path: %s&quot;</span> % gct_path)
    gct_js = requests.get(gct_path, headers=headers).text
    <span class="hljs-comment"># 正则匹配需要调用的方法名称</span>
    function_name = re.findall(<span class="hljs-string">r&quot;\)\)\&#123;return (.*?)\(&quot;</span>, gct_js)[<span class="hljs-number">0</span>]
    <span class="hljs-comment"># 查找需要插入全局导出代码的位置</span>
    break_position = gct_js.find(<span class="hljs-string">&quot;return function(t)&#123;&quot;</span>)
    <span class="hljs-comment"># window.gct 全局导出方法</span>
    gct_js_new = gct_js[:break_position] + <span class="hljs-string">&quot;window.gct=&quot;</span> + function_name + <span class="hljs-string">&quot;;&quot;</span> + gct_js[break_position:]
    <span class="hljs-comment"># 添加自定义方法调用 window.gct 获取键值对</span>
    gct_js_new = <span class="hljs-string">&quot;window = global;&quot;</span> + gct_js_new + <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">    function getGct()&#123;</span>
<span class="hljs-string">        var e = &#123;&quot;lang&quot;: &quot;zh&quot;, &quot;ep&quot;: &quot;test data&quot;&#125;;</span>
<span class="hljs-string">        window.gct(e);</span>
<span class="hljs-string">        delete e[&quot;lang&quot;];</span>
<span class="hljs-string">        delete e[&quot;ep&quot;];</span>
<span class="hljs-string">        return e;</span>
<span class="hljs-string">    &#125;&quot;&quot;&quot;</span>
    gct = execjs.<span class="hljs-built_in">compile</span>(gct_js_new).call(<span class="hljs-string">&quot;getGct&quot;</span>)
    logger.info(<span class="hljs-string">&quot;gct: %s&quot;</span> % gct)
    <span class="hljs-keyword">return</span> gct</code></pre>
<p>到这里我们 <code>NFeB</code> 就生成完毕了，回到 <code>e</code> 的值，这里其实就是把 <code>NFeB</code> 转成字符串，直接 <code>JSON.stringify()</code> 即可。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/31.png" alt="31"></p>
<h3><span id="huo-qu-l-zhi">获取 l 值</span></h3>
<p>l 的值比较简单，就是将前面生成的 <code>h[&quot;aeskey&quot;]</code> 作为 key，<code>e</code> 作为待加密字符串，经过 AES 加密后即可得到 l 的值。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/32.png" alt="32"></p>
<p>本地复现如下（有些变量名称不一样无影响，我是直接复用的某验其他产品的方法）：</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> CryptoJS = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;crypto-js&quot;</span>)


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">aesEncrypt</span>(<span class="hljs-params">e, i</span>) </span>&#123;
    <span class="hljs-keyword">var</span> key = CryptoJS.enc.Utf8.parse(i),
    iv = CryptoJS.enc.Utf8.parse(<span class="hljs-string">&quot;0000000000000000&quot;</span>),
    srcs = CryptoJS.enc.Utf8.parse(e),
    encrypted = CryptoJS.AES.encrypt(srcs, key, &#123;
        <span class="hljs-attr">iv</span>: iv,
        <span class="hljs-attr">mode</span>: CryptoJS.mode.CBC,
        <span class="hljs-attr">padding</span>: CryptoJS.pad.Pkcs7
    &#125;);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = encrypted, o = r.ciphertext.words, i = r.ciphertext.sigBytes, s = [], a = <span class="hljs-number">0</span>; a &lt; i; a++) &#123;
        <span class="hljs-keyword">var</span> c = o[a &gt;&gt;&gt; <span class="hljs-number">2</span>] &gt;&gt;&gt; <span class="hljs-number">24</span> - a % <span class="hljs-number">4</span> * <span class="hljs-number">8</span> &amp; <span class="hljs-number">255</span>;
        s.push(c);
    &#125;
    <span class="hljs-keyword">return</span> s;
&#125;</code></pre>
<h3><span id="jin-yi-bu-chu-li-l">进一步处理 l</span></h3>
<p>最后一步 <code>e = DWYi[ymDv(1137)](l)</code>，将 l 的值经过了 <code>tc_t</code> 这个方法进行处理，就会得到最终 <code>Request Payload</code> 的一部分。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/33.png" alt="33"></p>
<p>跟进这个 <code>tc_t</code> 方法，又是熟悉的 <code>return e[&quot;res&quot;] + e[&quot;end&quot;]</code>，同样和某验其他产品一样的。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/34.png" alt="34"></p>
<p>跟到处理 e 的这个方法里，最后返回的是 <code>&#123;&quot;res&quot;: a, &quot;end&quot;: s&#125;</code>，没啥特别的，直接扣即可，这里注意和某验其他产品里的方法有些小区别，里面有些常量的值是不一样的，最开始我直接复用了其他产品的方法，发现结果是错的。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/35.png" alt="35"></p>
<p>自此整个流程分析完毕，最终 <code>e + h[AUJ_(1173)]</code> 的值与 <code>Request Payload</code> 的值一致。</p>
<p><img src="https://cdn.itbob.cn/img/article/062/36.png" alt="36"></p>
<p><img src="https://cdn.itbob.cn/img/article/062/37.png" alt="37"></p>
<h2><span id="jie-guo-yan-zheng">结果验证</span></h2>
<p><img src="https://cdn.itbob.cn/img/article/062/38.png" alt="38"></p>
<!-- flag of hidden posts -->
            </div>
        </article>
    </div>
    <br>
    
    

    
    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>

    <div id="gitalk-container"></div>

    <script>
    var gitalk = new Gitalk({
        clientID: 'd19a84b9d9a2ddb2c6b9',
        clientSecret: 'cec9feae5129a6106edc68ce06d167be8eb06021',
        repo: 'trhx.github.io',
        owner: 'TRHX',
        admin: ['TRHX'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false       // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
    </script>


    
</div>

                <div class="site-footer gt-c-content-color-first">
    <div class="footer-main">
        <!-- 建议保留版权信息或者添加主题信息到友链，感谢您的理解 -->
        <!-- 文件位置：layout/_includes/footer.ejs -->
        <!-- <span style="text-align: right; float: right;">
            Theme 
            <a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a>
             | Powered by
            <a href="https://hexo.io" target="_blank">Hexo</a>
        </span>
        <span style="text-align: left;"></span> -->
        <span>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fas fa-user"></i> UV
                </span>
                <span class="badge-value bg-pink" id="busuanzi_value_site_uv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fas fa-user-plus"></i> PV
                </span>
                <span class="badge-value bg-blue" id="busuanzi_value_site_pv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-keyboard"></i> Word Count
                </span>
                <span class="badge-value bg-firebrick post-count">222.2k</span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-cog fa-spin"></i> Powered by
                </span>
                <span class="badge-value bg-brightgreen"><a href="https://hexo.io" target="_blank">Hexo</a></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-paper-plane"></i> Theme
                </span>
                <span class="badge-value bg-orange"><a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a></span>
            </div>
        </span>
        <br/>
        <br/>

        <span style="text-align: center; float: center;">
            Copyright <i class="fa fa-copyright"></i> 2018 - <script>document.write(new Date().getFullYear());</script> <a href="https://www.itbob.cn/" target="_blank">ITBOB.CN</a> 丨
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
                <i class="fab fa-creative-commons"></i>
                <i class="fab fa-creative-commons-by"></i>
                <i class="fab fa-creative-commons-nc"></i>
                <i class="fab fa-creative-commons-nd"></i>
            </a> 丨
            <!-- <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> 丨 -->
            <span id="sitetime">正在载入网站运行时间...</span>
            <script>
                function siteTime(){
                    window.setTimeout("siteTime()", 1000);
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth()+1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    /* 
                    Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
                    year - 作为date对象的年份，为4位年份值
                    month - 0-11之间的整数，做为date对象的月份
                    day - 1-31之间的整数，做为date对象的天数
                    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
                    minutes - 0-59之间的整数，做为date对象的分钟数
                    seconds - 0-59之间的整数，做为date对象的秒数
                    microseconds - 0-999之间的整数，做为date对象的毫秒数
                    */
                    var t1 = Date.UTC(2018,08,10,17,38,00); //北京时间2018-8-10 17:38:00
                    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
                    var diff = t2-t1;
                    var diffYears = Math.floor(diff/years);
                    var diffDays = Math.floor((diff/days)-diffYears*365);
                    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
                    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
                    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
                    document.getElementById("sitetime").innerHTML="小破站已运行了 "
                    + "<font style='color:#FE3C65;font-weight:bold'>" + diffYears + "</font>" + " 年 "
                    + "<font style='color:#FFA500;font-weight:bold'>" + diffDays + "</font>" + " 天 "
                    + "<font style='color:#1DBF97;font-weight:bold'>" + diffHours + "</font>" + " 小时 "
                    + "<font style='color:#8A2BE2;font-weight:bold'>" + diffMinutes + "</font>" + " 分 "
                    + "<font style='color:#007EC6;font-weight:bold'>" + diffSeconds + "</font>" + " 秒 ";
                }
                siteTime();
            </script>
        </span>
        <br/>
        <br/>
        <span>
            <img src="https://cdn.itbob.cn/img/footer/icp.png" class="nofancybox" alt="ICP" style="width:auto; height:20px; margin-bottom:-4px"><a href="https://beian.miit.gov.cn/" target="_blank"> 鄂ICP备19003281号-7</a>丨
            <img src="https://cdn.itbob.cn/img/footer/moeicp.png" class="nofancybox" alt="MOE ICP" style="width:auto; height:18px; margin-bottom:-3.5px"><a href="https://icp.gov.moe/" target="_blank"> 萌ICP备20202022号</a>丨
            <img src="https://cdn.itbob.cn/img/footer/webify.png" class="nofancybox" alt="腾讯云开发 Webify" style="width:auto; height:25px; margin-bottom:-8px"><a href="https://webify.cloudbase.net/" target="_blank"> 云开发 Webify</a>丨
            <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img src="https://cdn.itbob.cn/img/footer/upyun.png" class="nofancybox" alt="又拍云赞助云存储" style="width:auto; height:19px; margin-bottom:-4px"></a> 赞助CDN/COS服务丨
            <a href="https://www.foreverblog.cn/" target="_blank"><img src="https://cdn.itbob.cn/img/footer/foreverblog.png" class="nofancybox" alt="十年之约" style="width:auto; height:15px; margin-bottom:-2px"></a>
        </span>
    </div>
</div>

<!-- <div class="sidebar_wo" id="leimu">
    <img src="https://cdn.itbob.cn/img/footer/leimuA.png" class="nofancybox" alt="雷姆" 
    onmouseover="this.src='https://cdn.itbob.cn/img/footer/leimuB.png'" 
    onmouseout="this.src='https://cdn.itbob.cn/img/footer/leimuA.png'" title="回到底部">
</div>
<div class="sidebar_wo" id="lamu">
    <img src="https://cdn.itbob.cn/img/footer/lamuA.png" class="nofancybox" alt="雷姆" 
    onmouseover="this.src='https://cdn.itbob.cn/img/footer/lamuB.png'" 
    onmouseout="this.src='https://cdn.itbob.cn/img/footer/lamuA.png'" title="回到顶部">
</div> -->

<script>
    /* 拉姆蕾姆回到顶部或底部按钮 */
    $(function() {
        $("#leimu img").eq(0).click(function() {
            $("html,body").animate({scrollTop:$(document).height()},800);
            return false;
        });
        $("#lamu img").eq(0).click(function() {
            $("html,body").animate({scrollTop:0},800);
            return false;
        });
    });
</script>

            </div>
        </div>
        <!-- <a id="back-to-top" class="back-to-top show hl fa fa-arrow-up" href="javascript:void(0)" title="回到顶部"></a> -->
        <a id="back-to-top" class="back-to-top2" href="javascript:void(0)" title="回到顶部">
            <img class="nofancybox" src="https://cdn.itbob.cn/img/back_to_top.png"/>
        </a>
        <script>
            (function () {
                // When to show the scroll link
                // higher number = scroll link appears further down the page   
                var upperLimit = 100;
                
                // Our scroll link element
                var scrollElem = $('#back-to-top');
            
                // Scroll to top speed
                var scrollSpeed = 500;
            
                // Show and hide the scroll to top link based on scroll position   
                scrollElem.hide();
                $(window).scroll(function () {            
                    var scrollTop = $(document).scrollTop();       
                    if ( scrollTop > upperLimit ) {
                        $(scrollElem).stop().fadeTo(200, 1); // fade back in           
                    }else{       
                        $(scrollElem).stop().fadeTo(200, 0); // fade out
                    }
                });

                // Scroll to top animation on click
                $(scrollElem).click(function(){
                    $('html, body').animate({scrollTop:0}, scrollSpeed); return false;
                });
            })();
        </script>
    </body>
</html>