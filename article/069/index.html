<!-- 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
-->

<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Force https -->

    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">


<!-- Title -->
<title>数美验证全家桶逆向分析以及 AST 获取动态参数 - BOB&#39;S BLOG</title>

<!-- Icon -->
<link rel="icon" href="/img/favicon.ico">

<!-- Fonts -->
<link rel="preload" href="//fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" as="style" onload="this.onload=null, this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="//fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>

<!-- Font Awesome -->
<!-- https://fontawesome.dashgame.com/ -->
<!-- <link rel="stylesheet" href="https://cdn.itbob.cn/css/font-awesome@5.6.3/all.min.css"> -->
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/5.15.4/css/all.min.css">
<!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css"> -->


    <!-- KaTeX -->
    <!-- //cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css -->
    <link rel="preload" href="//cdn.itbob.cn/css/katex@0.12.0/katex.min.css" as="style" onload="this.onload=null, this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="//cdn.itbob.cn/css/katex@0.12.0/katex.min.css"></noscript>


<!-- Style -->

<link rel="stylesheet" href="/styles/main.css">

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-pure@1.0.1/dist/main.css"> -->

<!-- Analytics -->

    
    
        <!-- Baidu Analytics -->
        <script defer>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement('script');
                hm.src = 'https://hm.baidu.com/hm.js?6ca34ddce088f8434f3c7509576819f2';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    


<!-- Busuanzi -->
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script async src="//cdn.itbob.cn/js/busuanzi@2.3/busuanzi.pure.mini.js"></script>

<!-- Typeit -->
<!-- https://www.typeitjs.com/ -->
<script src="//unpkg.com/typeit@8.7.0/dist/index.umd.js"></script>

<!-- Fancybox -->

    <link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css">
    <script src="//cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"> </script>
    <script src="//cdn.itbob.cn/js/fancybox@3.5.7/fancybox.js"> </script>

<!-- <script>
  $('[data-fancybox="images"]').fancybox({//可选
    thumbs : {
      autoStart : true //缩略图
    }
  });
  $('[data-fancybox]').fancybox({//启用函数，必须
    protect: true //图片右键不能下载，可选
  });
</script> -->

<!-- Console -->
<script>
    function makeMulti (string) {
        let l = new String(string)
        l = l.substring(l.indexOf("/*") + 3, l.lastIndexOf("*/"))
        return l
    }
    let string = function () {
      /* 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
      */
    }
    console.log(makeMulti(string));
    console.log("\n %c © ITBOB'S BLOG %c https://www.itbob.cn %c © ITRHX'S BLOG %c https://www.itrhx.com \n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;")
</script>

    <meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BOB'S BLOG" type="application/atom+xml">
</head>
    <body>
        <div class="main gt-bg-theme-color-first">
            <div class="main-content">
                <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/img/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first" id="typeitspan">
            <!-- BOB&#39;S BLOG -->
        </div>
    </a>
    <!-- <span id="typeitspan"></span> -->
    <script>
        new TypeIt('#typeitspan', {
        strings: "BOB'S BLOG",
        speed: 150, 
        afterComplete: function (instance) {
            instance.destroy();
        }
        }).go();
    </script>
    <button aria-label="Navbar Toggler" class="navbar-toggler" type="button" id="changeNavbar">
        <i class="gt-c-content-color-first" style="font-size: 18px;">
            <svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 448 512" height="18px" fill="currentColor">
                <path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z" />
            </svg>
        </i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center; ">
            
                
                    <div class="nav-item">
                        <a href="/" class="menu gt-a-link" target="_self">首页</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/archives/" class="menu gt-a-link" target="_self">归档</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/tags/" class="menu gt-a-link" target="_self">标签</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/friends/" class="menu gt-a-link" target="_self">友链</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/about/" class="menu gt-a-link" target="_self">关于</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="https://travellings.link" target="_blank">
                            <img src="https://cdn.itbob.cn/img/travelling.gif" class="nofancybox" alt="开往-友链接力" width="auto" height="25px">
                        </a>
                    </div>
                
            
        </div>
    </div>
</nav>

<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function() {
        let element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else { 
            element.style.display = 'none';
        }
    }
</script>

                <div class="post-container">
    <div class="post-detail gt-bg-theme-color-second gt-c-content-color-first">
        <article class="gt-post-content">
            <h1 class="post-title">数美验证全家桶逆向分析以及 AST 获取动态参数</h1>
            <div class="post-info">
                <time class="post-time gt-c-content-color-first">
                    <i class="fa fa-calendar-alt"></i> 首发于: 2023-04-20丨
                </time>
                <span id="busuanzi_container_page_pv">
                    <i class="fas fa-eye"></i> 阅读量: <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>丨
                </span>
                
                    <span class="post-count">
                        <i class="fa fa-keyboard"></i> 字数统计: 3.6k丨
                    </span>
                    <span class="post-count">
                        <i class="fa fa-hourglass-half"></i> 阅读时长: 15分丨
                    </span>
                
                
                    
                        <!-- <i class="fa fa-tag"></i> -->
                        <i class="fas fa-hashtag"></i>
                        <a href="/tags/%E7%88%AC%E8%99%AB/" class="post-tag">
                            爬虫</a>
                    
                        <!-- <i class="fa fa-tag"></i> -->
                        <i class="fas fa-hashtag"></i>
                        <a href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98/" class="post-tag">
                            验证码逆向实战</a>
                    
                
            </div>
            <hr>
            <div class="post-content gt-c-content-color-first">
                <p><img src="https://cdn.itbob.cn/img/cover/captcha_reverse.png" alt="captcha_reverse"></p>
<h2><span id="wen-zhang-mu-lu">文章目录</span></h2>
<hr>
<!-- toc -->
<ul>
<li><a href="#sheng-ming">声明</a></li>
<li><a href="#mu-biao">目标</a></li>
<li><a href="#zhua-bao-fen-xi">抓包分析</a></li>
<li><a href="#ni-xiang-fen-xi">逆向分析</a>
<ul>
<li><a href="#captchauuid">captchaUuid</a></li>
<li><a href="#12-ge-jia-mi-can-shu">12 个加密参数</a></li>
</ul>
</li>
<li><a href="#jie-guo-yan-zheng">结果验证</a></li>
<li><a href="#ast-huo-qu-dong-tai-can-shu">AST 获取动态参数</a></li>
</ul>
<!-- tocstop -->
<hr>
<h2><span id="sheng-ming">声明</span></h2>
<p><strong><font color="red">本文章中所有内容仅供学习交流使用，不用于其他任何目的，不提供完整代码，抓包内容、敏感网址、数据接口等均已做脱敏处理，严禁用于商业用途和非法用途，否则由此产生的一切后果均与作者无关！</font></strong></p>
<p><strong><font color="red">本文章未经许可禁止转载，禁止任何修改后二次传播，擅自使用本文讲解的技术而导致的任何意外，作者均不负责，若有侵权，请通过邮件 <a href="mailto:admin@itbob.cn">admin@itbob.cn</a> 联系我立即删除！</font></strong></p>
<h2><span id="mu-biao">目标</span></h2>
<ul>
<li>目标：数美全家桶，包括：滑块、文字点选、图标点选、语序点选、空间推理、无感验证</li>
<li>地址：</li>
</ul>
<pre><code class="hljs gcode"><span class="hljs-comment">// 官网体验地址</span>
aHR<span class="hljs-number">0</span>cH<span class="hljs-name">M6</span>Ly<span class="hljs-number">93</span>d<span class="hljs-number">3</span>cuaX<span class="hljs-symbol">NodW1</span>laS<span class="hljs-number">5</span>jb<span class="hljs-number">20</span>vdHJpYWwvY<span class="hljs-number">2</span>FwdG<span class="hljs-symbol">NoYS5</span>od<span class="hljs-name">G1</span>s
<span class="hljs-comment">// 官方隐藏地址</span>
aHR<span class="hljs-number">0</span>cH<span class="hljs-name">M6</span>Ly<span class="hljs-number">9</span>jYX<span class="hljs-symbol">N0</span>YXRpYy<span class="hljs-number">5</span>mZW<span class="hljs-number">5</span><span class="hljs-symbol">na29</span>uZ<span class="hljs-number">2</span><span class="hljs-symbol">Nsb3</span>VkLm<span class="hljs-symbol">NuL3</span>ByL<span class="hljs-number">3</span>YxLjAu<span class="hljs-symbol">NC9</span>kZW<span class="hljs-number">1</span>vLmh<span class="hljs-number">0</span>bWw=
<span class="hljs-comment">// 某红书验证页面</span>
aHR<span class="hljs-number">0</span>cH<span class="hljs-name">M6</span>Ly<span class="hljs-number">93</span>d<span class="hljs-number">3</span>cueGlhb<span class="hljs-number">2</span>hvbmdzaHUuY<span class="hljs-number">29</span>tL<span class="hljs-number">3</span>dlYi<span class="hljs-number">1</span>sb<span class="hljs-number">2</span>dpbi<span class="hljs-number">9</span>jYXB<span class="hljs-number">0</span>Y<span class="hljs-number">2</span>hh</code></pre>
<p>数美不同类型验证码核心的 JS 都是一样的，只是个别参数有微小差别，主要以滑块为例来分析，通过 JS 代码以及官方文档可以看出数美是有无感验证的，但是官网体验地址里并没有放出来，官方有一个隐藏地址，里面的 demo 是最全的，包括无感，可以去上面给出的第二个地址里查看；数美的加密参数包含了 DES 加密算法，参数名以及 DES Key 不定时会变化，本文也会分析如何利用 AST 来获取动态的参数。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/01.png" alt="01"></p>
<h2><span id="zhua-bao-fen-xi">抓包分析</span></h2>
<p><code>conf</code> 接口，获取配置，主要是获取核心的 <code>captcha-sdk.min.js</code> 的地址，请求参数解释：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>organization</code></td>
<td>数美分配的公司标识，一般是每个网站唯一，写死即可</td>
</tr>
<tr>
<td><code>appId</code></td>
<td>应用标识，区分不同应用，数美后台可以管理</td>
</tr>
<tr>
<td><code>callback</code></td>
<td>回调参数</td>
</tr>
<tr>
<td><code>lang</code></td>
<td>语言，<code>zh-cn</code> 简体中文、<code>zh-tw</code> 繁体中文、<code>en</code> 英文</td>
</tr>
<tr>
<td><code>model</code></td>
<td>模式，<code>slide</code> 滑块、<code>auto_slide</code> 无感验证、<code>select</code> 文字点选、<code>icon_select</code> 图标点选、<code>seq_select</code> 语序点选、<code>spatial_select</code> 空间推理</td>
</tr>
<tr>
<td><code>sdkver</code></td>
<td>这个 sdk 版本是 <code>captcha-sdk.min.js</code> 内部写死的</td>
</tr>
<tr>
<td><code>channel</code></td>
<td>推广渠道，数美后台可以管理</td>
</tr>
<tr>
<td><code>captchaUuid</code></td>
<td>32位随机字符串，与业务方自身埋点数据配合，便于后续定位问题或进行数据统计</td>
</tr>
<tr>
<td><code>rversion</code></td>
<td><code>captcha-sdk.min.js</code> 版本号</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.itbob.cn/img/article/069/02.png" alt="02"></p>
<p>返回结果重点看 <code>captcha-sdk.min.js</code> 文件地址，如下图所示有个 <code>v1.0.4-171</code>，本文中我们称 <code>v1.0.4</code> 为大版本，<code>171</code> 为小版本，小版本不定时会更新，版本号不断升高。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/03.png" alt="03"></p>
<p>然后就是 <code>register</code> 接口，不同类型，返回的数据都大同小异，其中 <code>bg</code> 是背景图片，<code>fg</code> 是滑块，文字点选、空间推理中 <code>order</code> 是提示信息，<code>k</code>、<code>l</code>、<code>rid</code> 三个参数后续会用到。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/04.png" alt="04"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/05.png" alt="05"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/06.png" alt="06"></p>
<p>最后就是 <code>fverify</code> 验证接口，有类似下图红框中的 12 个参数，都是通过 JS 生成的，其参数名会根据 <code>captcha-sdk.min.js</code> 的变化而变化，其中有个最长的类似于下图的 <code>ep</code> 值，包含了轨迹加密。返回值里参数解释：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>code</code></td>
<td><code>1100</code>：成功；<code>1901</code>：QPS超限；<code>1902</code>：参数不合法；<code>1903</code>：服务失败；<code>9101</code>：无权限操作</td>
</tr>
<tr>
<td><code>riskLevel</code></td>
<td>处置建议，<code>PASS</code>：正常，建议直接放行；<code>REJECT</code>：违规，建议直接拦截</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.itbob.cn/img/article/069/07.png" alt="07"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/08.png" alt="08"></p>
<h2><span id="ni-xiang-fen-xi">逆向分析</span></h2>
<p>跟栈会发现核心逻辑在 <code>captcha-sdk.min.js</code> 里，这个 JS 类似于 OB 混淆（以前的文章介绍过，此处不再细说）：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/09.png" alt="09"></p>
<p>这里可以自己写 AST 还原一下，为了方便我们直接使用 v_jstools 解混淆：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/10.png" alt="10"></p>
<p>然后替换掉原来的 <code>captcha-sdk.min.js</code>，如果你测试的是官网的体验页面，使用 Fiddler 替换时要注意可能有跨域问题，需要利用 Filters 功能，设置响应头 <code>Access-Control-Allow-Origin</code> 字段值为当前域名：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/11.png" alt="11"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/12.png" alt="12"></p>
<p>如果你没注意到这个跨域问题，可能会替换之后发现没替换成功，原因是数美的资源有四个域名，其中一个宕了便会启用另一个，你替换其中一个报错了就会自动跳转另一个，所以看起来你并没有替换成功：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/13.png" alt="13"></p>
<p><strong>PS：若替换的 JS 格式化了，那么你在网页上滑动也是校验失败的，因为 JS 里检测了格式化，将 JS 压缩成一行再替换即可，具体检测的位置后文会讲到。</strong></p>
<h3><span id="captchauuid">captchaUuid</span></h3>
<p>直接搜索关键词下断点，经过多次调试会发现第一个出现 <code>captchaUuid</code> 的地方是在 <code>smcp.min.js</code>，如下图所示：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/14.png" alt="14"></p>
<p>这里的栈并不多，来回跟栈也没发现是哪里生成的，此时可以从初始位置也就是 <code>embed.html</code> 初始化验证码的地方开始单步跟：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/15.png" alt="15"></p>
<p>单步跟进去会发现一个 <code>getCaptchaUuid()</code> 的方法，将此方法扣出来即可。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/16.png" alt="16"></p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateTimeFormat</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    , t = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>&#123;
        <span class="hljs-keyword">return</span> +n &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">&quot;0&quot;</span> + n : n.toString();
    &#125;;
    <span class="hljs-keyword">return</span> ((e.getFullYear().toString() + t(e.getMonth() + <span class="hljs-number">1</span>)) + t(e.getDate()) + t(e.getHours()) + t(e.getMinutes())) + t(e.getSeconds());
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCaptchaUuid</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> c = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">var</span> o = <span class="hljs-string">&quot;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&quot;</span>;
    <span class="hljs-keyword">var</span> s = o.length;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">18</span>; a++) &#123;
        c += o.charAt(<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * s));
    &#125;
    <span class="hljs-keyword">return</span> generateTimeFormat() + c;
&#125;</code></pre>
<h3><span id="12-ge-jia-mi-can-shu">12 个加密参数</span></h3>
<p>直接跟栈就很容易找到，如下图所示的位置，D 就是生成的所有参数，此外，也可以通过搜索关键字 <code>getEncryptContent</code> 或者直接搜索参数名称来定位。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/17.png" alt="17"></p>
<p>可以发现上图里就有四个加密参数，都用到了 <code>getEncryptContent</code> 这个加密方法，加密方法传入两个参数，一个是待加密参数，一个是 DES Key，这四个待加密参数分别为 <code>appId</code> 值、<code>channel</code> 值、<code>lang</code> 值和一个 <code>getSafeParams</code> 方法。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/18.png" alt="18"></p>
<p>重点跟进 <code>getEncryptContent</code> 方法看看，一个控制流，挑几个重点的讲一下，第一步是获取一个 <code>key</code>，这个 <code>key</code> 是在前面设置的，后续会讲到，实际上这个 <code>key</code> 没啥用。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/19.png" alt="19"></p>
<p>然后会有一个 <code>isJsFormat</code> 的格式化检测函数，正常应该是 false 的，如果你格式化了就为 true，也就会导致 f 的值为时间戳加数美的域名，这个 f 值后续是 DES 的 Key，不对的话自然怎么滑都不会通过。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/20.png" alt="20"></p>
<p>然后就是 DES  加密了，这个 DES 是标准的加密算法，下图中传入的 1 和 0 表示的是加密，0 和 0 则表示解密，解密的情况也有，后续会遇到，<code>mode</code> 为 <code>ECB</code>，<code>padding</code> 为 <code>ZeroPadding</code>，不需要 <code>iv</code>，可以直接扣代码，或者直接引库即可。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/21.png" alt="21"></p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> CryptoJS = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;crypto-js&quot;</span>)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DESEncrypt</span>(<span class="hljs-params">key, word</span>) </span>&#123;
    <span class="hljs-keyword">var</span> key_ = CryptoJS.enc.Utf8.parse(key);
    <span class="hljs-keyword">var</span> srcs = CryptoJS.enc.Utf8.parse(word);
    <span class="hljs-keyword">var</span> encrypted = CryptoJS.DES.encrypt(srcs, key_, &#123;
        <span class="hljs-attr">mode</span>: CryptoJS.mode.ECB,
        <span class="hljs-attr">padding</span>: CryptoJS.pad.ZeroPadding
    &#125;);
    <span class="hljs-keyword">return</span> encrypted.toString();
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DESDecrypt</span>(<span class="hljs-params">key, word</span>) </span>&#123;
    <span class="hljs-keyword">var</span> key_ = CryptoJS.enc.Utf8.parse(key);
    <span class="hljs-keyword">var</span> decrypt = CryptoJS.DES.decrypt(word, key_, &#123;
        <span class="hljs-attr">mode</span>: CryptoJS.mode.ECB,
        <span class="hljs-attr">padding</span>: CryptoJS.pad.ZeroPadding
    &#125;);
    <span class="hljs-keyword">return</span> decrypt.toString(CryptoJS.enc.Utf8);
&#125;</code></pre>
<p>这里的四个值就分析完了，还有八个值是在前面生成的，如下图所示 x 的值即为其他八个值，往前看是一个函数生成的，往里面跟即可。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/22.png" alt="22"></p>
<p>跟进来是一个 <code>getMouseAction</code> 方法，里面先是挨个取值，后续会对这些值进行 DES 加密，下图中的 a、c 参数就是 <code>register</code> 接口返回的 k、l 值，s 参数是对 <code>register</code> 接口返回的 k 值进行解密操作：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/23.png" alt="23"></p>
<p>上图中 <code>u = this._data</code> 里面的值，根据滑块、点选、无感模式的不同，也有所差异，以下代码中，以 <code>baseData</code> 来表示 <code>this._data</code> 的值，根据模式的不同，可分为三类，大致构成如下：</p>
<p>滑块（<code>slide</code>）：</p>
<pre><code class="hljs javascript"><span class="hljs-comment">/* </span>
<span class="hljs-comment">track：滑动轨迹（x, y, t），distance：滑动距离，randomNum：生成两数之间的随机值，示例：</span>
<span class="hljs-comment">var track = [[0, -2, 0], [62, 1, 98], [73, 4, 205], [91, 3, 303], [123, -3, 397], [136, 8, 502], [160, 0, 599], [184, 0, 697], [169, 0, 797]]</span>
<span class="hljs-comment">var distance = 169</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">var</span> baseData = &#123;&#125;
baseData.mouseData = track
baseData.startTime = <span class="hljs-number">0</span>
baseData.endTime = track[track.length - <span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + randomNum(<span class="hljs-number">100</span>, <span class="hljs-number">500</span>)
baseData.mouseEndX = distance
baseData.trueWidth = <span class="hljs-number">300</span>
baseData.trueHeight = <span class="hljs-number">150</span>
baseData.selectData = []
baseData.blockWidth = <span class="hljs-number">40</span></code></pre>
<p>滑块轨迹生成代码：</p>
<pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sm_track</span>(<span class="hljs-params">distance</span>):</span>
    track_length = random.randint(<span class="hljs-number">4</span>, <span class="hljs-number">10</span>)
    track = [[<span class="hljs-number">0</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">0</span>]]
    m = distance % track_length
    e = <span class="hljs-built_in">int</span>(distance / track_length)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(track_length):
        x = (i + <span class="hljs-number">1</span>) * e + m + random.randint(<span class="hljs-number">20</span>, <span class="hljs-number">40</span>)
        y = -<span class="hljs-number">2</span> + (random.randint(-<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
        t = (i + <span class="hljs-number">1</span>) * <span class="hljs-number">100</span> + random.randint(-<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
        <span class="hljs-keyword">if</span> i == track_length - <span class="hljs-number">1</span>:
            x = distance
            track.append([x, y, t])
        <span class="hljs-keyword">else</span>:
            track.append([x, y, t])
    logger.info(<span class="hljs-string">&quot;track: %s&quot;</span> % track)
    <span class="hljs-keyword">return</span> track</code></pre>
<p>点选类（文字点选 <code>select</code>、图标点选 <code>icon_select</code>、语序点选 <code>seq_select</code>、空间推理 <code>spatial_select</code>）：</p>
<pre><code class="hljs javascript"><span class="hljs-comment">/*</span>
<span class="hljs-comment">coordinate：点选坐标（x, y），randomNum：生成两数之间的随机值，示例：</span>
<span class="hljs-comment">var coordinate = [[171, 101], [88, 102], [138, 109], [225, 100]]</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">var</span> baseData = &#123;&#125;
<span class="hljs-keyword">var</span> time_ = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()
coordinate.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">co</span>) </span>&#123;
    co[<span class="hljs-number">0</span>] = co[<span class="hljs-number">0</span>] / <span class="hljs-number">300</span>
    co[<span class="hljs-number">1</span>] = co[<span class="hljs-number">1</span>] / <span class="hljs-number">150</span>
    co[<span class="hljs-number">2</span>] = time_
    time_ += randomNum(<span class="hljs-number">100</span>, <span class="hljs-number">500</span>)
&#125;)
baseData.mouseData = coordinate
baseData.startTime = time_ - randomNum(<span class="hljs-number">800</span>, <span class="hljs-number">20000</span>)
baseData.endTime = coordinate[coordinate.length - <span class="hljs-number">1</span>][<span class="hljs-number">2</span>]
baseData.mouseEndX = <span class="hljs-number">0</span>
baseData.trueWidth = <span class="hljs-number">300</span>
baseData.trueHeight = <span class="hljs-number">150</span>
baseData.selectData = coordinate
baseData.blockWidth = <span class="hljs-literal">undefined</span></code></pre>
<p>无感（<code>auto_slide</code>）：</p>
<pre><code class="hljs javascript"><span class="hljs-comment">/*</span>
<span class="hljs-comment">randomNum：生成两数之间的随机值</span>
<span class="hljs-comment">*/</span>

<span class="hljs-keyword">var</span> baseData = &#123;&#125;
baseData.mouseData = [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]]
baseData.startTime = <span class="hljs-number">0</span>
baseData.endTime = randomNum(<span class="hljs-number">100</span>, <span class="hljs-number">500</span>)
baseData.mouseEndX = <span class="hljs-number">260</span>
baseData.trueWidth = <span class="hljs-number">300</span>
baseData.trueHeight = <span class="hljs-number">150</span>
baseData.selectData = []
baseData.blockWidth = <span class="hljs-number">40</span></code></pre>
<p>这些值生成完了之后，就是挨个通过 <code>getEncryptContent</code> 进行加密，前面已经分析过，实际上就是 DES 加密，可以看到分为点选、滑块和无感三类，其中 DES Key 也是会每隔一段时间变化的：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/24.png" alt="24"></p>
<p>再往下走还有三个加密参数，待加密值是定值，然后将 s 的值（也就是前面 <code>register</code> 接口返回的 k 经过 DES 解密后的值赋值给了 <code>this._data.__key</code>）。</p>
<p><img src="https://cdn.itbob.cn/img/article/069/25.png" alt="25"></p>
<p>至此所有加密参数就搞完了。</p>
<h2><span id="jie-guo-yan-zheng">结果验证</span></h2>
<p><img src="https://cdn.itbob.cn/img/article/069/26.png" alt="26"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/27.png" alt="27"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/28.png" alt="28"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/29.png" alt="29"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/30.png" alt="30"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/31.png" alt="31"></p>
<h2><span id="ast-huo-qu-dong-tai-can-shu">AST 获取动态参数</span></h2>
<p>前面说了，<code>/v1.0.4-171/captcha-sdk.min.js</code> 文件地址，我们称 <code>v1.0.4</code> 为大版本，<code>171</code> 为小版本，小版本每隔一段时间会更新，版本号会不断升高，具体更新周期是多少？这里推荐一个方法 <code>document.lastModified</code>，该方法记录的是物理网页的最后修改时间，我们直接访问 JS 地址，就可以直接查看不同版本的 JS 是啥时候更新的了，多对比几个版本，发现更新间隔时间并没有太明显的规律，如下图所示：</p>
<p><img src="https://cdn.itbob.cn/img/article/069/32.png" alt="32"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/33.png" alt="33"></p>
<p><img src="https://cdn.itbob.cn/img/article/069/34.png" alt="34"></p>
<p>不同版本里面的 12 个加密参数的名称和 DES 加密的 Key 都不一样，我们可以利用 AST 来动态获取这 12 个参数，经过测试，以下版本均可正常提取：</p>
<ul>
<li><code>v1.0.4-148</code> ~ <code>v1.0.4-171</code></li>
<li><code>v1.0.3-147</code> ~ <code>v1.0.3-171</code></li>
<li><code>v1.0.1-147</code> ~ <code>v1.0.1-171</code></li>
</ul>
<p>截止本文发布，小版本 <code>171</code> 为最新，<code>v1.0.4</code> 小版本从 <code>148</code> 开始，<code>v1.0.3</code>、<code>v1.0.1</code> 在 <code>147</code> 以前没有混淆，可自行正则匹配，暂未发现其他大版本，如有遇到不能适配的，可联系我瞅瞅，以下是完整的代码分享。</p>
<p><strong>PS：此 AST 代码仅实现对动态参数的提取，并非还原所有的混淆，提取出来的结果是有序、未去重的，后续按索引取就行。</strong></p>
<p><img src="https://cdn.itbob.cn/img/article/069/35.png" alt="35"></p>
<pre><code class="hljs javascript"><span class="hljs-comment">/*</span>
<span class="hljs-comment">@File   :  get_dynamic_params_ast.js</span>
<span class="hljs-comment">@Time   :  2023-04-04</span>
<span class="hljs-comment">@Author :  公众号：K哥爬虫</span>
<span class="hljs-comment">@Desc   :  数美验证，动态读取 captcha-sdk.min.js，AST 提取动态参数</span>
<span class="hljs-comment">@Version:  1.0.1 / 1.0.3 / 1.0.4 通用</span>
<span class="hljs-comment">@Url    :  https://castatic.fengkongcloud.cn/pr/auto-build/v1.0.4-171/captcha-sdk.min.js</span>
<span class="hljs-comment">*/</span>


<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);
<span class="hljs-keyword">const</span> parse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>).parse;
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default;
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default;
<span class="hljs-keyword">const</span> types = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/types&quot;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDynamicParams</span>(<span class="hljs-params">oldCode</span>)</span>&#123;
    <span class="hljs-comment">// 导入混淆代码并解析为 AST</span>
    <span class="hljs-keyword">const</span> astCode = parse(oldCode);
    <span class="hljs-comment">// 获取整个 AST 节点的长度</span>
    <span class="hljs-keyword">let</span> astCodeLength = astCode.program.body.length
    <span class="hljs-comment">// 获取数组位移函数的名称，如 _0x86bf</span>
    <span class="hljs-keyword">let</span> arrDisplacementFuncName = <span class="hljs-string">&quot;&quot;</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; astCodeLength; i++) &#123;
        <span class="hljs-keyword">let</span> astCodeBody = astCode.program.body[i]
        <span class="hljs-keyword">if</span> (astCodeBody.type == <span class="hljs-string">&quot;FunctionDeclaration&quot;</span> &amp;&amp; astCodeBody.params.length === <span class="hljs-number">2</span>) &#123;
            arrDisplacementFuncName = astCodeBody.id.name
        &#125;
    &#125;
    <span class="hljs-comment">// console.log(&quot;arrDisplacementFuncName: &quot;, arrDisplacementFuncName)</span>

    <span class="hljs-comment">// 获取大数组以及数组位移代码</span>
    <span class="hljs-keyword">let</span> decryptFunction = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; astCodeLength; i++) &#123;
        <span class="hljs-keyword">if</span> (astCode.program.body[i].type == <span class="hljs-string">&quot;FunctionDeclaration&quot;</span>) &#123;
            decryptFunction += generate(astCode.program.body[i]).code
        &#125;
        <span class="hljs-keyword">if</span> (astCode.program.body[i].type == <span class="hljs-string">&quot;ExpressionStatement&quot;</span>) &#123;
            <span class="hljs-keyword">let</span> expressions = astCode.program.body[i].expression.expressions
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a = <span class="hljs-number">0</span>; a &lt; expressions.length; a++) &#123;
                <span class="hljs-keyword">if</span> (expressions[a].type == <span class="hljs-string">&quot;CallExpression&quot;</span> &amp;&amp; expressions[a].callee.type == <span class="hljs-string">&quot;FunctionExpression&quot;</span> &amp;&amp; expressions[a].arguments.length == <span class="hljs-number">2</span>) &#123;
                    <span class="hljs-keyword">let</span> expressionStatement = types.expressionStatement(expressions[a])
                    decryptFunction += generate(expressionStatement).code
                &#125;
            &#125;
        &#125;
    &#125;
    <span class="hljs-built_in">eval</span>(decryptFunction)

    <span class="hljs-comment">// 获取所有引用了解密函数的变量名</span>
    <span class="hljs-keyword">let</span> allReplacedFunc = []
    <span class="hljs-keyword">let</span> tmpReplacedFunc1 = [arrDisplacementFuncName]

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;
        <span class="hljs-keyword">let</span> tmpReplacedFunc2 = []
        traverse(astCode, &#123;
            <span class="hljs-function"><span class="hljs-title">VariableDeclarator</span>(<span class="hljs-params">path</span>)</span> &#123;
                <span class="hljs-keyword">if</span> (path.node.init &amp;&amp; path.node.init.type == <span class="hljs-string">&quot;Identifier&quot;</span> &amp;&amp; tmpReplacedFunc1.indexOf(path.node.init.name)) &#123;
                    tmpReplacedFunc2.push(path.node.id.name)
                    path.remove()
                &#125;
            &#125;
        &#125;)
        <span class="hljs-keyword">if</span> (!tmpReplacedFunc2.length) &#123;
            <span class="hljs-keyword">break</span>
        &#125;
        allReplacedFunc = allReplacedFunc.concat(tmpReplacedFunc2)
        tmpReplacedFunc1 = tmpReplacedFunc2
    &#125;
    <span class="hljs-comment">// console.log(JSON.stringify(allReplacedFunc))</span>


    <span class="hljs-comment">// 解密函数还原</span>
    traverse(astCode, &#123;
        <span class="hljs-function"><span class="hljs-title">CallExpression</span>(<span class="hljs-params">path</span>)</span> &#123;
            <span class="hljs-keyword">let</span> calleeName = path.node.callee.name;
            <span class="hljs-keyword">if</span> (allReplacedFunc.indexOf(calleeName) &gt; -<span class="hljs-number">1</span>) &#123;
                <span class="hljs-comment">// 先替换函数名称 _0xbce966(0x936) ==&gt; _0x86bf(0x936)</span>
                <span class="hljs-keyword">let</span> callee = types.identifier(arrDisplacementFuncName)
                <span class="hljs-keyword">let</span> argument = path.node.arguments
                path.replaceInline(types.callExpression(callee, argument));
                <span class="hljs-comment">// 直接计算结果并替换</span>
                path.replaceInline(types.stringLiteral(<span class="hljs-built_in">eval</span>(path.toString())));
            &#125;
        &#125;
    &#125;)

    <span class="hljs-comment">// 大对象还原</span>
    <span class="hljs-keyword">let</span> allObject = &#123;&#125;
    traverse(astCode, &#123;
        <span class="hljs-function"><span class="hljs-title">VariableDeclarator</span>(<span class="hljs-params">path</span>)</span> &#123;
            <span class="hljs-keyword">if</span> (path.node.init &amp;&amp; path.node.init.type == <span class="hljs-string">&quot;ObjectExpression&quot;</span> &amp;&amp; path.node.init.properties.length &gt; <span class="hljs-number">1</span>) &#123;
                <span class="hljs-keyword">let</span> name = path.node.id.name
                <span class="hljs-keyword">let</span> properties = path.node.init.properties
                allObject[name] = &#123;&#125;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; properties.length; i++) &#123;
                    allObject[name][properties[i].key.value] = properties[i].value
                &#125;
                path.remove()
            &#125;
        &#125;
    &#125;)

    <span class="hljs-comment">// 函数替换，字符串替换：将类似 _0x3b79c6[&#x27;YrYQW&#x27;] 变成 &#x27;#IpValue&#x27;</span>
    traverse(astCode, &#123;
        <span class="hljs-function"><span class="hljs-title">MemberExpression</span>(<span class="hljs-params">path</span>)</span> &#123;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> allObject) &#123;
                <span class="hljs-keyword">if</span> (path.node.object &amp;&amp; path.node.object.name == key &amp;&amp; path.inList) &#123;
                    path.replaceInline(allObject[key][path.node.property.value])
                &#125;
                <span class="hljs-keyword">if</span> (path.node.object &amp;&amp; path.node.object.name == key &amp;&amp; path.parent.property &amp;&amp; path.parent.property.value == <span class="hljs-string">&quot;split&quot;</span>) &#123;
                    path.replaceInline(allObject[key][path.node.property.value])
                &#125;
                <span class="hljs-keyword">if</span> (path.node.object &amp;&amp; path.node.object.name == key &amp;&amp; path.parent.type == <span class="hljs-string">&quot;SwitchCase&quot;</span>) &#123;
                    path.replaceInline(allObject[key][path.node.property.value])
                &#125;
            &#125;
        &#125;
    &#125;)

    <span class="hljs-comment">// 获取动态post参数和加密的key</span>
    <span class="hljs-keyword">let</span> parametersList = [];
    traverse(astCode, &#123;
        <span class="hljs-function"><span class="hljs-title">AssignmentExpression</span>(<span class="hljs-params">path</span>)</span> &#123;
            <span class="hljs-keyword">let</span> left = path.node.left
            <span class="hljs-keyword">let</span> right = path.node.right
            <span class="hljs-keyword">if</span> (right.callee &amp;&amp; right.callee.property &amp;&amp; right.callee.property.value == <span class="hljs-string">&quot;getEncryptContent&quot;</span>) &#123;
                parametersList.push([left.property.value, right.arguments[<span class="hljs-number">1</span>].value])
            &#125;
        &#125;,
        <span class="hljs-function"><span class="hljs-title">CallExpression</span>(<span class="hljs-params">path</span>)</span> &#123;
            <span class="hljs-keyword">let</span> <span class="hljs-built_in">arguments</span> = path.node.arguments
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length == <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].callee &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].callee.property &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].callee.property.value == <span class="hljs-string">&quot;getEncryptContent&quot;</span>) &#123;
                parametersList.push([<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>].value, <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].arguments[<span class="hljs-number">1</span>].value])
            &#125;
        &#125;
    &#125;)

    <span class="hljs-comment">// 将 AST 节点转换成 JS 代码并写入到新文件里</span>
    <span class="hljs-comment">// const result = generate(astCode).code</span>
    <span class="hljs-comment">// fs.writeFile(&quot;./new.js&quot;, result, (err =&gt; &#123;console.log(err)&#125;))</span>

    <span class="hljs-keyword">return</span> parametersList
&#125;


<span class="hljs-comment">// 从本地读取一份 captcha-sdk</span>
<span class="hljs-keyword">const</span> oldCode = fs.readFileSync(<span class="hljs-string">&quot;captcha-sdk.v1.0.4-171.js&quot;</span>, &#123;<span class="hljs-attr">encoding</span>: <span class="hljs-string">&quot;utf-8&quot;</span>&#125;);
<span class="hljs-keyword">const</span> parametersList = getDynamicParams(oldCode)
<span class="hljs-built_in">console</span>.log(parametersList)
<span class="hljs-built_in">console</span>.log(parametersList.length)</code></pre>

            </div>
        </article>
    </div>
    <br>
    
        <div class="next-prev-post">
            
                <div class="prev-post">
                    <div class="prev gt-c-content-color-first">
                        上一篇：<a href="/article/070/" 
                            class="post-title gt-a-link">抖音滑块验证码 captchaBody 逆向分析，JSVMP 纯算法还原</a>
                    </div>
                </div>
            
            
                <div class="next-post">
                    <div class="next gt-c-content-color-first">
                        下一篇：<a href="/article/068/" 
                            class="post-title gt-a-link">百度滑块、点选、旋转验证码 v1、v2 逆向分析</a>
                    </div>
                </div>
            
        </div>
    
    

    
    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>

    <div id="gitalk-container"></div>

    <script>
    var gitalk = new Gitalk({
        clientID: 'd19a84b9d9a2ddb2c6b9',
        clientSecret: 'cec9feae5129a6106edc68ce06d167be8eb06021',
        repo: 'trhx.github.io',
        owner: 'TRHX',
        admin: ['TRHX'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false       // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
    </script>


    
</div>

                <div class="site-footer gt-c-content-color-first">
    <div class="footer-main">
        <!-- 建议保留版权信息或者添加主题信息到友链，感谢您的理解 -->
        <!-- 文件位置：layout/_includes/footer.ejs -->
        <!-- <span style="text-align: right; float: right;">
            Theme 
            <a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a>
             | Powered by
            <a href="https://hexo.io" target="_blank">Hexo</a>
        </span>
        <span style="text-align: left;"></span> -->
        <span>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fas fa-user"></i> UV
                </span>
                <span class="badge-value bg-pink" id="busuanzi_value_site_uv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fas fa-user-plus"></i> PV
                </span>
                <span class="badge-value bg-blue" id="busuanzi_value_site_pv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-keyboard"></i> Word Count
                </span>
                <span class="badge-value bg-firebrick post-count">319.8k</span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-cog fa-spin"></i> Powered by
                </span>
                <span class="badge-value bg-brightgreen"><a href="https://hexo.io" target="_blank">Hexo</a></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">
                    <i class="fa fa-paper-plane"></i> Theme
                </span>
                <span class="badge-value bg-orange"><a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a></span>
            </div>
        </span>
        <br/>
        <br/>

        <span style="text-align: center; float: center;">
            Copyright <i class="fa fa-copyright"></i> 2018 - <script>document.write(new Date().getFullYear());</script> <a href="https://www.itbob.cn/" target="_blank">ITBOB.CN</a> 丨
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
                <i class="fab fa-creative-commons"></i>
                <i class="fab fa-creative-commons-by"></i>
                <i class="fab fa-creative-commons-nc"></i>
                <i class="fab fa-creative-commons-nd"></i>
            </a> 丨
            <!-- <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> 丨 -->
            <span id="sitetime">正在载入网站运行时间...</span>
            <script>
                function siteTime(){
                    window.setTimeout("siteTime()", 1000);
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth()+1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    /* 
                    Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
                    year - 作为date对象的年份，为4位年份值
                    month - 0-11之间的整数，做为date对象的月份
                    day - 1-31之间的整数，做为date对象的天数
                    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
                    minutes - 0-59之间的整数，做为date对象的分钟数
                    seconds - 0-59之间的整数，做为date对象的秒数
                    microseconds - 0-999之间的整数，做为date对象的毫秒数
                    */
                    var t1 = Date.UTC(2018,08,10,17,38,00); //北京时间2018-8-10 17:38:00
                    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
                    var diff = t2-t1;
                    var diffYears = Math.floor(diff/years);
                    var diffDays = Math.floor((diff/days)-diffYears*365);
                    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
                    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
                    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
                    document.getElementById("sitetime").innerHTML="小破站已运行了 "
                    + "<font style='color:#FE3C65;font-weight:bold'>" + diffYears + "</font>" + " 年 "
                    + "<font style='color:#FFA500;font-weight:bold'>" + diffDays + "</font>" + " 天 "
                    + "<font style='color:#1DBF97;font-weight:bold'>" + diffHours + "</font>" + " 小时 "
                    + "<font style='color:#8A2BE2;font-weight:bold'>" + diffMinutes + "</font>" + " 分 "
                    + "<font style='color:#007EC6;font-weight:bold'>" + diffSeconds + "</font>" + " 秒 ";
                }
                siteTime();
            </script>
        </span>
        <br/>
        <br/>
        <span>
            <img src="https://cdn.itbob.cn/img/footer/icp.png" class="nofancybox" alt="ICP" style="width:auto; height:20px; margin-bottom:-4px"><a href="https://beian.miit.gov.cn/" target="_blank"> 鄂ICP备19003281号-7</a>丨
            <img src="https://cdn.itbob.cn/img/footer/moeicp.png" class="nofancybox" alt="MOE ICP" style="width:auto; height:18px; margin-bottom:-3.5px"><a href="https://icp.gov.moe/" target="_blank"> 萌ICP备20202022号</a>丨
            <img src="https://cdn.itbob.cn/img/footer/webify.png" class="nofancybox" alt="腾讯云开发 Webify" style="width:auto; height:25px; margin-bottom:-8px"><a href="https://webify.cloudbase.net/" target="_blank"> 云开发 Webify</a>丨
            <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img src="https://cdn.itbob.cn/img/footer/upyun.png" class="nofancybox" alt="又拍云赞助云存储" style="width:auto; height:19px; margin-bottom:-4px"></a> 赞助CDN/COS服务丨
            <a href="https://www.foreverblog.cn/" target="_blank"><img src="https://cdn.itbob.cn/img/footer/foreverblog.png" class="nofancybox" alt="十年之约" style="width:auto; height:15px; margin-bottom:-2px"></a>
        </span>
    </div>
</div>

<!-- <div class="sidebar_wo" id="leimu">
    <img src="https://cdn.itbob.cn/img/footer/leimuA.png" class="nofancybox" alt="雷姆" 
    onmouseover="this.src='https://cdn.itbob.cn/img/footer/leimuB.png'" 
    onmouseout="this.src='https://cdn.itbob.cn/img/footer/leimuA.png'" title="回到底部">
</div>
<div class="sidebar_wo" id="lamu">
    <img src="https://cdn.itbob.cn/img/footer/lamuA.png" class="nofancybox" alt="雷姆" 
    onmouseover="this.src='https://cdn.itbob.cn/img/footer/lamuB.png'" 
    onmouseout="this.src='https://cdn.itbob.cn/img/footer/lamuA.png'" title="回到顶部">
</div> -->

<script>
    /* 拉姆蕾姆回到顶部或底部按钮 */
    $(function() {
        $("#leimu img").eq(0).click(function() {
            $("html,body").animate({scrollTop:$(document).height()},800);
            return false;
        });
        $("#lamu img").eq(0).click(function() {
            $("html,body").animate({scrollTop:0},800);
            return false;
        });
    });
</script>

            </div>
        </div>
        <!-- <a id="back-to-top" class="back-to-top show hl fa fa-arrow-up" href="javascript:void(0)" title="回到顶部"></a> -->
        <a id="back-to-top" class="back-to-top2" href="javascript:void(0)" title="回到顶部">
            <img class="nofancybox" src="https://cdn.itbob.cn/img/back_to_top.png"/>
        </a>
        <script>
            (function () {
                // When to show the scroll link
                // higher number = scroll link appears further down the page   
                var upperLimit = 100;
                
                // Our scroll link element
                var scrollElem = $('#back-to-top');
            
                // Scroll to top speed
                var scrollSpeed = 500;
            
                // Show and hide the scroll to top link based on scroll position   
                scrollElem.hide();
                $(window).scroll(function () {            
                    var scrollTop = $(document).scrollTop();       
                    if ( scrollTop > upperLimit ) {
                        $(scrollElem).stop().fadeTo(200, 1); // fade back in           
                    }else{       
                        $(scrollElem).stop().fadeTo(200, 0); // fade out
                    }
                });

                // Scroll to top animation on click
                $(scrollElem).click(function(){
                    $('html, body').animate({scrollTop:0}, scrollSpeed); return false;
                });
            })();
        </script>
    </body>
</html>