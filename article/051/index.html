<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="code-gf1mflsgGo" />
    <!--
        © Material Theme
        https://github.com/bollnh/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>





    <link rel="dns-prefetch" href="https://hm.baidu.com"/>

    <link rel="dns-prefetch" href="https://www.google-analytics.com"/>



    <link rel="dns-prefetch" href="https://fonts.proxy.ustclug.org"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            逆向进阶，利用 AST 技术还原 JavaScript 混淆代码 | 
        
        ITBOB&#39;S BLOG
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="BOB 的个人博客；主攻 Python、爬虫、逆向、数据分析、数据可视化；记录毕生所学！">
    <meta name="keywords" content="ITRHX,TRHX,ITBOB,BOB,爬虫,Python爬虫,数据分析,数据可视化,逆向,逆向安全,JS逆向,安卓逆向,Android逆向,APP逆向,Python,JavaScript,JS 逆向,爬虫">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?T9bls9Il4KYK54s9694XsA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?H4vLb99nOZsM9O+Kbkw8rw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/atelier-forest-light.min.css?HdofjyGu7b4PtoyvVcYV4A==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
    body,
    html {
        font-family: Noto Sans SC, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
        overflow-x: hidden !important;
    }
    
    code {
        font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    }
    
    a {
        color: #00838F;
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge {
        background-color: #0097A7 !important;
    }
    /* Sidebar User Drop Down Menu Text Color */
    
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
        color: #0097A7 !important;
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover>a,
    .sidebar-colored .sidebar-nav li:hover>a i,
    .sidebar-colored .sidebar-nav li>a:hover,
    .sidebar-colored .sidebar-nav li>a:hover i,
    .sidebar-colored .sidebar-nav li>a:focus i,
    .sidebar-colored .sidebar-nav>.open>a,
    .sidebar-colored .sidebar-nav>.open>a:hover,
    .sidebar-colored .sidebar-nav>.open>a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
        color: #0097A7 !important;
    }
    
    .toTop {
        background: #757575 !important;
    }
    
    .material-layout .material-post>.material-nav,
    .material-layout .material-index>.material-nav,
    .material-nav a {
        color: #757575;
    }
    
    #scheme-Paradox .MD-burger-layer {
        background-color: #757575;
    }
    
    #scheme-Paradox #post-toc-trigger-btn {
        color: #757575;
    }
    
    .post-toc a:hover {
        color: #00838F;
        text-decoration: underline;
    }
</style>


<!-- Theme Background Related-->

        <style>
            body {
                background-color: #F5F5F5;
            }
            /* blog_info bottom background */
            
            #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
                background-color: #fff;
            }
        </style>
        



                <!-- Fade Effect -->
                
                    <style>
                        .fade {
                            transition: all 800ms linear;
                            -webkit-transform: translate3d(0, 0, 0);
                            -moz-transform: translate3d(0, 0, 0);
                            -ms-transform: translate3d(0, 0, 0);
                            -o-transform: translate3d(0, 0, 0);
                            transform: translate3d(0, 0, 0);
                            opacity: 1;
                        }
                        
                        .fade.out {
                            opacity: 0;
                        }
                    </style>
                    

                        <!-- Import Font -->
                        <!-- Import Roboto -->

    <!-- <link href="https://fonts.proxy.ustclug.org/css?family=ZCOOL%20XiaoWei:300,400,500" rel="stylesheet"> -->
    <link href="https://fonts.proxy.ustclug.org/css?family=Noto+Sans+SC:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>



    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    
    
    <!-- 枫叶飘落 -->
    <script>lsloader.load("undefined","/js/leave.min.js?jxgh475VpQSPx5JpWEZ6lA==", true)</script>

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="ITBOB&#39;S BLOG">
    <meta name="msapplication-starturl" content="https://www.itbob.cn/article/051/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="ITBOB&#39;S BLOG">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    
        
            <link rel=alternate type="application/atom+xml" href="/atom.xml">
        
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://www.itbob.cn/article/051/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="逆向进阶，利用 AST 技术还原 JavaScript 混淆代码 | ITBOB&#39;S BLOG">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="BOB 的个人博客；主攻 Python、爬虫、逆向、数据分析、数据可视化；记录毕生所学！">
    <meta property="og:article:tag" content="JS 逆向"> <meta property="og:article:tag" content="爬虫"> 

    
        <meta property="article:published_time" content="Mon Apr 25 2022 17:00:00 GMT+0800">
        <meta property="article:modified_time" content="Sun May 22 2022 20:49:00 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://www.itbob.cn/article/051/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://www.itbob.cn/article/051/index.html",
    "headline": "逆向进阶，利用 AST 技术还原 JavaScript 混淆代码",
    "datePublished": "Mon Apr 25 2022 17:00:00 GMT+0800",
    "dateModified": "Sun May 22 2022 20:49:00 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "BOB",
        "image": {
            "@type": "ImageObject",
            "url": "/img/BOB.png"
        },
        "description": "Hi, nice to meet you"
    },
    "publisher": {
        "@type": "Organization",
        "name": "ITBOB&#39;S BLOG",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",JS 逆向,爬虫ITRHX,TRHX,ITBOB,BOB,爬虫,Python爬虫,数据分析,数据可视化,逆向,逆向安全,JS逆向,安卓逆向,Android逆向,APP逆向,Python,JavaScript",
    "description": "BOB 的个人博客；主攻 Python、爬虫、逆向、数据分析、数据可视化；记录毕生所学！",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'G-FLNER0M8ML', 'auto');ga('send', 'pageview');
</script>
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?6ca34ddce088f8434f3c7509576819f2';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
    
    

    <!-- Custom Head -->
    

<meta name="generator" content="Hexo 5.4.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-AST"><span class="post-toc-number">1.</span> <span class="post-toc-text">什么是 AST</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#AST-%E5%9C%A8%E7%BC%96%E8%AF%91%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="post-toc-number">2.</span> <span class="post-toc-text">AST 在编译中的位置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">词法分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">语法分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">代码生成</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Babel-%E7%AE%80%E4%BB%8B"><span class="post-toc-number">3.</span> <span class="post-toc-text">Babel 简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel-core"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">@babel&#x2F;core</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel-parser"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">@babel&#x2F;parser</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel-generator"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">@babel&#x2F;generator</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel-traverse"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">@babel&#x2F;traverse</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel-types"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">@babel&#x2F;types</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B8%B8%E8%A7%81%E6%B7%B7%E6%B7%86%E8%BF%98%E5%8E%9F"><span class="post-toc-number">4.</span> <span class="post-toc-text">常见混淆还原</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%98%E5%8E%9F"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">字符串还原</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%98%E5%8E%9F"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">表达式还原</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%A0%E9%99%A4%E6%9C%AA%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">删除未使用变量</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%A0%E9%99%A4%E5%86%97%E4%BD%99%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">删除冗余逻辑代码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#switch-case-%E5%8F%8D%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">switch-case 反控制流平坦化</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="post-toc-number">5.</span> <span class="post-toc-text">参考资料</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#END"><span class="post-toc-number">6.</span> <span class="post-toc-text">END</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 100 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.webp');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                逆向进阶，利用 AST 技术还原 JavaScript 混淆代码
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/BOB.png" width="44px" height="44px" class="itbob-author-avatar" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>BOB</strong>
        <!-- <span>4月 25, 2022</span> -->
        <span>2022-04-25 17:00:00</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!-- <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button> -->
   

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item" style="text-align:center; color:#E30B20; font-weight:600">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACa0lEQVR42u3aQW7DMAwEwPz/0+21QJB0l4xVoxifgsS1NTpI6pKPr399PfDw8PDw8PDw8G7Ge8TX8/0/v3n+/Or5z7++HGg5Njw8PLyTvF+W2he8/PtXU5O/N78HDw8P7yQvH2KyDSTDer9VtGPDw8PDuycvP1i3m8fmmXh4eHh35r1a9NsYoo0q8PDw8O7Jm4UC7weXBK/JkfpQ1oKHh4cX89oC2MnPf1Dfw8PDw3vLGzY2lZvBp8pdddMVHh4e3gW89iicBAT7ktgsmMDDw8M7yWsX5dmBeB9SRHfi4eHhXcybHaDb5TuZoGRjuCSMwMPDwxvxNgWqvGTVbgk5FQ8PD++veEk8kQ9006q1Ou7j4eHhXcxLXpCXrDbNqRsSHh4e3nleO6y2gXXTyFW/HQ8PD+8ILy9utQ0EbYtqcgT/5W/x8PDwjvDyqy2AzZoPZlsCHh4e3kne8N/+9UG53X6iTQUPDw/vYt5s4U5KVu0Gs4kn8PDw8E7y6gPrIqLNWwRmE4GHh4d3hpdQ85astokqn4487MDDw8O7mjcrNbVTsDm4XxLj4uHh4X2Ul4cICXt/gM6fg4eHh3cHXlvumv3axrV1jIuHh4d3AW/4oCRUDWLctgmsDiPw8PDwPsrbN1rNFvf8iNyGHXh4eHhX82ZtUpsC/yY4jiYCDw8P7wivLVPlccM+pMjDZTw8PLzzvFm5a/+0dlKGBTA8PDy82/BmTQZJEW74Kx4eHt7NeO2xexb+zkpieHh4eOd5ydDzmCC5vy224eHh4d2Htwle2yaDfOlvpwMPDw/vDO//XXh4eHh4eHh4eDe4vgHuuB/rai6vSwAAAABJRU5ErkJggg==">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-none-link" href="/tags/JS-%E9%80%86%E5%90%91/" rel="tag">JS 逆向</a></li><li class="mdl-menu__item"><a class="post_tag-none-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    <!-- Leancloud Views -->
    <!--  -->
    
    
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span class="post-count">本文字数&nbsp;7.1k 字</span>
        </li>
    </a>
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span class="post-count">阅读时长&nbsp;30 分</span>
        </li>
    </a>
    
    <!-- Busuanzi Views -->
    
        
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        本文浏览量&nbsp;<span id="busuanzi_value_page_pv"></span>
                    </span>
                </li>
            </a>
        
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=ITBOB&#39;S BLOG&title=逆向进阶，利用 AST 技术还原 JavaScript 混淆代码&summary=BOB 的个人博客；主攻 Python、爬虫、逆向、数据分析、数据可视化；记录毕生所学！&pics=https://www.itbob.cn/img/favicon.png&url=https://www.itbob.cn/article/051/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=逆向进阶，利用 AST 技术还原 JavaScript 混淆代码&url=https://www.itbob.cn/article/051/index.html&pic=https://www.itbob.cn/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=逆向进阶，利用 AST 技术还原 JavaScript 混淆代码&url=https://www.itbob.cn/article/051/index.html&via=BOB" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=https://www.itbob.cn/article/051/index.html&text=逆向进阶，利用 AST 技术还原 JavaScript 混淆代码" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://www.itbob.cn/article/051/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.itbob.cn/article/051/index.html&title=逆向进阶，利用 AST 技术还原 JavaScript 混淆代码" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    


    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://www.itbob.cn/article/051/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="什么是-AST"><a href="#什么是-AST" class="headerlink" title="什么是 AST"></a>什么是 AST</h2><p>AST（Abstract Syntax Tree），中文抽象语法树，简称语法树（Syntax Tree），是源代码的抽象语法结构的树状表现形式，树上的每个节点都表示源代码中的一种结构。语法树不是某一种编程语言独有的，JavaScript、Python、Java、Golang 等几乎所有编程语言都有语法树。</p>
<p>小时候我们得到一个玩具，总喜欢把玩具拆解成一个一个小零件，然后按照我们自己的想法，把零件重新组装起来，一个新玩具就诞生了。而 JavaScript 就像一台精妙运作的机器，通过 AST 解析，我们也可以像童年时拆解玩具一样，深入了解 JavaScript 这台机器的各个零部件，然后重新按照我们自己的意愿来组装。</p>
<p>AST 的用途很广，IDE 的语法高亮、代码检查、格式化、压缩、转译等，都需要先将代码转化成 AST 再进行后续的操作，ES5 和 ES6 语法差异，为了向后兼容，在实际应用中需要进行语法的转换，也会用到 AST。AST 并不是为了逆向而生，但做逆向学会了 AST，在解混淆时可以如鱼得水。</p>
<p>AST 有一个在线解析网站：<a target="_blank" rel="noopener" href="https://astexplorer.net/">https://astexplorer.net/</a> ，顶部可以选择语言、编译器、是否开启转化等，如下图所示，区域①是源代码，区域②是对应的 AST 语法树，区域③是转换代码，可以对语法树进行各种操作，区域④是转换后生成的新代码。图中原来的 Unicode 字符经过操作之后就变成了正常字符。</p>
<p>语法树没有单一的格式，选择不同的语言、不同的编译器，得到的结果也是不一样的，在 JavaScript 中，编译器有 Acorn、Espree、Esprima、Recast、Uglify-JS 等，使用最多的是 Babel，后续的学习也是以 Babel 为例。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/3e56f2edec502087a2bb0b10ef178b52.png" alt="01"></p>
<h2 id="AST-在编译中的位置"><a href="#AST-在编译中的位置" class="headerlink" title="AST 在编译中的位置"></a>AST 在编译中的位置</h2><p>在编译原理中，编译器转换代码通常要经过三个步骤：词法分析（Lexical Analysis）、语法分析（Syntax Analysis）、代码生成（Code Generation），下图生动展示了这一过程：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/90fe33b7b362f60e1ee1849bf3c06fc9.png" alt="02"></p>
<h3 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h3><p>词法分析阶段是编译过程的第一个阶段，这个阶段的任务是从左到右一个字符一个字符地读入源程序，然后根据构词规则识别单词，生成 token 符号流，比如 <code>isPanda(&#39;🐼&#39;)</code>，会被拆分成 <code>isPanda</code>，<code>(</code>，<code>&#39;🐼&#39;</code>，<code>)</code> 四部分，每部分都有不同的含义，可以将词法分析过程想象为不同类型标记的列表或数组。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/de8a6906cf7db9be51ef2eb56cbd1b70.gif#pic_center" alt="03"></p>
<h3 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h3><p>语法分析是编译过程的一个逻辑阶段，语法分析的任务是在词法分析的基础上将单词序列组合成各类语法短语，比如“程序”，“语句”，“表达式”等，前面的例子中，<code>isPanda(&#39;🐼&#39;)</code> 就会被分析为一条表达语句 <code>ExpressionStatement</code>，<code>isPanda()</code> 就会被分析成一个函数表达式 <code>CallExpression</code>，<code>🐼</code> 就会被分析成一个变量 <code>Literal</code> 等，众多语法之间的依赖、嵌套关系，就构成了一个树状结构，即 AST 语法树。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/45b5484465969681707f32a2dde5370b.gif#pic_center" alt="04"></p>
<h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>代码生成是最后一步，将 AST 语法树转换成可执行代码即可，在转换之前，我们可以直接操作语法树，进行增删改查等操作，例如，我们可以确定变量的声明位置、更改变量的值、删除某些节点等，我们将语句 <code>isPanda(&#39;🐼&#39;)</code> 修改为一个布尔类型的 <code>Literal</code>：<code>true</code>，语法树就有如下变化：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6659a4f8614b61a4d6376aadca326f88.gif#pic_center" alt="05"></p>
<h2 id="Babel-简介"><a href="#Babel-简介" class="headerlink" title="Babel 简介"></a>Babel 简介</h2><p>Babel 是一个 JavaScript 编译器，也可以说是一个解析库，Babel 中文网：<a target="_blank" rel="noopener" href="https://www.babeljs.cn/">https://www.babeljs.cn/</a> ，Babel 英文官网：<a target="_blank" rel="noopener" href="https://babeljs.io/">https://babeljs.io/</a> ，Babel 内置了很多分析 JavaScript 代码的方法，我们可以利用 Babel 将 JavaScript 代码转换成 AST 语法树，然后增删改查等操作之后，再转换成 JavaScript 代码。</p>
<p>Babel 包含的各种功能包、API、各方法可选参数等，都非常多，本文不一一列举，在实际使用过程中，应当多查询官方文档，或者参考文末给出的一些学习资料。Babel 的安装和其他 Node 包一样，需要哪个安装哪个即可，比如 <code>npm install @babel/core @babel/parser @babel/traverse @babel/generator</code></p>
<p>在做逆向解混淆中，主要用到了 Babel 的以下几个功能包，本文也仅介绍以下几个功能包：</p>
<ol>
<li><code>@babel/core</code>：Babel 编译器本身，提供了 babel 的编译 API；</li>
<li><code>@babel/parser</code>：将 JavaScript 代码解析成 AST 语法树；</li>
<li><code>@babel/traverse</code>：遍历、修改 AST 语法树的各个节点；</li>
<li><code>@babel/generator</code>：将 AST 还原成 JavaScript 代码；</li>
<li><code>@babel/types</code>：判断、验证节点的类型、构建新 AST 节点等。</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f8be61bdf850b955459dd4d476f80822.png" alt="06"></p>
<h3 id="babel-core"><a href="#babel-core" class="headerlink" title="@babel/core"></a>@babel/core</h3><p>Babel 编译器本身，被拆分成了三个模块：<code>@babel/parser</code>、<code>@babel/traverse</code>、<code>@babel/generator</code>，比如以下方法的导入效果都是一样的：</p>
<pre><code class="javascript">const parse = require(&quot;@babel/parser&quot;).parse;
const parse = require(&quot;@babel/core&quot;).parse;

const traverse = require(&quot;@babel/traverse&quot;).default
const traverse = require(&quot;@babel/core&quot;).traverse
</code></pre>
<h3 id="babel-parser"><a href="#babel-parser" class="headerlink" title="@babel/parser"></a>@babel/parser</h3><p><code>@babel/parser</code> 可以将 JavaScript 代码解析成 AST 语法树，其中主要提供了两个方法：</p>
<ul>
<li><code>parser.parse(code, [&#123;options&#125;])</code>：解析一段 JavaScript 代码；</li>
<li><code>parser.parseExpression(code, [&#123;options&#125;])</code>：考虑到了性能问题，解析单个 JavaScript 表达式。</li>
</ul>
<p>部分可选参数 <code>options</code>：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>allowImportExportEverywhere</code></td>
<td>默认 <code>import</code> 和 <code>export</code> 声明语句只能出现在程序的最顶层，设置为 <code>true</code> 则在任何地方都可以声明</td>
</tr>
<tr>
<td><code>allowReturnOutsideFunction</code></td>
<td>默认如果在顶层中使用 <code>return</code> 语句会引起错误，设置为 <code>true</code> 就不会报错</td>
</tr>
<tr>
<td><code>sourceType</code></td>
<td>默认为 <code>script</code>，当代码中含有 <code>import</code> 、<code>export</code> 等关键字时会报错，需要指定为 <code>module</code></td>
</tr>
<tr>
<td><code>errorRecovery</code></td>
<td>默认如果 babel 发现一些不正常的代码就会抛出错误，设置为 <code>true</code> 则会在保存解析错误的同时继续解析代码，错误的记录将被保存在最终生成的 AST 的 errors 属性中，当然如果遇到严重的错误，依然会终止解析</td>
</tr>
</tbody></table>
<p>举个例子看得比较清楚：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);

const code = &quot;const a = 1;&quot;;
const ast = parser.parse(code, &#123;sourceType: &quot;module&quot;&#125;)
console.log(ast)
</code></pre>
<p><code>&#123;sourceType: &quot;module&quot;&#125;</code> 演示了如何添加可选参数，输出的就是 AST 语法树，这和在线网站 <a target="_blank" rel="noopener" href="https://astexplorer.net/">https://astexplorer.net/</a> 解析出来的语法树是一样的：</p>
<p><img src="https://img-blog.csdnimg.cn/cb7791be87be4a4c8f47add3228e3d58.png" alt="07"></p>
<h3 id="babel-generator"><a href="#babel-generator" class="headerlink" title="@babel/generator"></a>@babel/generator</h3><p><code>@babel/generator</code> 可以将 AST 还原成 JavaScript 代码，提供了一个 <code>generate</code> 方法：<code>generate(ast, [&#123;options&#125;], code)</code>。</p>
<p>部分可选参数 <code>options</code>：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>auxiliaryCommentBefore</code></td>
<td>在输出文件内容的头部添加注释块文字</td>
</tr>
<tr>
<td><code>auxiliaryCommentAfter</code></td>
<td>在输出文件内容的末尾添加注释块文字</td>
</tr>
<tr>
<td><code>comments</code></td>
<td>输出内容是否包含注释</td>
</tr>
<tr>
<td><code>compact</code></td>
<td>输出内容是否不添加空格，避免格式化</td>
</tr>
<tr>
<td><code>concise</code></td>
<td>输出内容是否减少空格使其更紧凑一些</td>
</tr>
<tr>
<td><code>minified</code></td>
<td>是否压缩输出代码</td>
</tr>
<tr>
<td><code>retainLines</code></td>
<td>尝试在输出代码中使用与源代码中相同的行号</td>
</tr>
</tbody></table>
<p>接着前面的例子，原代码是 <code>const a = 1;</code>，现在我们把 <code>a</code> 变量修改为 <code>b</code>，值 <code>1</code> 修改为 <code>2</code>，然后将 AST 还原生成新的 JS 代码：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default

const code = &quot;const a = 1;&quot;;
const ast = parser.parse(code, &#123;sourceType: &quot;module&quot;&#125;)
ast.program.body[0].declarations[0].id.name = &quot;b&quot;
ast.program.body[0].declarations[0].init.value = 2
const result = generate(ast, &#123;minified: true&#125;)

console.log(result.code)
</code></pre>
<p>最终输出的是 <code>const b=2;</code>，变量名和值都成功更改了，由于加了压缩处理，等号左右两边的空格也没了。</p>
<p>代码里 <code>&#123;minified: true&#125;</code> 演示了如何添加可选参数，这里表示压缩输出代码，<code>generate</code> 得到的 <code>result</code> 得到的是一个对象，其中的 <code>code</code> 属性才是最终的 JS 代码。</p>
<p>代码里 <code>ast.program.body[0].declarations[0].id.name</code> 是 a 在 AST 中的位置，<code>ast.program.body[0].declarations[0].init.value</code> 是 1 在 AST 中的位置，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/0ffbf3d9a54e2de3c779735aeac0e3e4.png" alt="08"></p>
<h3 id="babel-traverse"><a href="#babel-traverse" class="headerlink" title="@babel/traverse"></a>@babel/traverse</h3><p>当代码多了，我们不可能像前面那样挨个定位并修改，对于相同类型的节点，我们可以直接遍历所有节点来进行修改，这里就用到了 <code>@babel/traverse</code>，它通常和 <code>visitor</code> 一起使用，<code>visitor</code> 是一个对象，这个名字是可以随意取的，<code>visitor</code> 里可以定义一些方法来过滤节点，这里还是用一个例子来演示：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default

const code = `
const a = 1500;
const b = 60;
const c = &quot;hi&quot;;
const d = 787;
const e = &quot;1244&quot;;
`
const ast = parser.parse(code)

const visitor = &#123;
    NumericLiteral(path)&#123;
        path.node.value = (path.node.value + 100) * 2
    &#125;,
    StringLiteral(path)&#123;
        path.node.value = &quot;I Love JavaScript!&quot;
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>这里的原始代码定义了 abcde 五个变量，其值有数字也有字符串，我们在 AST 中可以看到对应的类型为 <code>NumericLiteral</code> 和 <code>StringLiteral</code>：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/b0a932b29fef0ad7a6f20dbc88f3ec46.png" alt="09"></p>
<p>然后我们声明了一个 <code>visitor</code> 对象，然后定义对应类型的处理方法，<code>traverse</code> 接收两个参数，第一个是 AST 对象，第二个是 <code>visitor</code>，当 <code>traverse</code> 遍历所有节点，遇到节点类型为 <code>NumericLiteral</code> 和 <code>StringLiteral</code> 时，就会调用 <code>visitor</code> 中对应的处理方法，<code>visitor</code> 中的方法会接收一个当前节点的 <code>path</code> 对象，该对象的类型是 <code>NodePath</code>，该对象有非常多的属性，以下介绍几种最常用的：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>toString()</code></td>
<td>当前路径的源码</td>
</tr>
<tr>
<td><code>node</code></td>
<td>当前路径的节点</td>
</tr>
<tr>
<td><code>parent</code></td>
<td>当前路径的父级节点</td>
</tr>
<tr>
<td><code>parentPath</code></td>
<td>当前路径的父级路径</td>
</tr>
<tr>
<td><code>type</code></td>
<td>当前路径的类型</td>
</tr>
</tbody></table>
<p>PS：<code>path</code> 对象除了有很多属性以外，还有很多方法，比如替换节点、删除节点、插入节点、寻找父级节点、获取同级节点、添加注释、判断节点类型等，可在需要时查询相关文档或查看源码，后续介绍 <code>@babel/types</code> 部分将会举部分例子来演示，以后的实战文章中也会有相关实例，篇幅有限本文不再细说。</p>
<p>因此在上面的代码中，<code>path.node.value</code> 就拿到了变量的值，然后我们就可以进一步对其进行修改了。以上代码运行后，所有数字都会加上100后再乘以2，所有字符串都会被替换成 <code>I Love JavaScript!</code>，结果如下：</p>
<pre><code class="javascript">const a = 3200;
const b = 320;
const c = &quot;I Love JavaScript!&quot;;
const d = 1774;
const e = &quot;I Love JavaScript!&quot;;
</code></pre>
<p>如果多个类型的节点，处理的方式都一样，那么还可以使用 <code>|</code> 将所有节点连接成字符串，将同一个方法应用到所有节点：</p>
<pre><code class="javascript">const visitor = &#123;
    &quot;NumericLiteral|StringLiteral&quot;(path) &#123;
        path.node.value = &quot;I Love JavaScript!&quot;
    &#125;
&#125;
</code></pre>
<p><code>visitor</code> 对象有多种写法，以下几种写法的效果都是一样的：</p>
<pre><code class="javascript">const visitor = &#123;
    NumericLiteral(path)&#123;
        path.node.value = (path.node.value + 100) * 2
    &#125;,
    StringLiteral(path)&#123;
        path.node.value = &quot;I Love JavaScript!&quot;
    &#125;
&#125;
</code></pre>
<pre><code class="javascript">const visitor = &#123;
    NumericLiteral: function (path)&#123;
        path.node.value = (path.node.value + 100) * 2
    &#125;,
    StringLiteral: function (path)&#123;
        path.node.value = &quot;I Love JavaScript!&quot;
    &#125;
&#125;
</code></pre>
<pre><code class="javascript">const visitor = &#123;
    NumericLiteral: &#123;
        enter(path) &#123;
            path.node.value = (path.node.value + 100) * 2
        &#125;
    &#125;,
    StringLiteral: &#123;
        enter(path) &#123;
            path.node.value = &quot;I Love JavaScript!&quot;
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="javascript">const visitor = &#123;
    enter(path) &#123;
        if (path.node.type === &quot;NumericLiteral&quot;) &#123;
            path.node.value = (path.node.value + 100) * 2
        &#125;
        if (path.node.type === &quot;StringLiteral&quot;) &#123;
            path.node.value = &quot;I Love JavaScript!&quot;
        &#125;
    &#125;
&#125;
</code></pre>
<p>以上几种写法中有用到了 <code>enter</code> 方法，在节点的遍历过程中，进入节点（enter）与退出（exit）节点都会访问一次节点，<code>traverse</code> 默认在进入节点时进行节点的处理，如果要在退出节点时处理，那么在 <code>visitor</code> 中就必须声明 <code>exit</code> 方法。</p>
<h3 id="babel-types"><a href="#babel-types" class="headerlink" title="@babel/types"></a>@babel/types</h3><p><code>@babel/types</code> 主要用于构建新的 AST 节点，前面的示例代码为 <code>const a = 1;</code>，如果想要增加内容，比如变成 <code>const a = 1; const b = a * 5 + 1;</code>，就可以通过 <code>@babel/types</code> 来实现。</p>
<p>首先观察一下 AST 语法树，原语句只有一个 <code>VariableDeclaration</code> 节点，现在增加了一个：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7319ba7290bf4d5c94d86c3c0d89e288.png" alt="10"></p>
<p>那么我们的思路就是在遍历节点时，遍历到 <code>VariableDeclaration</code> 节点，就在其后面增加一个 <code>VariableDeclaration</code> 节点，生成  <code>VariableDeclaration</code> 节点，可以使用 <code>types.variableDeclaration()</code> 方法，在 types 中各种方法名称和我们在 AST 中看到的是一样的，只不过首字母是小写的，所以我们不需要知道所有方法的情况下，也能大致推断其方法名，只知道这个方法还不行，还得知道传入的参数是什么，可以查文档，不过这里推荐直接看源码，非常清晰明了，以 Pycharm 为例，按住 Ctrl 键，再点击方法名，就进到源码里了：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/59b5979bae2fa54c199c8040f2442d04.png" alt="11"></p>
<pre><code class="javascript">function variableDeclaration(kind: &quot;var&quot; | &quot;let&quot; | &quot;const&quot;, declarations: Array&lt;BabelNodeVariableDeclarator&gt;)
</code></pre>
<p>可以看到需要 <code>kind</code> 和 <code>declarations</code> 两个参数，其中 <code>declarations</code> 是 <code>VariableDeclarator</code> 类型的节点组成的列表，所以我们可以先写出以下 <code>visitor</code> 部分的代码，其中 <code>path.insertAfter()</code> 是在该节点之后插入新节点的意思：</p>
<pre><code class="javascript">const visitor = &#123;
    VariableDeclaration(path) &#123;
        let declaration = types.variableDeclaration(&quot;const&quot;, [declarator])
        path.insertAfter(declaration)
    &#125;
&#125;
</code></pre>
<p>接下来我们还需要进一步定义 <code>declarator</code>，也就是 <code>VariableDeclarator</code> 类型的节点，查询其源码如下：</p>
<pre><code class="javascript">function variableDeclarator(id: BabelNodeLVal, init?: BabelNodeExpression)
</code></pre>
<p>观察 AST，id 为 <code>Identifier</code> 对象，init 为 <code>BinaryExpression</code> 对象，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/050533c545ec5244818054a2e2572cc4.png" alt="12"></p>
<p>先来处理 id，可以使用 <code>types.identifier()</code> 方法来生成，其源码为 <code>function identifier(name: string)</code>，name 在这里就是 b 了，此时 <code>visitor</code> 代码就可以这么写：</p>
<pre><code class="javascript">const visitor = &#123;
    VariableDeclaration(path) &#123;
        let declarator = types.variableDeclarator(types.identifier(&quot;b&quot;), init)
        let declaration = types.variableDeclaration(&quot;const&quot;, [declarator])
        path.insertAfter(declaration)
    &#125;
&#125;
</code></pre>
<p>然后再来看 init 该如何定义，首先仍然是看 AST 结构：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a927d6abed41d43251e3c3c2a432e46f.png" alt="13"></p>
<p>init 为 <code>BinaryExpression</code> 对象，left 左边是 <code>BinaryExpression</code>，right 右边是 <code>NumericLiteral</code>，可以用 <code>types.binaryExpression()</code> 方法来生成 init，其源码如下：</p>
<pre><code class="javascript">function binaryExpression(
    operator: &quot;+&quot; | &quot;-&quot; | &quot;/&quot; | &quot;%&quot; | &quot;*&quot; | &quot;**&quot; | &quot;&amp;&quot; | &quot;|&quot; | &quot;&gt;&gt;&quot; | &quot;&gt;&gt;&gt;&quot; | &quot;&lt;&lt;&quot; | &quot;^&quot; | &quot;==&quot; | &quot;===&quot; | &quot;!=&quot; | &quot;!==&quot; | &quot;in&quot; | &quot;instanceof&quot; | &quot;&gt;&quot; | &quot;&lt;&quot; | &quot;&gt;=&quot; | &quot;&lt;=&quot;,
    left: BabelNodeExpression | BabelNodePrivateName, 
    right: BabelNodeExpression
)
</code></pre>
<p>此时 <code>visitor</code> 代码就可以这么写：</p>
<pre><code class="javascript">const visitor = &#123;
    VariableDeclaration(path) &#123;
        let init = types.binaryExpression(&quot;+&quot;, left, right)
        let declarator = types.variableDeclarator(types.identifier(&quot;b&quot;), init)
        let declaration = types.variableDeclaration(&quot;const&quot;, [declarator])
        path.insertAfter(declaration)
    &#125;
&#125;
</code></pre>
<p>然后继续构造 left 和 right，和前面的方法一样，观察 AST 语法树，查询对应方法应该传入的参数，层层嵌套，直到把所有的节点都构造完毕，最终的 <code>visitor</code> 代码应该是这样的：</p>
<pre><code class="javascript">const visitor = &#123;
    VariableDeclaration(path) &#123;
        let left = types.binaryExpression(&quot;*&quot;, types.identifier(&quot;a&quot;), types.numericLiteral(5))
        let right = types.numericLiteral(1)
        let init = types.binaryExpression(&quot;+&quot;, left, right)
        let declarator = types.variableDeclarator(types.identifier(&quot;b&quot;), init)
        let declaration = types.variableDeclaration(&quot;const&quot;, [declarator])
        path.insertAfter(declaration)
        path.stop()
    &#125;
&#125;
</code></pre>
<p>注意：<code>path.insertAfter()</code> 插入节点语句后面加了一句 <code>path.stop()</code>，表示插入完成后立即停止遍历当前节点和后续的子节点，添加的新节点也是 <code>VariableDeclaration</code>，如果不加停止语句的话，就会无限循环插入下去。</p>
<p>插入新节点后，再转换成 JavaScript 代码，就可以看到多了一行新代码，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/79269e1d54071214b2438eed3bf58d15.png" alt="14"></p>
<h2 id="常见混淆还原"><a href="#常见混淆还原" class="headerlink" title="常见混淆还原"></a>常见混淆还原</h2><p>了解了 AST 和 babel 后，就可以对 JavaScript 混淆代码进行还原了，以下是部分样例，带你进一步熟悉 babel 的各种操作。</p>
<h3 id="字符串还原"><a href="#字符串还原" class="headerlink" title="字符串还原"></a>字符串还原</h3><p>文章开头的图中举了个例子，正常字符被换成了 Unicode 编码：</p>
<pre><code class="javascript">console[&#39;\u006c\u006f\u0067&#39;](&#39;\u0048\u0065\u006c\u006c\u006f\u0020\u0077\u006f\u0072\u006c\u0064\u0021&#39;)
</code></pre>
<p>观察 AST 结构：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/59b4fc53c0c3aa2a0873a76a5d88c175.png" alt="15"></p>
<p>我们发现 Unicode 编码对应的是 <code>raw</code>，而 <code>rawValue</code> 和 <code>value</code> 都是正常的，所以我们可以将 <code>raw</code> 替换成 <code>rawValue</code> 或 <code>value</code> 即可，需要注意的是引号的问题，本来是 <code>console[&quot;log&quot;]</code>，你还原后变成了 <code>console[log]</code>，自然会报错的，除了替换值以外，这里直接删除 extra 节点，或者删除 raw 值也是可以的，所以以下几种写法都可以还原代码：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default

const code = `console[&#39;\u006c\u006f\u0067&#39;](&#39;\u0048\u0065\u006c\u006c\u006f\u0020\u0077\u006f\u0072\u006c\u0064\u0021&#39;)`
const ast = parser.parse(code)

const visitor = &#123;
    StringLiteral(path) &#123;
        // 以下方法均可
        // path.node.extra.raw = path.node.rawValue
        // path.node.extra.raw = &#39;&quot;&#39; + path.node.value + &#39;&quot;&#39;
        // delete path.node.extra
        delete path.node.extra.raw
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>还原结果：</p>
<pre><code class="javascript">console[&quot;log&quot;](&quot;Hello world!&quot;);
</code></pre>
<h3 id="表达式还原"><a href="#表达式还原" class="headerlink" title="表达式还原"></a>表达式还原</h3><p>之前写过 <a target="_blank" rel="noopener" href="https://itrhx.blog.csdn.net/article/details/122057377">JSFuck 混淆的还原</a>，其中有介绍 <code>![]</code> 可表示 false，<code>!![]</code> 或者 <code>!+[]</code> 可表示 true，在一些混淆代码中，经常有这些操作，把简单的表达式复杂化，往往需要执行一下语句，才能得到真正的结果，示例代码如下：</p>
<pre><code class="javascript">const a = !![]+!![]+!![];
const b = Math.floor(12.34 * 2.12)
const c = 10 &gt;&gt; 3 &lt;&lt; 1
const d = String(21.3 + 14 * 1.32)
const e = parseInt(&quot;1.893&quot; + &quot;45.9088&quot;)
const f = parseFloat(&quot;23.2334&quot; + &quot;21.89112&quot;)
const g = 20 &lt; 18 ? &#39;未成年&#39; : &#39;成年&#39;
</code></pre>
<p>想要执行语句，我们需要了解 <code>path.evaluate()</code> 方法，该方法会对 path 对象进行执行操作，自动计算出结果，返回一个对象，其中的 <code>confident</code> 属性表示置信度，<code>value</code> 表示计算结果，使用 <code>types.valueToNode()</code> 方法创建节点，使用 <code>path.replaceInline()</code> 方法将节点替换成计算结果生成的新节点，替换方法有一下几种：</p>
<ul>
<li><code>replaceWith</code>：用一个节点替换另一个节点；</li>
<li><code>replaceWithMultiple</code>：用多个节点替换另一个节点；</li>
<li><code>replaceWithSourceString</code>：将传入的源码字符串解析成对应 Node 后再替换，性能较差，不建议使用；</li>
<li><code>replaceInline</code>：用一个或多个节点替换另一个节点，相当于同时有了前两个函数的功能。</li>
</ul>
<p>对应的 AST 处理代码如下：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default
const types = require(&quot;@babel/types&quot;)

const code = `
const a = !![]+!![]+!![];
const b = Math.floor(12.34 * 2.12)
const c = 10 &gt;&gt; 3 &lt;&lt; 1
const d = String(21.3 + 14 * 1.32)
const e = parseInt(&quot;1.893&quot; + &quot;45.9088&quot;)
const f = parseFloat(&quot;23.2334&quot; + &quot;21.89112&quot;)
const g = 20 &lt; 18 ? &#39;未成年&#39; : &#39;成年&#39;
`
const ast = parser.parse(code)

const visitor = &#123;
    &quot;BinaryExpression|CallExpression|ConditionalExpression&quot;(path) &#123;
        const &#123;confident, value&#125; = path.evaluate()
        if (confident)&#123;
            path.replaceInline(types.valueToNode(value))
        &#125;
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>最终结果：</p>
<pre><code class="javascript">const a = 3;
const b = 26;
const c = 2;
const d = &quot;39.78&quot;;
const e = parseInt(&quot;1.89345.9088&quot;);
const f = parseFloat(&quot;23.233421.89112&quot;);
const g = &quot;\u6210\u5E74&quot;;
</code></pre>
<h3 id="删除未使用变量"><a href="#删除未使用变量" class="headerlink" title="删除未使用变量"></a>删除未使用变量</h3><p>有时候代码里会有一些并没有使用到的多余变量，删除这些多余变量有助于更加高效的分析代码，示例代码如下：</p>
<pre><code class="javascript">const a = 1;
const b = a * 2;
const c = 2;
const d = b + 1;
const e = 3;
console.log(d)
</code></pre>
<p>删除多余变量，首先要了解 <code>NodePath</code> 中的 <code>scope</code>，<code>scope</code> 的作用主要是查找标识符的作用域、获取并修改标识符的所有引用等，删除未使用变量主要用到了 <code>scope.getBinding()</code> 方法，传入的值是当前节点能够引用到的标识符名称，返回的关键属性有以下几个：</p>
<ul>
<li><code>identifier</code>：标识符的 Node 对象；</li>
<li><code>path</code>：标识符的 NodePath 对象；</li>
<li><code>constant</code>：标识符是否为常量；</li>
<li><code>referenced</code>：标识符是否被引用；</li>
<li><code> references</code>：标识符被引用的次数；</li>
<li><code>constantViolations</code>：如果标识符被修改，则会存放所有修改该标识符节点的 Path 对象；</li>
<li><code>referencePaths</code>：如果标识符被引用，则会存放所有引用该标识符节点的 Path 对象。</li>
</ul>
<p>所以我们可以通过 <code>constantViolations</code>、<code>referenced</code>、<code>references</code>、<code>referencePaths</code> 多个参数来判断变量是否可以被删除，AST 处理代码如下：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default

const code = `
const a = 1;
const b = a * 2;
const c = 2;
const d = b + 1;
const e = 3;
console.log(d)
`
const ast = parser.parse(code)

const visitor = &#123;
    VariableDeclarator(path)&#123;
        const binding = path.scope.getBinding(path.node.id.name);

        // 如标识符被修改过，则不能进行删除动作。
        if (!binding || binding.constantViolations.length &gt; 0) &#123;
            return;
        &#125;

        // 未被引用
        if (!binding.referenced) &#123;
            path.remove();
        &#125;

        // 被引用次数为0
        // if (binding.references === 0) &#123;
        //     path.remove();
        // &#125;

        // 长度为0，变量没有被引用过
        // if (binding.referencePaths.length === 0) &#123;
        //     path.remove();
        // &#125;
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>处理后的代码（未使用的 b、c、e 变量已被删除）：</p>
<pre><code class="javascript">const a = 1;
const b = a * 2;
const d = b + 1;
console.log(d);
</code></pre>
<h3 id="删除冗余逻辑代码"><a href="#删除冗余逻辑代码" class="headerlink" title="删除冗余逻辑代码"></a>删除冗余逻辑代码</h3><p>有时候为了增加逆向难度，会有很多嵌套的 if-else 语句，大量判断为假的冗余逻辑代码，同样可以利用 AST 将其删除掉，只留下判断为真的，示例代码如下：</p>
<pre><code class="javascript">const example = function () &#123;
    let a;
    if (false) &#123;
        a = 1;
    &#125; else &#123;
        if (1) &#123;
            a = 2;
        &#125;
        else &#123;
            a = 3;
        &#125;
    &#125;
    return a;
&#125;;
</code></pre>
<p>观察 AST，判断条件对应的是 <code>test</code> 节点，if 对应的是 <code>consequent</code> 节点，else 对应的是 <code>alternate</code> 节点，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/11bee2b313c5327859074428625a9348.png" alt="16"></p>
<p>AST 处理思路以及代码：</p>
<ol>
<li>筛选出 <code>BooleanLiteral</code> 和 <code>NumericLiteral</code> 节点，取其对应的值，即 <code>path.node.test.value</code>；</li>
<li>判断 <code>value</code> 值为真，则将节点替换成 <code>consequent</code> 节点下的内容，即 <code>path.node.consequent.body</code>；</li>
<li>判断 <code>value</code> 值为假，则替换成 <code>alternate</code> 节点下的内容，即 <code>path.node.alternate.body</code>；</li>
<li>有的 if 语句可能没有写 else，也就没有 <code>alternate</code>，所以这种情况下判断 <code>value</code> 值为假，则直接移除该节点，即 <code>path.remove()</code></li>
</ol>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default
const types = require(&#39;@babel/types&#39;);

const code = `
const example = function () &#123;
    let a;
    if (false) &#123;
        a = 1;
    &#125; else &#123;
        if (1) &#123;
            a = 2;
        &#125;
        else &#123;
            a = 3;
        &#125;
    &#125;
    return a;
&#125;;
`
const ast = parser.parse(code)

const visitor = &#123;
    enter(path) &#123;
        if (types.isBooleanLiteral(path.node.test) || types.isNumericLiteral(path.node.test)) &#123;
            if (path.node.test.value) &#123;
                path.replaceInline(path.node.consequent.body);
            &#125; else &#123;
                if (path.node.alternate) &#123;
                    path.replaceInline(path.node.alternate.body);
                &#125; else &#123;
                    path.remove()
                &#125;
            &#125;
        &#125;
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>处理结果：</p>
<pre><code class="javascript">const example = function () &#123;
  let a;
  a = 2;
  return a;
&#125;;
</code></pre>
<h3 id="switch-case-反控制流平坦化"><a href="#switch-case-反控制流平坦化" class="headerlink" title="switch-case 反控制流平坦化"></a>switch-case 反控制流平坦化</h3><p>控制流平坦化是混淆当中最常见的，通过 <code>if-else</code> 或者 <code>while-switch-case</code> 语句分解步骤，示例代码：</p>
<pre><code class="javascript">const _0x34e16a = &#39;3,4,0,5,1,2&#39;[&#39;split&#39;](&#39;,&#39;);
let _0x2eff02 = 0x0;
while (!![]) &#123;
    switch (_0x34e16a[_0x2eff02++]) &#123;
        case&#39;0&#39;:
            let _0x38cb15 = _0x4588f1 + _0x470e97;
            continue;
        case&#39;1&#39;:
            let _0x1e0e5e = _0x37b9f3[_0x50cee0(0x2e0, 0x2e8, 0x2e1, 0x2e4)];
            continue;
        case&#39;2&#39;:
            let _0x35d732 = [_0x388d4b(-0x134, -0x134, -0x139, -0x138)](_0x38cb15 &gt;&gt; _0x4588f1);
            continue;
        case&#39;3&#39;:
            let _0x4588f1 = 0x1;
            continue;
        case&#39;4&#39;:
            let _0x470e97 = 0x2;
            continue;
        case&#39;5&#39;:
            let _0x37b9f3 = 0x5 || _0x38cb15;
            continue;
    &#125;
    break;
&#125;
</code></pre>
<p>AST 还原思路：</p>
<ol>
<li>获取控制流原始数组，将 <code>&#39;3,4,0,5,1,2&#39;[&#39;split&#39;](&#39;,&#39;)</code> 之类的语句转化成 <code>[&#39;3&#39;,&#39;4&#39;,&#39;0&#39;,&#39;5&#39;,&#39;1&#39;,&#39;2&#39;]</code> 之类的数组，得到该数组之后，也可以选择把 split 语句对应的节点删除掉，因为最终代码里这条语句就没用了；</li>
<li>遍历第一步得到的控制流数组，依次取出每个值所对应的 case 节点；</li>
<li>定义一个数组，储存每个 case 节点 <code>consequent</code> 数组里面的内容，并删除 <code>continue</code> 语句对应的节点；</li>
<li>遍历完成后，将第三步的数组替换掉整个 while 节点，也就是 <code>WhileStatement</code>。</li>
</ol>
<p>不同思路，写法多样，对于如何获取控制流数组，可以有以下思路：</p>
<ol>
<li>获取到 <code>While</code> 语句节点，然后使用 <code>path.getAllPrevSiblings()</code> 方法获取其前面的所有兄弟节点，遍历每个兄弟节点，找到与 <code>switch()</code> 里面数组的变量名相同的节点，然后再取节点的值进行后续处理；</li>
<li>直接取 <code>switch()</code> 里面数组的变量名，然后使用 <code>scope.getBinding()</code> 方法获取到它绑定的节点，然后再取这个节点的值进行后续处理。</li>
</ol>
<p>所以 AST 处理代码就有两种写法，方法一：（code.js 即为前面的示例代码，为了方便操作，这里使用 fs 从文件中读取代码）</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default
const types = require(&quot;@babel/types&quot;)
const fs = require(&quot;fs&quot;);

const code = fs.readFileSync(&quot;code.js&quot;, &#123;encoding: &quot;utf-8&quot;&#125;);
const ast = parser.parse(code)

const visitor = &#123;
    WhileStatement(path) &#123;
        // switch 节点
        let switchNode = path.node.body.body[0];
        // switch 语句内的控制流数组名，本例中是 _0x34e16a
        let arrayName = switchNode.discriminant.object.name;
        // 获得所有 while 前面的兄弟节点，本例中获取到的是声明两个变量的节点，即 const _0x34e16a 和 let _0x2eff02
        let prevSiblings = path.getAllPrevSiblings();
        // 定义缓存控制流数组
        let array = []
        // forEach 方法遍历所有节点
        prevSiblings.forEach(pervNode =&gt; &#123;
            let &#123;id, init&#125; = pervNode.node.declarations[0];
            // 如果节点 id.name 与 switch 语句内的控制流数组名相同
            if (arrayName === id.name) &#123;
                // 获取节点整个表达式的参数、分割方法、分隔符
                let object = init.callee.object.value;
                let property = init.callee.property.value;
                let argument = init.arguments[0].value;
                // 模拟执行 &#39;3,4,0,5,1,2&#39;[&#39;split&#39;](&#39;,&#39;) 语句
                array = object[property](argument)
                // 也可以直接取参数进行分割，方法不通用，比如分隔符换成 | 就不行了
                // array = init.callee.object.value.split(&#39;,&#39;);
            &#125;
            // 前面的兄弟节点就可以删除了
            pervNode.remove();
        &#125;);

        // 储存正确顺序的控制流语句
        let replace = [];
        // 遍历控制流数组，按正确顺序取 case 内容
        array.forEach(index =&gt; &#123;
                let consequent = switchNode.cases[index].consequent;
                // 如果最后一个节点是 continue 语句，则删除 ContinueStatement 节点
                if (types.isContinueStatement(consequent[consequent.length - 1])) &#123;
                    consequent.pop();
                &#125;
                // concat 方法拼接多个数组，即正确顺序的 case 内容
                replace = replace.concat(consequent);
            &#125;
        );
        // 替换整个 while 节点，两种方法都可以
        path.replaceWithMultiple(replace);
        // path.replaceInline(replace);
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>方法二：</p>
<pre><code class="javascript">const parser = require(&quot;@babel/parser&quot;);
const generate = require(&quot;@babel/generator&quot;).default
const traverse = require(&quot;@babel/traverse&quot;).default
const types = require(&quot;@babel/types&quot;)
const fs = require(&quot;fs&quot;);

const code = fs.readFileSync(&quot;code.js&quot;, &#123;encoding: &quot;utf-8&quot;&#125;);
const ast = parser.parse(code)

const visitor = &#123;
    WhileStatement(path) &#123;
        // switch 节点
        let switchNode = path.node.body.body[0];
        // switch 语句内的控制流数组名，本例中是 _0x34e16a
        let arrayName = switchNode.discriminant.object.name;
        // 获取控制流数组绑定的节点
        let bindingArray = path.scope.getBinding(arrayName);
        // 获取节点整个表达式的参数、分割方法、分隔符
        let init = bindingArray.path.node.init;
        let object = init.callee.object.value;
        let property = init.callee.property.value;
        let argument = init.arguments[0].value;
        // 模拟执行 &#39;3,4,0,5,1,2&#39;[&#39;split&#39;](&#39;,&#39;) 语句
        let array = object[property](argument)
        // 也可以直接取参数进行分割，方法不通用，比如分隔符换成 | 就不行了
        // let array = init.callee.object.value.split(&#39;,&#39;);

        // switch 语句内的控制流自增变量名，本例中是 _0x2eff02
        let autoIncrementName = switchNode.discriminant.property.argument.name;
        // 获取控制流自增变量名绑定的节点
        let bindingAutoIncrement = path.scope.getBinding(autoIncrementName);
        // 可选择的操作：删除控制流数组绑定的节点、自增变量名绑定的节点
        bindingArray.path.remove();
        bindingAutoIncrement.path.remove();

        // 储存正确顺序的控制流语句
        let replace = [];
        // 遍历控制流数组，按正确顺序取 case 内容
        array.forEach(index =&gt; &#123;
                let consequent = switchNode.cases[index].consequent;
                // 如果最后一个节点是 continue 语句，则删除 ContinueStatement 节点
                if (types.isContinueStatement(consequent[consequent.length - 1])) &#123;
                    consequent.pop();
                &#125;
                // concat 方法拼接多个数组，即正确顺序的 case 内容
                replace = replace.concat(consequent);
            &#125;
        );
        // 替换整个 while 节点，两种方法都可以
        path.replaceWithMultiple(replace);
        // path.replaceInline(replace);
    &#125;
&#125;

traverse(ast, visitor)
const result = generate(ast)
console.log(result.code)
</code></pre>
<p>以上代码运行后，原来的 <code>switch-case</code> 控制流就被还原了，变成了按顺序一行一行的代码，更加简洁明了：</p>
<pre><code class="javascript">let _0x4588f1 = 0x1;
let _0x470e97 = 0x2;
let _0x38cb15 = _0x4588f1 + _0x470e97;
let _0x37b9f3 = 0x5 || _0x38cb15;
let _0x1e0e5e = _0x37b9f3[_0x50cee0(0x2e0, 0x2e8, 0x2e1, 0x2e4)];
let _0x35d732 = [_0x388d4b(-0x134, -0x134, -0x139, -0x138)](_0x38cb15 &gt;&gt; _0x4588f1);
</code></pre>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>本文有参考以下资料，也是比较推荐的在线学习资料：</p>
<ul>
<li>Youtube 视频，Babel 入门：<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=UeVq_U5obnE">https://www.youtube.com/watch?v=UeVq_U5obnE</a></li>
<li>官方手册 Babel Handbook：<a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/babel-handbook">https://github.com/jamiebuilds/babel-handbook</a></li>
<li>非官方 Babel API 中文文档：<a target="_blank" rel="noopener" href="https://evilrecluse.top/Babel-traverse-api-doc/">https://evilrecluse.top/Babel-traverse-api-doc/</a></li>
</ul>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>Babel 编译器国内的资料其实不是很多，多看源码、同时在线对照可视化的 AST 语法树，耐心一点儿一层一层分析即可，本文中的案例也只是最基本操作，实际遇到一些混淆还得视情况进行修改，比如需要加一些类型判断来限制等，后续会用实战来带领大家进一步熟悉解混淆当中的其他操作。</p>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 8px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p>
                        <strong>本文链接：</strong><a href="https://www.itbob.cn/article/051/">https://www.itbob.cn/article/051/</a>
                        <br>
                        <strong>
                             
                                本站所有原创文章采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> 许可协议进行许可！
                            
                        </strong>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: 'd19a84b9d9a2ddb2c6b9',
            clientSecret: 'cec9feae5129a6106edc68ce06d167be8eb06021',
            repo: 'trhx.github.io',
            owner: 'TRHX',
            admin: ['TRHX'],
            // facebook-like distraction free mode
            distractionFreeMode: false
        })
   gitalk.render('gitalk-container')
</script>
</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/article/052/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/article/050/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/BOB.png" alt="BOB's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        YWRtaW5AaXRib2IuY24=
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: admin@itrhx.com" target="_blank" title="邮件联系我">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        邮件联系我
                    </a>
                </li>
            
                <li>
                    <a href="https://itrhx.blog.csdn.net/" target="_blank" title="关注 CSDN">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">donut_small</i>
                        
                        关注 CSDN
                    </a>
                </li>
            
                <li>
                    <a href="https://github.com/TRHX" target="_blank" title="关注 GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">code</i>
                        
                        关注 GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2022/05/">五月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/04/">四月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/03/">三月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/02/">二月 2022<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/01/">一月 2022<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/11/">十一月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/10/">十月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/07/">七月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/10/">十月 2020<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/06/">六月 2020<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/04/">四月 2020<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/03/">三月 2020<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/09/">九月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/08/">八月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/06/">六月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/02/">二月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Hexo/">Hexo<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/JS-%E9%80%86%E5%90%91/">JS 逆向<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析<span class="sidebar_archives-count">27</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E7%AE%97%E6%B3%95/">算法<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags/" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">local_offer</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/timeline/" title="时光机">
                
                    <i class="material-icons sidebar-material-icons">send</i>
                
                时光机
            </a>
        </li>
        
    
        <li>
            <a href="/friends/" title="友人帐">
                
                    <i class="material-icons sidebar-material-icons">group_add</i>
                
                友人帐
            </a>
        </li>
        
    
        <li>
            <a href="/comments/" title="关于我 &amp; 留言板">
                
                    <i class="material-icons sidebar-material-icons">chat</i>
                
                关于我 &amp; 留言板
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives/">
                文章总数
                <span class="sidebar-badge">52</span>
            </a>
        </li>
        
    

    <!-- Article Wordcount  -->
    
        <li>
            <a href="">
                字数统计
                <span class="sidebar-badge">257.5k</span>
            </a>
        </li>
        
            <li class="divider"></li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- QQ Group -->

    <a href="https://jq.qq.com/?_wv=1027&k=MwSEZmIi" alt="爬虫逆向交流群" title="群号：941013658" class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            爬虫逆向交流群
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>
    <a href="https://jq.qq.com/?_wv=1027&k=Ag6AZkYC" alt="Hexo 博客交流一群" title="群号：924812033" class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Hexo 博客交流一群
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>
    <a href="https://jq.qq.com/?_wv=1027&k=ymhpQ0jb" alt="Hexo 博客交流二群" title="群号：735861501" class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Hexo 博客交流二群
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Github -->
    
        <a href="https://github.com/TRHX" target="_blank" title="Github">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- CSDN -->
    
        <a href="https://itrhx.blog.csdn.net/" target="_blank" title="CSDN">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-csdn">
                <span class="visuallyhidden">CSDN</span>
            </button><!--
     --></a>
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/itrhx" target="_blank" title="Zhihu">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-zhihu">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
        --></a>
    

    <!-- Email -->
    
        <a href="mailto:admin@itbob.cn" target="_blank" title="Email">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-envelope">
                <span class="visuallyhidden">Email</span>
            </button><!--
     --></a>
    

    <!-- QQ -->
    
        <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2273902448&amp;site=qq&amp;menu=yes" target="_blank" title="QQ">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-qq">
                <span class="visuallyhidden">QQ</span>
            </button><!--
        --></a>
    

    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- LinkedIn -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


            <!--Copyright-->
            <div id="copyright">

                
                    <div class="itbob-footer-text">
                        
                                    <img src="/img/icp.png" alt="ICP" style="width:18px; height:18px; margin-bottom:5px"> <a href="https://beian.miit.gov.cn/" target="_blank">鄂ICP备19003281号-6</a>丨 <img src="/img/moeicp.png" alt="MOE ICP" style="width:16px; height:16px; margin-bottom:5px"> <a href="https://icp.gov.moe/" target="_blank">萌ICP备20202022号</a>丨 <a href="https://cloud.tencent.com/" target="_blank"> <img src="/img/tencent_cloud.svg" style="height:17px; margin-bottom:5px"></a>
                                        
                    </div>
                    

                        Copyright&nbsp;©&nbsp;<span year></span>&nbsp;ITBOB丨

                        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
                        <script>
                            var now = new Date();

                            function createtime() {
                                var grt = new Date("08/10/2018 17:38:00"); //在此处修改你的建站时间，格式：月/日/年 时:分:秒
                                now.setTime(now.getTime() + 250);
                                days = (now - grt) / 1000 / 60 / 60 / 24;
                                dnum = Math.floor(days);
                                hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
                                hnum = Math.floor(hours);
                                if (String(hnum).length == 1) {
                                    hnum = "0" + hnum;
                                }
                                minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
                                mnum = Math.floor(minutes);
                                if (String(mnum).length == 1) {
                                    mnum = "0" + mnum;
                                }
                                seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
                                snum = Math.round(seconds);
                                if (String(snum).length == 1) {
                                    snum = "0" + snum;
                                }
                                document.getElementById("timeDate").innerHTML = "本站已运行了 " + dnum + " 天 ";
                                document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
                            }
                            setInterval("createtime()", 250);
                        </script>


            </div>

            <!-- All Site UV -->
            <!-- 
        <br />
        <span id="busuanzi_container_site_uv">本站访客数
            <span id="busuanzi_value_site_uv">
            </span>
        </span>|
        <span id="busuanzi_container_site_pv">本站总访问量
            <span id="busuanzi_value_site_pv">
                
            </span>
        </span>|
        <i class="material-icons">keyboard</i>站点总字数<span class="post-count">257.5k</span>
        
        </div> -->
            <!-- Paradox Footer Right Section -->

            <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

            <!-- <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div> -->

            <div class="mdl-mini-footer--right-section">
                <div>
                    <div class="itbob-github-badge">
                        <span class="badge-subject">PV</span>
                        <span class="badge-value bg-brightgreen" id="busuanzi_value_site_pv"></span>
                    </div>
                    <div class="itbob-github-badge">
                        <span class="badge-subject">Powered</span>
                        <span class="badge-value bg-blue">Hexo</span>
                    </div>
                </div>
                <div>
                    <div class="itbob-github-badge">
                        <span class="badge-subject">UV</span>
                        <span class="badge-value bg-firebrick" id="busuanzi_value_site_uv"></span>
                    </div>
                    <div class="itbob-github-badge">
                        <span class="badge-subject">Theme</span>
                        <span class="badge-value bg-orange">Material</span>
                    </div>
                </div>
            </div>
            
</footer>

                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="/js/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->





<!-- Browser Check -->
<script>
	var agent = navigator.userAgent.toLowerCase();
    // UC
	if(agent.indexOf('ucbrowser') > -1 || agent.indexOf('ubrowser') > -1) {
        /* document.write('
<link rel="stylesheet" href="/css/uc.css">
'); */
        alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n\n为了您能更好的浏览，强烈推荐使用 Chrome 或 Firefox 浏览器！\n\n继续浏览极有可能会出现一些样式问题！');
	}
    // IE
    if (agent.indexOf("compatible") > -1 && agent.indexOf("MSIE") > -1) {
        alert('由于 IE 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n\n为了您能更好的浏览，强烈推荐使用 Chrome 或 Firefox 浏览器！\n\n继续浏览极有可能会出现一些样式问题！');
    };
    // IE 11
    if (agent.indexOf('Trident') > -1 && agent.indexOf("rv:11.0") > -1) {
        alert('由于 IE 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n\n为了您能更好的浏览，强烈推荐使用 Chrome 或 Firefox 浏览器！\n\n继续浏览极有可能会出现一些样式问题！');
    }
</script>

<!-- Blog Title JS -->

    
            <script>lsloader.load("binft","/js/binft.js?eZhLXqFFh9+v03Tp9mCu6g==", true)</script>
    


<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2018;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log("\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n", "color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;", "color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;");
console.log("\n %c © ITBOB'S BLOG %c https://www.itbob.cn \n\n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;");
console.log("\n %c © ITRHX'S BLOG %c https://www.itrhx.com \n\n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;");
</script>

                </main>
            </div>
        </body>
    
</html>
