<!-- 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        æœ‰æ¯›çš„å«ç¨‹åºçŒ¿ï¼Œæ²’æ¯›çš„å«ç¨‹åºå‘˜ã€‚
-->

<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Title -->
<title>é€†å‘è¿›é˜¶ï¼Œåˆ©ç”¨ AST æŠ€æœ¯è¿˜åŸ JavaScript æ··æ·†ä»£ç  - BOB&#39;S BLOG</title>

<!-- Icon -->
<link rel="icon" href="/img/favicon.png">

<!-- Fonts -->
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" as="style" onload="this.onload=null, this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>


    <!-- KaTeX -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" as="style" onload="this.onload=null, this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"></noscript>


<!-- Style -->

<link rel="stylesheet" href="/styles/main.css">

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-pure@1.0.1/dist/main.css"> -->



<!-- ä¸è’œå­ -->
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script async src="/js/busuanzi.pure.mini.js"></script>

<!-- æ‰“å­—æ•ˆæœ -->
<!-- https://www.typeitjs.com/ -->
<script src="https://unpkg.com/typeit@8.7.0/dist/index.umd.js"></script>

<script>
    function makeMulti (string) {
        let l = new String(string)
        l = l.substring(l.indexOf("/*") + 3, l.lastIndexOf("*/"))
        return l
    }
    let string = function () {
      /* 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        æœ‰æ¯›çš„å«ç¨‹åºçŒ¿ï¼Œæ²’æ¯›çš„å«ç¨‹åºå‘˜ã€‚
      */
    }
    console.log(makeMulti(string));
    console.log("\n %c Â© ITBOB'S BLOG %c https://www.itbob.cn %c Â© ITRHX'S BLOG %c https://www.itrhx.com \n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;")
</script>


    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">


    <meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BOB'S BLOG" type="application/atom+xml">
</head>
    <body>
        <div class="main gt-bg-theme-color-first">
            <div class="main-content">
                <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/img/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first" id="typeitspan">
            <!-- BOB&#39;S BLOG -->
        </div>
    </a>
    <!-- <span id="typeitspan"></span> -->
    <script>
        new TypeIt('#typeitspan', {
        strings: "BOB'S BLOG",
        speed: 150, 
        afterComplete: function (instance) {
            instance.destroy();
        }
        }).go();
    </script>
    <button aria-label="Navbar Toggler" class="navbar-toggler" type="button" id="changeNavbar">
        <i class="gt-c-content-color-first" style="font-size: 18px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="18px" fill="currentColor">
                <path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z" />
            </svg>
        </i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center; ">
            
                
                    <div class="nav-item">
                        <a href="/" class="menu gt-a-link" target="_self">é¦–é¡µ</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/archives/" class="menu gt-a-link" target="_self">å½’æ¡£</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/tags/" class="menu gt-a-link" target="_self">æ ‡ç­¾</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/friends/" class="menu gt-a-link" target="_self">å‹é“¾</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/about/" class="menu gt-a-link" target="_self">å…³äº</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="https://travellings.link" target="_blank">
                            <img src="/img/travelling.gif" alt="å¼€å¾€-å‹é“¾æ¥åŠ›" width="auto" height="25px">
                        </a>
                    </div>
                
            
        </div>
    </div>
</nav>

<script>
    /* ç§»åŠ¨ç«¯å¯¼èˆªæ å±•å¼€/æ”¶èµ·åˆ‡æ¢ */
    document.getElementById('changeNavbar').onclick = function() {
        let element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else { 
            element.style.display = 'none';
        }
    }
</script>

                <div class="post-container">
    <div class="post-detail gt-bg-theme-color-second gt-c-content-color-first">
        <article class="gt-post-content">
            <h1 class="post-title">é€†å‘è¿›é˜¶ï¼Œåˆ©ç”¨ AST æŠ€æœ¯è¿˜åŸ JavaScript æ··æ·†ä»£ç </h1>
            <div class="post-info">
                <time class="post-time gt-c-content-color-first">
                    Â· 2022-04-25 Â·</time>
                
                    
                        <a href="/tags/JS-%E9%80%86%E5%90%91%E7%90%86%E8%AE%BA/" class="post-tag">
                            #JS é€†å‘ç†è®º</a>
                    
                        <a href="/tags/%E7%88%AC%E8%99%AB/" class="post-tag">
                            #çˆ¬è™«</a>
                    
                
            </div>
            <hr>
            <div class="post-content gt-c-content-color-first">
                <h2 id="ä»€ä¹ˆæ˜¯-AST">ä»€ä¹ˆæ˜¯ AST</h2>
<p>ASTï¼ˆAbstract Syntax Treeï¼‰ï¼Œä¸­æ–‡æŠ½è±¡è¯­æ³•æ ‘ï¼Œç®€ç§°è¯­æ³•æ ‘ï¼ˆSyntax Treeï¼‰ï¼Œæ˜¯æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç°å½¢å¼ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚è¯­æ³•æ ‘ä¸æ˜¯æŸä¸€ç§ç¼–ç¨‹è¯­è¨€ç‹¬æœ‰çš„ï¼ŒJavaScriptã€Pythonã€Javaã€Golang ç­‰å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¯­æ³•æ ‘ã€‚</p>
<p>å°æ—¶å€™æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç©å…·ï¼Œæ€»å–œæ¬¢æŠŠç©å…·æ‹†è§£æˆä¸€ä¸ªä¸€ä¸ªå°é›¶ä»¶ï¼Œç„¶åæŒ‰ç…§æˆ‘ä»¬è‡ªå·±çš„æƒ³æ³•ï¼ŒæŠŠé›¶ä»¶é‡æ–°ç»„è£…èµ·æ¥ï¼Œä¸€ä¸ªæ–°ç©å…·å°±è¯ç”Ÿäº†ã€‚è€Œ JavaScript å°±åƒä¸€å°ç²¾å¦™è¿ä½œçš„æœºå™¨ï¼Œé€šè¿‡ AST è§£æï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒç«¥å¹´æ—¶æ‹†è§£ç©å…·ä¸€æ ·ï¼Œæ·±å…¥äº†è§£ JavaScript è¿™å°æœºå™¨çš„å„ä¸ªé›¶éƒ¨ä»¶ï¼Œç„¶åé‡æ–°æŒ‰ç…§æˆ‘ä»¬è‡ªå·±çš„æ„æ„¿æ¥ç»„è£…ã€‚</p>
<p>AST çš„ç”¨é€”å¾ˆå¹¿ï¼ŒIDE çš„è¯­æ³•é«˜äº®ã€ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å‹ç¼©ã€è½¬è¯‘ç­‰ï¼Œéƒ½éœ€è¦å…ˆå°†ä»£ç è½¬åŒ–æˆ AST å†è¿›è¡Œåç»­çš„æ“ä½œï¼ŒES5 å’Œ ES6 è¯­æ³•å·®å¼‚ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œåœ¨å®é™…åº”ç”¨ä¸­éœ€è¦è¿›è¡Œè¯­æ³•çš„è½¬æ¢ï¼Œä¹Ÿä¼šç”¨åˆ° ASTã€‚AST å¹¶ä¸æ˜¯ä¸ºäº†é€†å‘è€Œç”Ÿï¼Œä½†åšé€†å‘å­¦ä¼šäº† ASTï¼Œåœ¨è§£æ··æ·†æ—¶å¯ä»¥å¦‚é±¼å¾—æ°´ã€‚</p>
<p>AST æœ‰ä¸€ä¸ªåœ¨çº¿è§£æç½‘ç«™ï¼š<a target="_blank" rel="noopener" href="https://astexplorer.net/">https://astexplorer.net/</a> ï¼Œé¡¶éƒ¨å¯ä»¥é€‰æ‹©è¯­è¨€ã€ç¼–è¯‘å™¨ã€æ˜¯å¦å¼€å¯è½¬åŒ–ç­‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒºåŸŸâ‘ æ˜¯æºä»£ç ï¼ŒåŒºåŸŸâ‘¡æ˜¯å¯¹åº”çš„ AST è¯­æ³•æ ‘ï¼ŒåŒºåŸŸâ‘¢æ˜¯è½¬æ¢ä»£ç ï¼Œå¯ä»¥å¯¹è¯­æ³•æ ‘è¿›è¡Œå„ç§æ“ä½œï¼ŒåŒºåŸŸâ‘£æ˜¯è½¬æ¢åç”Ÿæˆçš„æ–°ä»£ç ã€‚å›¾ä¸­åŸæ¥çš„ Unicode å­—ç¬¦ç»è¿‡æ“ä½œä¹‹åå°±å˜æˆäº†æ­£å¸¸å­—ç¬¦ã€‚</p>
<p>è¯­æ³•æ ‘æ²¡æœ‰å•ä¸€çš„æ ¼å¼ï¼Œé€‰æ‹©ä¸åŒçš„è¯­è¨€ã€ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨ JavaScript ä¸­ï¼Œç¼–è¯‘å™¨æœ‰ Acornã€Espreeã€Esprimaã€Recastã€Uglify-JS ç­‰ï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯ Babelï¼Œåç»­çš„å­¦ä¹ ä¹Ÿæ˜¯ä»¥ Babel ä¸ºä¾‹ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/3e56f2edec502087a2bb0b10ef178b52.png" alt="01"></p>
<h2 id="AST-åœ¨ç¼–è¯‘ä¸­çš„ä½ç½®">AST åœ¨ç¼–è¯‘ä¸­çš„ä½ç½®</h2>
<p>åœ¨ç¼–è¯‘åŸç†ä¸­ï¼Œç¼–è¯‘å™¨è½¬æ¢ä»£ç é€šå¸¸è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼šè¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰ã€è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ã€ä»£ç ç”Ÿæˆï¼ˆCode Generationï¼‰ï¼Œä¸‹å›¾ç”ŸåŠ¨å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/90fe33b7b362f60e1ee1849bf3c06fc9.png" alt="02"></p>
<h3 id="è¯æ³•åˆ†æ">è¯æ³•åˆ†æ</h3>
<p>è¯æ³•åˆ†æé˜¶æ®µæ˜¯ç¼–è¯‘è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯ä»å·¦åˆ°å³ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å…¥æºç¨‹åºï¼Œç„¶åæ ¹æ®æ„è¯è§„åˆ™è¯†åˆ«å•è¯ï¼Œç”Ÿæˆ token ç¬¦å·æµï¼Œæ¯”å¦‚ <code>isPanda('ğŸ¼')</code>ï¼Œä¼šè¢«æ‹†åˆ†æˆ <code>isPanda</code>ï¼Œ<code>(</code>ï¼Œ<code>'ğŸ¼'</code>ï¼Œ<code>)</code> å››éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æœ‰ä¸åŒçš„å«ä¹‰ï¼Œå¯ä»¥å°†è¯æ³•åˆ†æè¿‡ç¨‹æƒ³è±¡ä¸ºä¸åŒç±»å‹æ ‡è®°çš„åˆ—è¡¨æˆ–æ•°ç»„ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/de8a6906cf7db9be51ef2eb56cbd1b70.gif#pic_center" alt="03"></p>
<h3 id="è¯­æ³•åˆ†æ">è¯­æ³•åˆ†æ</h3>
<p>è¯­æ³•åˆ†ææ˜¯ç¼–è¯‘è¿‡ç¨‹çš„ä¸€ä¸ªé€»è¾‘é˜¶æ®µï¼Œè¯­æ³•åˆ†æçš„ä»»åŠ¡æ˜¯åœ¨è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šå°†å•è¯åºåˆ—ç»„åˆæˆå„ç±»è¯­æ³•çŸ­è¯­ï¼Œæ¯”å¦‚â€œç¨‹åºâ€ï¼Œâ€œè¯­å¥â€ï¼Œâ€œè¡¨è¾¾å¼â€ç­‰ï¼Œå‰é¢çš„ä¾‹å­ä¸­ï¼Œ<code>isPanda('ğŸ¼')</code> å°±ä¼šè¢«åˆ†æä¸ºä¸€æ¡è¡¨è¾¾è¯­å¥ <code>ExpressionStatement</code>ï¼Œ<code>isPanda()</code> å°±ä¼šè¢«åˆ†ææˆä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼ <code>CallExpression</code>ï¼Œ<code>ğŸ¼</code> å°±ä¼šè¢«åˆ†ææˆä¸€ä¸ªå˜é‡ <code>Literal</code> ç­‰ï¼Œä¼—å¤šè¯­æ³•ä¹‹é—´çš„ä¾èµ–ã€åµŒå¥—å…³ç³»ï¼Œå°±æ„æˆäº†ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œå³ AST è¯­æ³•æ ‘ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/45b5484465969681707f32a2dde5370b.gif#pic_center" alt="04"></p>
<h3 id="ä»£ç ç”Ÿæˆ">ä»£ç ç”Ÿæˆ</h3>
<p>ä»£ç ç”Ÿæˆæ˜¯æœ€åä¸€æ­¥ï¼Œå°† AST è¯­æ³•æ ‘è½¬æ¢æˆå¯æ‰§è¡Œä»£ç å³å¯ï¼Œåœ¨è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œè¯­æ³•æ ‘ï¼Œè¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå˜é‡çš„å£°æ˜ä½ç½®ã€æ›´æ”¹å˜é‡çš„å€¼ã€åˆ é™¤æŸäº›èŠ‚ç‚¹ç­‰ï¼Œæˆ‘ä»¬å°†è¯­å¥ <code>isPanda('ğŸ¼')</code> ä¿®æ”¹ä¸ºä¸€ä¸ªå¸ƒå°”ç±»å‹çš„ <code>Literal</code>ï¼š<code>true</code>ï¼Œè¯­æ³•æ ‘å°±æœ‰å¦‚ä¸‹å˜åŒ–ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6659a4f8614b61a4d6376aadca326f88.gif#pic_center" alt="05"></p>
<h2 id="Babel-ç®€ä»‹">Babel ç®€ä»‹</h2>
<p>Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªè§£æåº“ï¼ŒBabel ä¸­æ–‡ç½‘ï¼š<a target="_blank" rel="noopener" href="https://www.babeljs.cn/">https://www.babeljs.cn/</a> ï¼ŒBabel è‹±æ–‡å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://babeljs.io/">https://babeljs.io/</a> ï¼ŒBabel å†…ç½®äº†å¾ˆå¤šåˆ†æ JavaScript ä»£ç çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Babel å°† JavaScript ä»£ç è½¬æ¢æˆ AST è¯­æ³•æ ‘ï¼Œç„¶åå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œä¹‹åï¼Œå†è½¬æ¢æˆ JavaScript ä»£ç ã€‚</p>
<p>Babel åŒ…å«çš„å„ç§åŠŸèƒ½åŒ…ã€APIã€å„æ–¹æ³•å¯é€‰å‚æ•°ç­‰ï¼Œéƒ½éå¸¸å¤šï¼Œæœ¬æ–‡ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œåº”å½“å¤šæŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œæˆ–è€…å‚è€ƒæ–‡æœ«ç»™å‡ºçš„ä¸€äº›å­¦ä¹ èµ„æ–™ã€‚Babel çš„å®‰è£…å’Œå…¶ä»– Node åŒ…ä¸€æ ·ï¼Œéœ€è¦å“ªä¸ªå®‰è£…å“ªä¸ªå³å¯ï¼Œæ¯”å¦‚ <code>npm install @babel/core @babel/parser @babel/traverse @babel/generator</code></p>
<p>åœ¨åšé€†å‘è§£æ··æ·†ä¸­ï¼Œä¸»è¦ç”¨åˆ°äº† Babel çš„ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½åŒ…ï¼Œæœ¬æ–‡ä¹Ÿä»…ä»‹ç»ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½åŒ…ï¼š</p>
<ol>
<li><code>@babel/core</code>ï¼šBabel ç¼–è¯‘å™¨æœ¬èº«ï¼Œæä¾›äº† babel çš„ç¼–è¯‘ APIï¼›</li>
<li><code>@babel/parser</code>ï¼šå°† JavaScript ä»£ç è§£ææˆ AST è¯­æ³•æ ‘ï¼›</li>
<li><code>@babel/traverse</code>ï¼šéå†ã€ä¿®æ”¹ AST è¯­æ³•æ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼›</li>
<li><code>@babel/generator</code>ï¼šå°† AST è¿˜åŸæˆ JavaScript ä»£ç ï¼›</li>
<li><code>@babel/types</code>ï¼šåˆ¤æ–­ã€éªŒè¯èŠ‚ç‚¹çš„ç±»å‹ã€æ„å»ºæ–° AST èŠ‚ç‚¹ç­‰ã€‚</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f8be61bdf850b955459dd4d476f80822.png" alt="06"></p>
<h3 id="babel-core">@babel/core</h3>
<p>Babel ç¼–è¯‘å™¨æœ¬èº«ï¼Œè¢«æ‹†åˆ†æˆäº†ä¸‰ä¸ªæ¨¡å—ï¼š<code>@babel/parser</code>ã€<code>@babel/traverse</code>ã€<code>@babel/generator</code>ï¼Œæ¯”å¦‚ä»¥ä¸‹æ–¹æ³•çš„å¯¼å…¥æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>).parse;
<span class="hljs-keyword">const</span> parse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/core&quot;</span>).parse;

<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/core&quot;</span>).traverse</code></pre>
<h3 id="babel-parser">@babel/parser</h3>
<p><code>@babel/parser</code> å¯ä»¥å°† JavaScript ä»£ç è§£ææˆ AST è¯­æ³•æ ‘ï¼Œå…¶ä¸­ä¸»è¦æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>parser.parse(code, [&#123;options&#125;])</code>ï¼šè§£æä¸€æ®µ JavaScript ä»£ç ï¼›</li>
<li><code>parser.parseExpression(code, [&#123;options&#125;])</code>ï¼šè€ƒè™‘åˆ°äº†æ€§èƒ½é—®é¢˜ï¼Œè§£æå•ä¸ª JavaScript è¡¨è¾¾å¼ã€‚</li>
</ul>
<p>éƒ¨åˆ†å¯é€‰å‚æ•° <code>options</code>ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allowImportExportEverywhere</code></td>
<td>é»˜è®¤ <code>import</code> å’Œ <code>export</code> å£°æ˜è¯­å¥åªèƒ½å‡ºç°åœ¨ç¨‹åºçš„æœ€é¡¶å±‚ï¼Œè®¾ç½®ä¸º <code>true</code> åˆ™åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å£°æ˜</td>
</tr>
<tr>
<td><code>allowReturnOutsideFunction</code></td>
<td>é»˜è®¤å¦‚æœåœ¨é¡¶å±‚ä¸­ä½¿ç”¨ <code>return</code> è¯­å¥ä¼šå¼•èµ·é”™è¯¯ï¼Œè®¾ç½®ä¸º <code>true</code> å°±ä¸ä¼šæŠ¥é”™</td>
</tr>
<tr>
<td><code>sourceType</code></td>
<td>é»˜è®¤ä¸º <code>script</code>ï¼Œå½“ä»£ç ä¸­å«æœ‰ <code>import</code> ã€<code>export</code> ç­‰å…³é”®å­—æ—¶ä¼šæŠ¥é”™ï¼Œéœ€è¦æŒ‡å®šä¸º <code>module</code></td>
</tr>
<tr>
<td><code>errorRecovery</code></td>
<td>é»˜è®¤å¦‚æœ babel å‘ç°ä¸€äº›ä¸æ­£å¸¸çš„ä»£ç å°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè®¾ç½®ä¸º <code>true</code> åˆ™ä¼šåœ¨ä¿å­˜è§£æé”™è¯¯çš„åŒæ—¶ç»§ç»­è§£æä»£ç ï¼Œé”™è¯¯çš„è®°å½•å°†è¢«ä¿å­˜åœ¨æœ€ç»ˆç”Ÿæˆçš„ AST çš„ errors å±æ€§ä¸­ï¼Œå½“ç„¶å¦‚æœé‡åˆ°ä¸¥é‡çš„é”™è¯¯ï¼Œä¾ç„¶ä¼šç»ˆæ­¢è§£æ</td>
</tr>
</tbody>
</table>
<p>ä¸¾ä¸ªä¾‹å­çœ‹å¾—æ¯”è¾ƒæ¸…æ¥šï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);

<span class="hljs-keyword">const</span> code = <span class="hljs-string">&quot;const a = 1;&quot;</span>;
<span class="hljs-keyword">const</span> ast = parser.parse(code, &#123;<span class="hljs-attr">sourceType</span>: <span class="hljs-string">&quot;module&quot;</span>&#125;)
<span class="hljs-built_in">console</span>.log(ast)</code></pre>
<p><code>&#123;sourceType: &quot;module&quot;&#125;</code> æ¼”ç¤ºäº†å¦‚ä½•æ·»åŠ å¯é€‰å‚æ•°ï¼Œè¾“å‡ºçš„å°±æ˜¯ AST è¯­æ³•æ ‘ï¼Œè¿™å’Œåœ¨çº¿ç½‘ç«™ <a target="_blank" rel="noopener" href="https://astexplorer.net/">https://astexplorer.net/</a> è§£æå‡ºæ¥çš„è¯­æ³•æ ‘æ˜¯ä¸€æ ·çš„ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/cb7791be87be4a4c8f47add3228e3d58.png" alt="07"></p>
<h3 id="babel-generator">@babel/generator</h3>
<p><code>@babel/generator</code> å¯ä»¥å°† AST è¿˜åŸæˆ JavaScript ä»£ç ï¼Œæä¾›äº†ä¸€ä¸ª <code>generate</code> æ–¹æ³•ï¼š<code>generate(ast, [&#123;options&#125;], code)</code>ã€‚</p>
<p>éƒ¨åˆ†å¯é€‰å‚æ•° <code>options</code>ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auxiliaryCommentBefore</code></td>
<td>åœ¨è¾“å‡ºæ–‡ä»¶å†…å®¹çš„å¤´éƒ¨æ·»åŠ æ³¨é‡Šå—æ–‡å­—</td>
</tr>
<tr>
<td><code>auxiliaryCommentAfter</code></td>
<td>åœ¨è¾“å‡ºæ–‡ä»¶å†…å®¹çš„æœ«å°¾æ·»åŠ æ³¨é‡Šå—æ–‡å­—</td>
</tr>
<tr>
<td><code>comments</code></td>
<td>è¾“å‡ºå†…å®¹æ˜¯å¦åŒ…å«æ³¨é‡Š</td>
</tr>
<tr>
<td><code>compact</code></td>
<td>è¾“å‡ºå†…å®¹æ˜¯å¦ä¸æ·»åŠ ç©ºæ ¼ï¼Œé¿å…æ ¼å¼åŒ–</td>
</tr>
<tr>
<td><code>concise</code></td>
<td>è¾“å‡ºå†…å®¹æ˜¯å¦å‡å°‘ç©ºæ ¼ä½¿å…¶æ›´ç´§å‡‘ä¸€äº›</td>
</tr>
<tr>
<td><code>minified</code></td>
<td>æ˜¯å¦å‹ç¼©è¾“å‡ºä»£ç </td>
</tr>
<tr>
<td><code>retainLines</code></td>
<td>å°è¯•åœ¨è¾“å‡ºä»£ç ä¸­ä½¿ç”¨ä¸æºä»£ç ä¸­ç›¸åŒçš„è¡Œå·</td>
</tr>
</tbody>
</table>
<p>æ¥ç€å‰é¢çš„ä¾‹å­ï¼ŒåŸä»£ç æ˜¯ <code>const a = 1;</code>ï¼Œç°åœ¨æˆ‘ä»¬æŠŠ <code>a</code> å˜é‡ä¿®æ”¹ä¸º <code>b</code>ï¼Œå€¼ <code>1</code> ä¿®æ”¹ä¸º <code>2</code>ï¼Œç„¶åå°† AST è¿˜åŸç”Ÿæˆæ–°çš„ JS ä»£ç ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default

<span class="hljs-keyword">const</span> code = <span class="hljs-string">&quot;const a = 1;&quot;</span>;
<span class="hljs-keyword">const</span> ast = parser.parse(code, &#123;<span class="hljs-attr">sourceType</span>: <span class="hljs-string">&quot;module&quot;</span>&#125;)
ast.program.body[<span class="hljs-number">0</span>].declarations[<span class="hljs-number">0</span>].id.name = <span class="hljs-string">&quot;b&quot;</span>
ast.program.body[<span class="hljs-number">0</span>].declarations[<span class="hljs-number">0</span>].init.value = <span class="hljs-number">2</span>
<span class="hljs-keyword">const</span> result = generate(ast, &#123;<span class="hljs-attr">minified</span>: <span class="hljs-literal">true</span>&#125;)

<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>æœ€ç»ˆè¾“å‡ºçš„æ˜¯ <code>const b=2;</code>ï¼Œå˜é‡åå’Œå€¼éƒ½æˆåŠŸæ›´æ”¹äº†ï¼Œç”±äºåŠ äº†å‹ç¼©å¤„ç†ï¼Œç­‰å·å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ä¹Ÿæ²¡äº†ã€‚</p>
<p>ä»£ç é‡Œ <code>&#123;minified: true&#125;</code> æ¼”ç¤ºäº†å¦‚ä½•æ·»åŠ å¯é€‰å‚æ•°ï¼Œè¿™é‡Œè¡¨ç¤ºå‹ç¼©è¾“å‡ºä»£ç ï¼Œ<code>generate</code> å¾—åˆ°çš„ <code>result</code> å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ <code>code</code> å±æ€§æ‰æ˜¯æœ€ç»ˆçš„ JS ä»£ç ã€‚</p>
<p>ä»£ç é‡Œ <code>ast.program.body[0].declarations[0].id.name</code> æ˜¯ a åœ¨ AST ä¸­çš„ä½ç½®ï¼Œ<code>ast.program.body[0].declarations[0].init.value</code> æ˜¯ 1 åœ¨ AST ä¸­çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/0ffbf3d9a54e2de3c779735aeac0e3e4.png" alt="08"></p>
<h3 id="babel-traverse">@babel/traverse</h3>
<p>å½“ä»£ç å¤šäº†ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åƒå‰é¢é‚£æ ·æŒ¨ä¸ªå®šä½å¹¶ä¿®æ”¹ï¼Œå¯¹äºç›¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥éå†æ‰€æœ‰èŠ‚ç‚¹æ¥è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº† <code>@babel/traverse</code>ï¼Œå®ƒé€šå¸¸å’Œ <code>visitor</code> ä¸€èµ·ä½¿ç”¨ï¼Œ<code>visitor</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªåå­—æ˜¯å¯ä»¥éšæ„å–çš„ï¼Œ<code>visitor</code> é‡Œå¯ä»¥å®šä¹‰ä¸€äº›æ–¹æ³•æ¥è¿‡æ»¤èŠ‚ç‚¹ï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default

<span class="hljs-keyword">const</span> code = <span class="hljs-string">`</span>
<span class="hljs-string">const a = 1500;</span>
<span class="hljs-string">const b = 60;</span>
<span class="hljs-string">const c = &quot;hi&quot;;</span>
<span class="hljs-string">const d = 787;</span>
<span class="hljs-string">const e = &quot;1244&quot;;</span>
<span class="hljs-string">`</span>
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">NumericLiteral</span>(<span class="hljs-params">path</span>)</span>&#123;
        path.node.value = (path.node.value + <span class="hljs-number">100</span>) * <span class="hljs-number">2</span>
    &#125;,
    <span class="hljs-function"><span class="hljs-title">StringLiteral</span>(<span class="hljs-params">path</span>)</span>&#123;
        path.node.value = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>è¿™é‡Œçš„åŸå§‹ä»£ç å®šä¹‰äº† abcde äº”ä¸ªå˜é‡ï¼Œå…¶å€¼æœ‰æ•°å­—ä¹Ÿæœ‰å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬åœ¨ AST ä¸­å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç±»å‹ä¸º <code>NumericLiteral</code> å’Œ <code>StringLiteral</code>ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/b0a932b29fef0ad7a6f20dbc88f3ec46.png" alt="09"></p>
<p>ç„¶åæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª <code>visitor</code> å¯¹è±¡ï¼Œç„¶åå®šä¹‰å¯¹åº”ç±»å‹çš„å¤„ç†æ–¹æ³•ï¼Œ<code>traverse</code> æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ AST å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯ <code>visitor</code>ï¼Œå½“ <code>traverse</code> éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œé‡åˆ°èŠ‚ç‚¹ç±»å‹ä¸º <code>NumericLiteral</code> å’Œ <code>StringLiteral</code> æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <code>visitor</code> ä¸­å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œ<code>visitor</code> ä¸­çš„æ–¹æ³•ä¼šæ¥æ”¶ä¸€ä¸ªå½“å‰èŠ‚ç‚¹çš„ <code>path</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ç±»å‹æ˜¯ <code>NodePath</code>ï¼Œè¯¥å¯¹è±¡æœ‰éå¸¸å¤šçš„å±æ€§ï¼Œä»¥ä¸‹ä»‹ç»å‡ ç§æœ€å¸¸ç”¨çš„ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>toString()</code></td>
<td>å½“å‰è·¯å¾„çš„æºç </td>
</tr>
<tr>
<td><code>node</code></td>
<td>å½“å‰è·¯å¾„çš„èŠ‚ç‚¹</td>
</tr>
<tr>
<td><code>parent</code></td>
<td>å½“å‰è·¯å¾„çš„çˆ¶çº§èŠ‚ç‚¹</td>
</tr>
<tr>
<td><code>parentPath</code></td>
<td>å½“å‰è·¯å¾„çš„çˆ¶çº§è·¯å¾„</td>
</tr>
<tr>
<td><code>type</code></td>
<td>å½“å‰è·¯å¾„çš„ç±»å‹</td>
</tr>
</tbody>
</table>
<p>PSï¼š<code>path</code> å¯¹è±¡é™¤äº†æœ‰å¾ˆå¤šå±æ€§ä»¥å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚æ›¿æ¢èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€æ’å…¥èŠ‚ç‚¹ã€å¯»æ‰¾çˆ¶çº§èŠ‚ç‚¹ã€è·å–åŒçº§èŠ‚ç‚¹ã€æ·»åŠ æ³¨é‡Šã€åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ç­‰ï¼Œå¯åœ¨éœ€è¦æ—¶æŸ¥è¯¢ç›¸å…³æ–‡æ¡£æˆ–æŸ¥çœ‹æºç ï¼Œåç»­ä»‹ç» <code>@babel/types</code> éƒ¨åˆ†å°†ä¼šä¸¾éƒ¨åˆ†ä¾‹å­æ¥æ¼”ç¤ºï¼Œä»¥åçš„å®æˆ˜æ–‡ç« ä¸­ä¹Ÿä¼šæœ‰ç›¸å…³å®ä¾‹ï¼Œç¯‡å¹…æœ‰é™æœ¬æ–‡ä¸å†ç»†è¯´ã€‚</p>
<p>å› æ­¤åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>path.node.value</code> å°±æ‹¿åˆ°äº†å˜é‡çš„å€¼ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥å¯¹å…¶è¿›è¡Œä¿®æ”¹äº†ã€‚ä»¥ä¸Šä»£ç è¿è¡Œåï¼Œæ‰€æœ‰æ•°å­—éƒ½ä¼šåŠ ä¸Š100åå†ä¹˜ä»¥2ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²éƒ½ä¼šè¢«æ›¿æ¢æˆ <code>I Love JavaScript!</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> a = <span class="hljs-number">3200</span>;
<span class="hljs-keyword">const</span> b = <span class="hljs-number">320</span>;
<span class="hljs-keyword">const</span> c = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>;
<span class="hljs-keyword">const</span> d = <span class="hljs-number">1774</span>;
<span class="hljs-keyword">const</span> e = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>;</code></pre>
<p>å¦‚æœå¤šä¸ªç±»å‹çš„èŠ‚ç‚¹ï¼Œå¤„ç†çš„æ–¹å¼éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ä½¿ç”¨ <code>|</code> å°†æ‰€æœ‰èŠ‚ç‚¹è¿æ¥æˆå­—ç¬¦ä¸²ï¼Œå°†åŒä¸€ä¸ªæ–¹æ³•åº”ç”¨åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-string">&quot;NumericLiteral|StringLiteral&quot;</span>(path) &#123;
        path.node.value = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>
    &#125;
&#125;</code></pre>
<p><code>visitor</code> å¯¹è±¡æœ‰å¤šç§å†™æ³•ï¼Œä»¥ä¸‹å‡ ç§å†™æ³•çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">NumericLiteral</span>(<span class="hljs-params">path</span>)</span>&#123;
        path.node.value = (path.node.value + <span class="hljs-number">100</span>) * <span class="hljs-number">2</span>
    &#125;,
    <span class="hljs-function"><span class="hljs-title">StringLiteral</span>(<span class="hljs-params">path</span>)</span>&#123;
        path.node.value = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>
    &#125;
&#125;</code></pre>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-attr">NumericLiteral</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>)</span>&#123;
        path.node.value = (path.node.value + <span class="hljs-number">100</span>) * <span class="hljs-number">2</span>
    &#125;,
    <span class="hljs-attr">StringLiteral</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>)</span>&#123;
        path.node.value = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>
    &#125;
&#125;</code></pre>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-attr">NumericLiteral</span>: &#123;
        <span class="hljs-function"><span class="hljs-title">enter</span>(<span class="hljs-params">path</span>)</span> &#123;
            path.node.value = (path.node.value + <span class="hljs-number">100</span>) * <span class="hljs-number">2</span>
        &#125;
    &#125;,
    <span class="hljs-attr">StringLiteral</span>: &#123;
        <span class="hljs-function"><span class="hljs-title">enter</span>(<span class="hljs-params">path</span>)</span> &#123;
            path.node.value = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>
        &#125;
    &#125;
&#125;</code></pre>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">enter</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-keyword">if</span> (path.node.type === <span class="hljs-string">&quot;NumericLiteral&quot;</span>) &#123;
            path.node.value = (path.node.value + <span class="hljs-number">100</span>) * <span class="hljs-number">2</span>
        &#125;
        <span class="hljs-keyword">if</span> (path.node.type === <span class="hljs-string">&quot;StringLiteral&quot;</span>) &#123;
            path.node.value = <span class="hljs-string">&quot;I Love JavaScript!&quot;</span>
        &#125;
    &#125;
&#125;</code></pre>
<p>ä»¥ä¸Šå‡ ç§å†™æ³•ä¸­æœ‰ç”¨åˆ°äº† <code>enter</code> æ–¹æ³•ï¼Œåœ¨èŠ‚ç‚¹çš„éå†è¿‡ç¨‹ä¸­ï¼Œè¿›å…¥èŠ‚ç‚¹ï¼ˆenterï¼‰ä¸é€€å‡ºï¼ˆexitï¼‰èŠ‚ç‚¹éƒ½ä¼šè®¿é—®ä¸€æ¬¡èŠ‚ç‚¹ï¼Œ<code>traverse</code> é»˜è®¤åœ¨è¿›å…¥èŠ‚ç‚¹æ—¶è¿›è¡ŒèŠ‚ç‚¹çš„å¤„ç†ï¼Œå¦‚æœè¦åœ¨é€€å‡ºèŠ‚ç‚¹æ—¶å¤„ç†ï¼Œé‚£ä¹ˆåœ¨ <code>visitor</code> ä¸­å°±å¿…é¡»å£°æ˜ <code>exit</code> æ–¹æ³•ã€‚</p>
<h3 id="babel-types">@babel/types</h3>
<p><code>@babel/types</code> ä¸»è¦ç”¨äºæ„å»ºæ–°çš„ AST èŠ‚ç‚¹ï¼Œå‰é¢çš„ç¤ºä¾‹ä»£ç ä¸º <code>const a = 1;</code>ï¼Œå¦‚æœæƒ³è¦å¢åŠ å†…å®¹ï¼Œæ¯”å¦‚å˜æˆ <code>const a = 1; const b = a * 5 + 1;</code>ï¼Œå°±å¯ä»¥é€šè¿‡ <code>@babel/types</code> æ¥å®ç°ã€‚</p>
<p>é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹ AST è¯­æ³•æ ‘ï¼ŒåŸè¯­å¥åªæœ‰ä¸€ä¸ª <code>VariableDeclaration</code> èŠ‚ç‚¹ï¼Œç°åœ¨å¢åŠ äº†ä¸€ä¸ªï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7319ba7290bf4d5c94d86c3c0d89e288.png" alt="10"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±æ˜¯åœ¨éå†èŠ‚ç‚¹æ—¶ï¼Œéå†åˆ° <code>VariableDeclaration</code> èŠ‚ç‚¹ï¼Œå°±åœ¨å…¶åé¢å¢åŠ ä¸€ä¸ª <code>VariableDeclaration</code> èŠ‚ç‚¹ï¼Œç”Ÿæˆ  <code>VariableDeclaration</code> èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>types.variableDeclaration()</code> æ–¹æ³•ï¼Œåœ¨ types ä¸­å„ç§æ–¹æ³•åç§°å’Œæˆ‘ä»¬åœ¨ AST ä¸­çœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é¦–å­—æ¯æ˜¯å°å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“æ‰€æœ‰æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤§è‡´æ¨æ–­å…¶æ–¹æ³•åï¼ŒåªçŸ¥é“è¿™ä¸ªæ–¹æ³•è¿˜ä¸è¡Œï¼Œè¿˜å¾—çŸ¥é“ä¼ å…¥çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥æŸ¥æ–‡æ¡£ï¼Œä¸è¿‡è¿™é‡Œæ¨èç›´æ¥çœ‹æºç ï¼Œéå¸¸æ¸…æ™°æ˜äº†ï¼Œä»¥ Pycharm ä¸ºä¾‹ï¼ŒæŒ‰ä½ Ctrl é”®ï¼Œå†ç‚¹å‡»æ–¹æ³•åï¼Œå°±è¿›åˆ°æºç é‡Œäº†ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/59b5979bae2fa54c199c8040f2442d04.png" alt="11"></p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">variableDeclaration</span>(<span class="hljs-params">kind: <span class="hljs-string">&quot;var&quot;</span> | <span class="hljs-string">&quot;let&quot;</span> | <span class="hljs-string">&quot;const&quot;</span>, declarations: <span class="hljs-built_in">Array</span>&lt;BabelNodeVariableDeclarator&gt;</span>)</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°éœ€è¦ <code>kind</code> å’Œ <code>declarations</code> ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ <code>declarations</code> æ˜¯ <code>VariableDeclarator</code> ç±»å‹çš„èŠ‚ç‚¹ç»„æˆçš„åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå†™å‡ºä»¥ä¸‹ <code>visitor</code> éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶ä¸­ <code>path.insertAfter()</code> æ˜¯åœ¨è¯¥èŠ‚ç‚¹ä¹‹åæ’å…¥æ–°èŠ‚ç‚¹çš„æ„æ€ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">VariableDeclaration</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-keyword">let</span> declaration = types.variableDeclaration(<span class="hljs-string">&quot;const&quot;</span>, [declarator])
        path.insertAfter(declaration)
    &#125;
&#125;</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥å®šä¹‰ <code>declarator</code>ï¼Œä¹Ÿå°±æ˜¯ <code>VariableDeclarator</code> ç±»å‹çš„èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢å…¶æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">variableDeclarator</span>(<span class="hljs-params">id: BabelNodeLVal, init?: BabelNodeExpression</span>)</span></code></pre>
<p>è§‚å¯Ÿ ASTï¼Œid ä¸º <code>Identifier</code> å¯¹è±¡ï¼Œinit ä¸º <code>BinaryExpression</code> å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/050533c545ec5244818054a2e2572cc4.png" alt="12"></p>
<p>å…ˆæ¥å¤„ç† idï¼Œå¯ä»¥ä½¿ç”¨ <code>types.identifier()</code> æ–¹æ³•æ¥ç”Ÿæˆï¼Œå…¶æºç ä¸º <code>function identifier(name: string)</code>ï¼Œname åœ¨è¿™é‡Œå°±æ˜¯ b äº†ï¼Œæ­¤æ—¶ <code>visitor</code> ä»£ç å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">VariableDeclaration</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-keyword">let</span> declarator = types.variableDeclarator(types.identifier(<span class="hljs-string">&quot;b&quot;</span>), init)
        <span class="hljs-keyword">let</span> declaration = types.variableDeclaration(<span class="hljs-string">&quot;const&quot;</span>, [declarator])
        path.insertAfter(declaration)
    &#125;
&#125;</code></pre>
<p>ç„¶åå†æ¥çœ‹ init è¯¥å¦‚ä½•å®šä¹‰ï¼Œé¦–å…ˆä»ç„¶æ˜¯çœ‹ AST ç»“æ„ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a927d6abed41d43251e3c3c2a432e46f.png" alt="13"></p>
<p>init ä¸º <code>BinaryExpression</code> å¯¹è±¡ï¼Œleft å·¦è¾¹æ˜¯ <code>BinaryExpression</code>ï¼Œright å³è¾¹æ˜¯ <code>NumericLiteral</code>ï¼Œå¯ä»¥ç”¨ <code>types.binaryExpression()</code> æ–¹æ³•æ¥ç”Ÿæˆ initï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binaryExpression</span>(<span class="hljs-params"></span></span>
<span class="hljs-params"><span class="hljs-function">    operator: <span class="hljs-string">&quot;+&quot;</span> | <span class="hljs-string">&quot;-&quot;</span> | <span class="hljs-string">&quot;/&quot;</span> | <span class="hljs-string">&quot;%&quot;</span> | <span class="hljs-string">&quot;*&quot;</span> | <span class="hljs-string">&quot;**&quot;</span> | <span class="hljs-string">&quot;&amp;&quot;</span> | <span class="hljs-string">&quot;|&quot;</span> | <span class="hljs-string">&quot;&gt;&gt;&quot;</span> | <span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span> | <span class="hljs-string">&quot;&lt;&lt;&quot;</span> | <span class="hljs-string">&quot;^&quot;</span> | <span class="hljs-string">&quot;==&quot;</span> | <span class="hljs-string">&quot;===&quot;</span> | <span class="hljs-string">&quot;!=&quot;</span> | <span class="hljs-string">&quot;!==&quot;</span> | <span class="hljs-string">&quot;in&quot;</span> | <span class="hljs-string">&quot;instanceof&quot;</span> | <span class="hljs-string">&quot;&gt;&quot;</span> | <span class="hljs-string">&quot;&lt;&quot;</span> | <span class="hljs-string">&quot;&gt;=&quot;</span> | <span class="hljs-string">&quot;&lt;=&quot;</span>,</span></span>
<span class="hljs-params"><span class="hljs-function">    left: BabelNodeExpression | BabelNodePrivateName, </span></span>
<span class="hljs-params"><span class="hljs-function">    right: BabelNodeExpression</span></span>
<span class="hljs-params"><span class="hljs-function"></span>)</span></code></pre>
<p>æ­¤æ—¶ <code>visitor</code> ä»£ç å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">VariableDeclaration</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-keyword">let</span> init = types.binaryExpression(<span class="hljs-string">&quot;+&quot;</span>, left, right)
        <span class="hljs-keyword">let</span> declarator = types.variableDeclarator(types.identifier(<span class="hljs-string">&quot;b&quot;</span>), init)
        <span class="hljs-keyword">let</span> declaration = types.variableDeclaration(<span class="hljs-string">&quot;const&quot;</span>, [declarator])
        path.insertAfter(declaration)
    &#125;
&#125;</code></pre>
<p>ç„¶åç»§ç»­æ„é€  left å’Œ rightï¼Œå’Œå‰é¢çš„æ–¹æ³•ä¸€æ ·ï¼Œè§‚å¯Ÿ AST è¯­æ³•æ ‘ï¼ŒæŸ¥è¯¢å¯¹åº”æ–¹æ³•åº”è¯¥ä¼ å…¥çš„å‚æ•°ï¼Œå±‚å±‚åµŒå¥—ï¼Œç›´åˆ°æŠŠæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ„é€ å®Œæ¯•ï¼Œæœ€ç»ˆçš„ <code>visitor</code> ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">VariableDeclaration</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-keyword">let</span> left = types.binaryExpression(<span class="hljs-string">&quot;*&quot;</span>, types.identifier(<span class="hljs-string">&quot;a&quot;</span>), types.numericLiteral(<span class="hljs-number">5</span>))
        <span class="hljs-keyword">let</span> right = types.numericLiteral(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">let</span> init = types.binaryExpression(<span class="hljs-string">&quot;+&quot;</span>, left, right)
        <span class="hljs-keyword">let</span> declarator = types.variableDeclarator(types.identifier(<span class="hljs-string">&quot;b&quot;</span>), init)
        <span class="hljs-keyword">let</span> declaration = types.variableDeclaration(<span class="hljs-string">&quot;const&quot;</span>, [declarator])
        path.insertAfter(declaration)
        path.stop()
    &#125;
&#125;</code></pre>
<p>æ³¨æ„ï¼š<code>path.insertAfter()</code> æ’å…¥èŠ‚ç‚¹è¯­å¥åé¢åŠ äº†ä¸€å¥ <code>path.stop()</code>ï¼Œè¡¨ç¤ºæ’å…¥å®Œæˆåç«‹å³åœæ­¢éå†å½“å‰èŠ‚ç‚¹å’Œåç»­çš„å­èŠ‚ç‚¹ï¼Œæ·»åŠ çš„æ–°èŠ‚ç‚¹ä¹Ÿæ˜¯ <code>VariableDeclaration</code>ï¼Œå¦‚æœä¸åŠ åœæ­¢è¯­å¥çš„è¯ï¼Œå°±ä¼šæ— é™å¾ªç¯æ’å…¥ä¸‹å»ã€‚</p>
<p>æ’å…¥æ–°èŠ‚ç‚¹åï¼Œå†è½¬æ¢æˆ JavaScript ä»£ç ï¼Œå°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€è¡Œæ–°ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/79269e1d54071214b2438eed3bf58d15.png" alt="14"></p>
<h2 id="å¸¸è§æ··æ·†è¿˜åŸ">å¸¸è§æ··æ·†è¿˜åŸ</h2>
<p>äº†è§£äº† AST å’Œ babel åï¼Œå°±å¯ä»¥å¯¹ JavaScript æ··æ·†ä»£ç è¿›è¡Œè¿˜åŸäº†ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æ ·ä¾‹ï¼Œå¸¦ä½ è¿›ä¸€æ­¥ç†Ÿæ‚‰ babel çš„å„ç§æ“ä½œã€‚</p>
<h3 id="å­—ç¬¦ä¸²è¿˜åŸ">å­—ç¬¦ä¸²è¿˜åŸ</h3>
<p>æ–‡ç« å¼€å¤´çš„å›¾ä¸­ä¸¾äº†ä¸ªä¾‹å­ï¼Œæ­£å¸¸å­—ç¬¦è¢«æ¢æˆäº† Unicode ç¼–ç ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-built_in">console</span>[<span class="hljs-string">&#x27;\u006c\u006f\u0067&#x27;</span>](<span class="hljs-string">&#x27;\u0048\u0065\u006c\u006c\u006f\u0020\u0077\u006f\u0072\u006c\u0064\u0021&#x27;</span>)</code></pre>
<p>è§‚å¯Ÿ AST ç»“æ„ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/59b4fc53c0c3aa2a0873a76a5d88c175.png" alt="15"></p>
<p>æˆ‘ä»¬å‘ç° Unicode ç¼–ç å¯¹åº”çš„æ˜¯ <code>raw</code>ï¼Œè€Œ <code>rawValue</code> å’Œ <code>value</code> éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† <code>raw</code> æ›¿æ¢æˆ <code>rawValue</code> æˆ– <code>value</code> å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¼•å·çš„é—®é¢˜ï¼Œæœ¬æ¥æ˜¯ <code>console[&quot;log&quot;]</code>ï¼Œä½ è¿˜åŸåå˜æˆäº† <code>console[log]</code>ï¼Œè‡ªç„¶ä¼šæŠ¥é”™çš„ï¼Œé™¤äº†æ›¿æ¢å€¼ä»¥å¤–ï¼Œè¿™é‡Œç›´æ¥åˆ é™¤ extra èŠ‚ç‚¹ï¼Œæˆ–è€…åˆ é™¤ raw å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹å‡ ç§å†™æ³•éƒ½å¯ä»¥è¿˜åŸä»£ç ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default

<span class="hljs-keyword">const</span> code = <span class="hljs-string">`console[&#x27;\u006c\u006f\u0067&#x27;](&#x27;\u0048\u0065\u006c\u006c\u006f\u0020\u0077\u006f\u0072\u006c\u0064\u0021&#x27;)`</span>
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">StringLiteral</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-comment">// ä»¥ä¸‹æ–¹æ³•å‡å¯</span>
        <span class="hljs-comment">// path.node.extra.raw = path.node.rawValue</span>
        <span class="hljs-comment">// path.node.extra.raw = &#x27;&quot;&#x27; + path.node.value + &#x27;&quot;&#x27;</span>
        <span class="hljs-comment">// delete path.node.extra</span>
        <span class="hljs-keyword">delete</span> path.node.extra.raw
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>è¿˜åŸç»“æœï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-built_in">console</span>[<span class="hljs-string">&quot;log&quot;</span>](<span class="hljs-string">&quot;Hello world!&quot;</span>);</code></pre>
<h3 id="è¡¨è¾¾å¼è¿˜åŸ">è¡¨è¾¾å¼è¿˜åŸ</h3>
<p>ä¹‹å‰å†™è¿‡ <a target="_blank" rel="noopener" href="https://itrhx.blog.csdn.net/article/details/122057377">JSFuck æ··æ·†çš„è¿˜åŸ</a>ï¼Œå…¶ä¸­æœ‰ä»‹ç» <code>![]</code> å¯è¡¨ç¤º falseï¼Œ<code>!![]</code> æˆ–è€… <code>!+[]</code> å¯è¡¨ç¤º trueï¼Œåœ¨ä¸€äº›æ··æ·†ä»£ç ä¸­ï¼Œç»å¸¸æœ‰è¿™äº›æ“ä½œï¼ŒæŠŠç®€å•çš„è¡¨è¾¾å¼å¤æ‚åŒ–ï¼Œå¾€å¾€éœ€è¦æ‰§è¡Œä¸€ä¸‹è¯­å¥ï¼Œæ‰èƒ½å¾—åˆ°çœŸæ­£çš„ç»“æœï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> a = !![]+!![]+!![];
<span class="hljs-keyword">const</span> b = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">12.34</span> * <span class="hljs-number">2.12</span>)
<span class="hljs-keyword">const</span> c = <span class="hljs-number">10</span> &gt;&gt; <span class="hljs-number">3</span> &lt;&lt; <span class="hljs-number">1</span>
<span class="hljs-keyword">const</span> d = <span class="hljs-built_in">String</span>(<span class="hljs-number">21.3</span> + <span class="hljs-number">14</span> * <span class="hljs-number">1.32</span>)
<span class="hljs-keyword">const</span> e = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">&quot;1.893&quot;</span> + <span class="hljs-string">&quot;45.9088&quot;</span>)
<span class="hljs-keyword">const</span> f = <span class="hljs-built_in">parseFloat</span>(<span class="hljs-string">&quot;23.2334&quot;</span> + <span class="hljs-string">&quot;21.89112&quot;</span>)
<span class="hljs-keyword">const</span> g = <span class="hljs-number">20</span> &lt; <span class="hljs-number">18</span> ? <span class="hljs-string">&#x27;æœªæˆå¹´&#x27;</span> : <span class="hljs-string">&#x27;æˆå¹´&#x27;</span></code></pre>
<p>æƒ³è¦æ‰§è¡Œè¯­å¥ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ <code>path.evaluate()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹ path å¯¹è±¡è¿›è¡Œæ‰§è¡Œæ“ä½œï¼Œè‡ªåŠ¨è®¡ç®—å‡ºç»“æœï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ <code>confident</code> å±æ€§è¡¨ç¤ºç½®ä¿¡åº¦ï¼Œ<code>value</code> è¡¨ç¤ºè®¡ç®—ç»“æœï¼Œä½¿ç”¨ <code>types.valueToNode()</code> æ–¹æ³•åˆ›å»ºèŠ‚ç‚¹ï¼Œä½¿ç”¨ <code>path.replaceInline()</code> æ–¹æ³•å°†èŠ‚ç‚¹æ›¿æ¢æˆè®¡ç®—ç»“æœç”Ÿæˆçš„æ–°èŠ‚ç‚¹ï¼Œæ›¿æ¢æ–¹æ³•æœ‰ä¸€ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><code>replaceWith</code>ï¼šç”¨ä¸€ä¸ªèŠ‚ç‚¹æ›¿æ¢å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>
<li><code>replaceWithMultiple</code>ï¼šç”¨å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>
<li><code>replaceWithSourceString</code>ï¼šå°†ä¼ å…¥çš„æºç å­—ç¬¦ä¸²è§£ææˆå¯¹åº” Node åå†æ›¿æ¢ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼›</li>
<li><code>replaceInline</code>ï¼šç”¨ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›¸å½“äºåŒæ—¶æœ‰äº†å‰ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>å¯¹åº”çš„ AST å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default
<span class="hljs-keyword">const</span> types = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/types&quot;</span>)

<span class="hljs-keyword">const</span> code = <span class="hljs-string">`</span>
<span class="hljs-string">const a = !![]+!![]+!![];</span>
<span class="hljs-string">const b = Math.floor(12.34 * 2.12)</span>
<span class="hljs-string">const c = 10 &gt;&gt; 3 &lt;&lt; 1</span>
<span class="hljs-string">const d = String(21.3 + 14 * 1.32)</span>
<span class="hljs-string">const e = parseInt(&quot;1.893&quot; + &quot;45.9088&quot;)</span>
<span class="hljs-string">const f = parseFloat(&quot;23.2334&quot; + &quot;21.89112&quot;)</span>
<span class="hljs-string">const g = 20 &lt; 18 ? &#x27;æœªæˆå¹´&#x27; : &#x27;æˆå¹´&#x27;</span>
<span class="hljs-string">`</span>
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-string">&quot;BinaryExpression|CallExpression|ConditionalExpression&quot;</span>(path) &#123;
        <span class="hljs-keyword">const</span> &#123;confident, value&#125; = path.evaluate()
        <span class="hljs-keyword">if</span> (confident)&#123;
            path.replaceInline(types.valueToNode(value))
        &#125;
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>æœ€ç»ˆç»“æœï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> a = <span class="hljs-number">3</span>;
<span class="hljs-keyword">const</span> b = <span class="hljs-number">26</span>;
<span class="hljs-keyword">const</span> c = <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> d = <span class="hljs-string">&quot;39.78&quot;</span>;
<span class="hljs-keyword">const</span> e = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">&quot;1.89345.9088&quot;</span>);
<span class="hljs-keyword">const</span> f = <span class="hljs-built_in">parseFloat</span>(<span class="hljs-string">&quot;23.233421.89112&quot;</span>);
<span class="hljs-keyword">const</span> g = <span class="hljs-string">&quot;\u6210\u5E74&quot;</span>;</code></pre>
<h3 id="åˆ é™¤æœªä½¿ç”¨å˜é‡">åˆ é™¤æœªä½¿ç”¨å˜é‡</h3>
<p>æœ‰æ—¶å€™ä»£ç é‡Œä¼šæœ‰ä¸€äº›å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°çš„å¤šä½™å˜é‡ï¼Œåˆ é™¤è¿™äº›å¤šä½™å˜é‡æœ‰åŠ©äºæ›´åŠ é«˜æ•ˆçš„åˆ†æä»£ç ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> b = a * <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> c = <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> d = b + <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> e = <span class="hljs-number">3</span>;
<span class="hljs-built_in">console</span>.log(d)</code></pre>
<p>åˆ é™¤å¤šä½™å˜é‡ï¼Œé¦–å…ˆè¦äº†è§£ <code>NodePath</code> ä¸­çš„ <code>scope</code>ï¼Œ<code>scope</code> çš„ä½œç”¨ä¸»è¦æ˜¯æŸ¥æ‰¾æ ‡è¯†ç¬¦çš„ä½œç”¨åŸŸã€è·å–å¹¶ä¿®æ”¹æ ‡è¯†ç¬¦çš„æ‰€æœ‰å¼•ç”¨ç­‰ï¼Œåˆ é™¤æœªä½¿ç”¨å˜é‡ä¸»è¦ç”¨åˆ°äº† <code>scope.getBinding()</code> æ–¹æ³•ï¼Œä¼ å…¥çš„å€¼æ˜¯å½“å‰èŠ‚ç‚¹èƒ½å¤Ÿå¼•ç”¨åˆ°çš„æ ‡è¯†ç¬¦åç§°ï¼Œè¿”å›çš„å…³é”®å±æ€§æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li><code>identifier</code>ï¼šæ ‡è¯†ç¬¦çš„ Node å¯¹è±¡ï¼›</li>
<li><code>path</code>ï¼šæ ‡è¯†ç¬¦çš„ NodePath å¯¹è±¡ï¼›</li>
<li><code>constant</code>ï¼šæ ‡è¯†ç¬¦æ˜¯å¦ä¸ºå¸¸é‡ï¼›</li>
<li><code>referenced</code>ï¼šæ ‡è¯†ç¬¦æ˜¯å¦è¢«å¼•ç”¨ï¼›</li>
<li><code> references</code>ï¼šæ ‡è¯†ç¬¦è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼›</li>
<li><code>constantViolations</code>ï¼šå¦‚æœæ ‡è¯†ç¬¦è¢«ä¿®æ”¹ï¼Œåˆ™ä¼šå­˜æ”¾æ‰€æœ‰ä¿®æ”¹è¯¥æ ‡è¯†ç¬¦èŠ‚ç‚¹çš„ Path å¯¹è±¡ï¼›</li>
<li><code>referencePaths</code>ï¼šå¦‚æœæ ‡è¯†ç¬¦è¢«å¼•ç”¨ï¼Œåˆ™ä¼šå­˜æ”¾æ‰€æœ‰å¼•ç”¨è¯¥æ ‡è¯†ç¬¦èŠ‚ç‚¹çš„ Path å¯¹è±¡ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>constantViolations</code>ã€<code>referenced</code>ã€<code>references</code>ã€<code>referencePaths</code> å¤šä¸ªå‚æ•°æ¥åˆ¤æ–­å˜é‡æ˜¯å¦å¯ä»¥è¢«åˆ é™¤ï¼ŒAST å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default

<span class="hljs-keyword">const</span> code = <span class="hljs-string">`</span>
<span class="hljs-string">const a = 1;</span>
<span class="hljs-string">const b = a * 2;</span>
<span class="hljs-string">const c = 2;</span>
<span class="hljs-string">const d = b + 1;</span>
<span class="hljs-string">const e = 3;</span>
<span class="hljs-string">console.log(d)</span>
<span class="hljs-string">`</span>
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">VariableDeclarator</span>(<span class="hljs-params">path</span>)</span>&#123;
        <span class="hljs-keyword">const</span> binding = path.scope.getBinding(path.node.id.name);

        <span class="hljs-comment">// å¦‚æ ‡è¯†ç¬¦è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™ä¸èƒ½è¿›è¡Œåˆ é™¤åŠ¨ä½œã€‚</span>
        <span class="hljs-keyword">if</span> (!binding || binding.constantViolations.length &gt; <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">return</span>;
        &#125;

        <span class="hljs-comment">// æœªè¢«å¼•ç”¨</span>
        <span class="hljs-keyword">if</span> (!binding.referenced) &#123;
            path.remove();
        &#125;

        <span class="hljs-comment">// è¢«å¼•ç”¨æ¬¡æ•°ä¸º0</span>
        <span class="hljs-comment">// if (binding.references === 0) &#123;</span>
        <span class="hljs-comment">//     path.remove();</span>
        <span class="hljs-comment">// &#125;</span>

        <span class="hljs-comment">// é•¿åº¦ä¸º0ï¼Œå˜é‡æ²¡æœ‰è¢«å¼•ç”¨è¿‡</span>
        <span class="hljs-comment">// if (binding.referencePaths.length === 0) &#123;</span>
        <span class="hljs-comment">//     path.remove();</span>
        <span class="hljs-comment">// &#125;</span>
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>å¤„ç†åçš„ä»£ç ï¼ˆæœªä½¿ç”¨çš„ bã€cã€e å˜é‡å·²è¢«åˆ é™¤ï¼‰ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> b = a * <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> d = b + <span class="hljs-number">1</span>;
<span class="hljs-built_in">console</span>.log(d);</code></pre>
<h3 id="åˆ é™¤å†—ä½™é€»è¾‘ä»£ç ">åˆ é™¤å†—ä½™é€»è¾‘ä»£ç </h3>
<p>æœ‰æ—¶å€™ä¸ºäº†å¢åŠ é€†å‘éš¾åº¦ï¼Œä¼šæœ‰å¾ˆå¤šåµŒå¥—çš„ if-else è¯­å¥ï¼Œå¤§é‡åˆ¤æ–­ä¸ºå‡çš„å†—ä½™é€»è¾‘ä»£ç ï¼ŒåŒæ ·å¯ä»¥åˆ©ç”¨ AST å°†å…¶åˆ é™¤æ‰ï¼Œåªç•™ä¸‹åˆ¤æ–­ä¸ºçœŸçš„ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> example = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">let</span> a;
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span>) &#123;
        a = <span class="hljs-number">1</span>;
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span>) &#123;
            a = <span class="hljs-number">2</span>;
        &#125;
        <span class="hljs-keyword">else</span> &#123;
            a = <span class="hljs-number">3</span>;
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> a;
&#125;;</code></pre>
<p>è§‚å¯Ÿ ASTï¼Œåˆ¤æ–­æ¡ä»¶å¯¹åº”çš„æ˜¯ <code>test</code> èŠ‚ç‚¹ï¼Œif å¯¹åº”çš„æ˜¯ <code>consequent</code> èŠ‚ç‚¹ï¼Œelse å¯¹åº”çš„æ˜¯ <code>alternate</code> èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/11bee2b313c5327859074428625a9348.png" alt="16"></p>
<p>AST å¤„ç†æ€è·¯ä»¥åŠä»£ç ï¼š</p>
<ol>
<li>ç­›é€‰å‡º <code>BooleanLiteral</code> å’Œ <code>NumericLiteral</code> èŠ‚ç‚¹ï¼Œå–å…¶å¯¹åº”çš„å€¼ï¼Œå³ <code>path.node.test.value</code>ï¼›</li>
<li>åˆ¤æ–­ <code>value</code> å€¼ä¸ºçœŸï¼Œåˆ™å°†èŠ‚ç‚¹æ›¿æ¢æˆ <code>consequent</code> èŠ‚ç‚¹ä¸‹çš„å†…å®¹ï¼Œå³ <code>path.node.consequent.body</code>ï¼›</li>
<li>åˆ¤æ–­ <code>value</code> å€¼ä¸ºå‡ï¼Œåˆ™æ›¿æ¢æˆ <code>alternate</code> èŠ‚ç‚¹ä¸‹çš„å†…å®¹ï¼Œå³ <code>path.node.alternate.body</code>ï¼›</li>
<li>æœ‰çš„ if è¯­å¥å¯èƒ½æ²¡æœ‰å†™ elseï¼Œä¹Ÿå°±æ²¡æœ‰ <code>alternate</code>ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹åˆ¤æ–­ <code>value</code> å€¼ä¸ºå‡ï¼Œåˆ™ç›´æ¥ç§»é™¤è¯¥èŠ‚ç‚¹ï¼Œå³ <code>path.remove()</code></li>
</ol>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default
<span class="hljs-keyword">const</span> types = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/types&#x27;</span>);

<span class="hljs-keyword">const</span> code = <span class="hljs-string">`</span>
<span class="hljs-string">const example = function () &#123;</span>
<span class="hljs-string">    let a;</span>
<span class="hljs-string">    if (false) &#123;</span>
<span class="hljs-string">        a = 1;</span>
<span class="hljs-string">    &#125; else &#123;</span>
<span class="hljs-string">        if (1) &#123;</span>
<span class="hljs-string">            a = 2;</span>
<span class="hljs-string">        &#125;</span>
<span class="hljs-string">        else &#123;</span>
<span class="hljs-string">            a = 3;</span>
<span class="hljs-string">        &#125;</span>
<span class="hljs-string">    &#125;</span>
<span class="hljs-string">    return a;</span>
<span class="hljs-string">&#125;;</span>
<span class="hljs-string">`</span>
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">enter</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-keyword">if</span> (types.isBooleanLiteral(path.node.test) || types.isNumericLiteral(path.node.test)) &#123;
            <span class="hljs-keyword">if</span> (path.node.test.value) &#123;
                path.replaceInline(path.node.consequent.body);
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-keyword">if</span> (path.node.alternate) &#123;
                    path.replaceInline(path.node.alternate.body);
                &#125; <span class="hljs-keyword">else</span> &#123;
                    path.remove()
                &#125;
            &#125;
        &#125;
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>å¤„ç†ç»“æœï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> example = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">let</span> a;
  a = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">return</span> a;
&#125;;</code></pre>
<h3 id="switch-case-åæ§åˆ¶æµå¹³å¦åŒ–">switch-case åæ§åˆ¶æµå¹³å¦åŒ–</h3>
<p>æ§åˆ¶æµå¹³å¦åŒ–æ˜¯æ··æ·†å½“ä¸­æœ€å¸¸è§çš„ï¼Œé€šè¿‡ <code>if-else</code> æˆ–è€… <code>while-switch-case</code> è¯­å¥åˆ†è§£æ­¥éª¤ï¼Œç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> _0x34e16a = <span class="hljs-string">&#x27;3,4,0,5,1,2&#x27;</span>[<span class="hljs-string">&#x27;split&#x27;</span>](<span class="hljs-string">&#x27;,&#x27;</span>);
<span class="hljs-keyword">let</span> _0x2eff02 = <span class="hljs-number">0x0</span>;
<span class="hljs-keyword">while</span> (!![]) &#123;
    <span class="hljs-keyword">switch</span> (_0x34e16a[_0x2eff02++]) &#123;
        <span class="hljs-keyword">case</span><span class="hljs-string">&#x27;0&#x27;</span>:
            <span class="hljs-keyword">let</span> _0x38cb15 = _0x4588f1 + _0x470e97;
            <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">case</span><span class="hljs-string">&#x27;1&#x27;</span>:
            <span class="hljs-keyword">let</span> _0x1e0e5e = _0x37b9f3[_0x50cee0(<span class="hljs-number">0x2e0</span>, <span class="hljs-number">0x2e8</span>, <span class="hljs-number">0x2e1</span>, <span class="hljs-number">0x2e4</span>)];
            <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">case</span><span class="hljs-string">&#x27;2&#x27;</span>:
            <span class="hljs-keyword">let</span> _0x35d732 = [_0x388d4b(-<span class="hljs-number">0x134</span>, -<span class="hljs-number">0x134</span>, -<span class="hljs-number">0x139</span>, -<span class="hljs-number">0x138</span>)](_0x38cb15 &gt;&gt; _0x4588f1);
            <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">case</span><span class="hljs-string">&#x27;3&#x27;</span>:
            <span class="hljs-keyword">let</span> _0x4588f1 = <span class="hljs-number">0x1</span>;
            <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">case</span><span class="hljs-string">&#x27;4&#x27;</span>:
            <span class="hljs-keyword">let</span> _0x470e97 = <span class="hljs-number">0x2</span>;
            <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">case</span><span class="hljs-string">&#x27;5&#x27;</span>:
            <span class="hljs-keyword">let</span> _0x37b9f3 = <span class="hljs-number">0x5</span> || _0x38cb15;
            <span class="hljs-keyword">continue</span>;
    &#125;
    <span class="hljs-keyword">break</span>;
&#125;</code></pre>
<p>AST è¿˜åŸæ€è·¯ï¼š</p>
<ol>
<li>è·å–æ§åˆ¶æµåŸå§‹æ•°ç»„ï¼Œå°† <code>'3,4,0,5,1,2'['split'](',')</code> ä¹‹ç±»çš„è¯­å¥è½¬åŒ–æˆ <code>['3','4','0','5','1','2']</code> ä¹‹ç±»çš„æ•°ç»„ï¼Œå¾—åˆ°è¯¥æ•°ç»„ä¹‹åï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æŠŠ split è¯­å¥å¯¹åº”çš„èŠ‚ç‚¹åˆ é™¤æ‰ï¼Œå› ä¸ºæœ€ç»ˆä»£ç é‡Œè¿™æ¡è¯­å¥å°±æ²¡ç”¨äº†ï¼›</li>
<li>éå†ç¬¬ä¸€æ­¥å¾—åˆ°çš„æ§åˆ¶æµæ•°ç»„ï¼Œä¾æ¬¡å–å‡ºæ¯ä¸ªå€¼æ‰€å¯¹åº”çš„ case èŠ‚ç‚¹ï¼›</li>
<li>å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå‚¨å­˜æ¯ä¸ª case èŠ‚ç‚¹ <code>consequent</code> æ•°ç»„é‡Œé¢çš„å†…å®¹ï¼Œå¹¶åˆ é™¤ <code>continue</code> è¯­å¥å¯¹åº”çš„èŠ‚ç‚¹ï¼›</li>
<li>éå†å®Œæˆåï¼Œå°†ç¬¬ä¸‰æ­¥çš„æ•°ç»„æ›¿æ¢æ‰æ•´ä¸ª while èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ <code>WhileStatement</code>ã€‚</li>
</ol>
<p>ä¸åŒæ€è·¯ï¼Œå†™æ³•å¤šæ ·ï¼Œå¯¹äºå¦‚ä½•è·å–æ§åˆ¶æµæ•°ç»„ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹æ€è·¯ï¼š</p>
<ol>
<li>è·å–åˆ° <code>While</code> è¯­å¥èŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨ <code>path.getAllPrevSiblings()</code> æ–¹æ³•è·å–å…¶å‰é¢çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œéå†æ¯ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œæ‰¾åˆ°ä¸ <code>switch()</code> é‡Œé¢æ•°ç»„çš„å˜é‡åç›¸åŒçš„èŠ‚ç‚¹ï¼Œç„¶åå†å–èŠ‚ç‚¹çš„å€¼è¿›è¡Œåç»­å¤„ç†ï¼›</li>
<li>ç›´æ¥å– <code>switch()</code> é‡Œé¢æ•°ç»„çš„å˜é‡åï¼Œç„¶åä½¿ç”¨ <code>scope.getBinding()</code> æ–¹æ³•è·å–åˆ°å®ƒç»‘å®šçš„èŠ‚ç‚¹ï¼Œç„¶åå†å–è¿™ä¸ªèŠ‚ç‚¹çš„å€¼è¿›è¡Œåç»­å¤„ç†ã€‚</li>
</ol>
<p>æ‰€ä»¥ AST å¤„ç†ä»£ç å°±æœ‰ä¸¤ç§å†™æ³•ï¼Œæ–¹æ³•ä¸€ï¼šï¼ˆcode.js å³ä¸ºå‰é¢çš„ç¤ºä¾‹ä»£ç ï¼Œä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œè¿™é‡Œä½¿ç”¨ fs ä»æ–‡ä»¶ä¸­è¯»å–ä»£ç ï¼‰</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default
<span class="hljs-keyword">const</span> types = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/types&quot;</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);

<span class="hljs-keyword">const</span> code = fs.readFileSync(<span class="hljs-string">&quot;code.js&quot;</span>, &#123;<span class="hljs-attr">encoding</span>: <span class="hljs-string">&quot;utf-8&quot;</span>&#125;);
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">WhileStatement</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-comment">// switch èŠ‚ç‚¹</span>
        <span class="hljs-keyword">let</span> switchNode = path.node.body.body[<span class="hljs-number">0</span>];
        <span class="hljs-comment">// switch è¯­å¥å†…çš„æ§åˆ¶æµæ•°ç»„åï¼Œæœ¬ä¾‹ä¸­æ˜¯ _0x34e16a</span>
        <span class="hljs-keyword">let</span> arrayName = switchNode.discriminant.object.name;
        <span class="hljs-comment">// è·å¾—æ‰€æœ‰ while å‰é¢çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œæœ¬ä¾‹ä¸­è·å–åˆ°çš„æ˜¯å£°æ˜ä¸¤ä¸ªå˜é‡çš„èŠ‚ç‚¹ï¼Œå³ const _0x34e16a å’Œ let _0x2eff02</span>
        <span class="hljs-keyword">let</span> prevSiblings = path.getAllPrevSiblings();
        <span class="hljs-comment">// å®šä¹‰ç¼“å­˜æ§åˆ¶æµæ•°ç»„</span>
        <span class="hljs-keyword">let</span> array = []
        <span class="hljs-comment">// forEach æ–¹æ³•éå†æ‰€æœ‰èŠ‚ç‚¹</span>
        prevSiblings.forEach(<span class="hljs-function"><span class="hljs-params">pervNode</span> =&gt;</span> &#123;
            <span class="hljs-keyword">let</span> &#123;id, init&#125; = pervNode.node.declarations[<span class="hljs-number">0</span>];
            <span class="hljs-comment">// å¦‚æœèŠ‚ç‚¹ id.name ä¸ switch è¯­å¥å†…çš„æ§åˆ¶æµæ•°ç»„åç›¸åŒ</span>
            <span class="hljs-keyword">if</span> (arrayName === id.name) &#123;
                <span class="hljs-comment">// è·å–èŠ‚ç‚¹æ•´ä¸ªè¡¨è¾¾å¼çš„å‚æ•°ã€åˆ†å‰²æ–¹æ³•ã€åˆ†éš”ç¬¦</span>
                <span class="hljs-keyword">let</span> object = init.callee.object.value;
                <span class="hljs-keyword">let</span> property = init.callee.property.value;
                <span class="hljs-keyword">let</span> argument = init.arguments[<span class="hljs-number">0</span>].value;
                <span class="hljs-comment">// æ¨¡æ‹Ÿæ‰§è¡Œ &#x27;3,4,0,5,1,2&#x27;[&#x27;split&#x27;](&#x27;,&#x27;) è¯­å¥</span>
                array = object[property](argument)
                <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç›´æ¥å–å‚æ•°è¿›è¡Œåˆ†å‰²ï¼Œæ–¹æ³•ä¸é€šç”¨ï¼Œæ¯”å¦‚åˆ†éš”ç¬¦æ¢æˆ | å°±ä¸è¡Œäº†</span>
                <span class="hljs-comment">// array = init.callee.object.value.split(&#x27;,&#x27;);</span>
            &#125;
            <span class="hljs-comment">// å‰é¢çš„å…„å¼ŸèŠ‚ç‚¹å°±å¯ä»¥åˆ é™¤äº†</span>
            pervNode.remove();
        &#125;);

        <span class="hljs-comment">// å‚¨å­˜æ­£ç¡®é¡ºåºçš„æ§åˆ¶æµè¯­å¥</span>
        <span class="hljs-keyword">let</span> replace = [];
        <span class="hljs-comment">// éå†æ§åˆ¶æµæ•°ç»„ï¼ŒæŒ‰æ­£ç¡®é¡ºåºå– case å†…å®¹</span>
        array.forEach(<span class="hljs-function"><span class="hljs-params">index</span> =&gt;</span> &#123;
                <span class="hljs-keyword">let</span> consequent = switchNode.cases[index].consequent;
                <span class="hljs-comment">// å¦‚æœæœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯ continue è¯­å¥ï¼Œåˆ™åˆ é™¤ ContinueStatement èŠ‚ç‚¹</span>
                <span class="hljs-keyword">if</span> (types.isContinueStatement(consequent[consequent.length - <span class="hljs-number">1</span>])) &#123;
                    consequent.pop();
                &#125;
                <span class="hljs-comment">// concat æ–¹æ³•æ‹¼æ¥å¤šä¸ªæ•°ç»„ï¼Œå³æ­£ç¡®é¡ºåºçš„ case å†…å®¹</span>
                replace = replace.concat(consequent);
            &#125;
        );
        <span class="hljs-comment">// æ›¿æ¢æ•´ä¸ª while èŠ‚ç‚¹ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥</span>
        path.replaceWithMultiple(replace);
        <span class="hljs-comment">// path.replaceInline(replace);</span>
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>æ–¹æ³•äºŒï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);
<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).default
<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).default
<span class="hljs-keyword">const</span> types = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/types&quot;</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);

<span class="hljs-keyword">const</span> code = fs.readFileSync(<span class="hljs-string">&quot;code.js&quot;</span>, &#123;<span class="hljs-attr">encoding</span>: <span class="hljs-string">&quot;utf-8&quot;</span>&#125;);
<span class="hljs-keyword">const</span> ast = parser.parse(code)

<span class="hljs-keyword">const</span> visitor = &#123;
    <span class="hljs-function"><span class="hljs-title">WhileStatement</span>(<span class="hljs-params">path</span>)</span> &#123;
        <span class="hljs-comment">// switch èŠ‚ç‚¹</span>
        <span class="hljs-keyword">let</span> switchNode = path.node.body.body[<span class="hljs-number">0</span>];
        <span class="hljs-comment">// switch è¯­å¥å†…çš„æ§åˆ¶æµæ•°ç»„åï¼Œæœ¬ä¾‹ä¸­æ˜¯ _0x34e16a</span>
        <span class="hljs-keyword">let</span> arrayName = switchNode.discriminant.object.name;
        <span class="hljs-comment">// è·å–æ§åˆ¶æµæ•°ç»„ç»‘å®šçš„èŠ‚ç‚¹</span>
        <span class="hljs-keyword">let</span> bindingArray = path.scope.getBinding(arrayName);
        <span class="hljs-comment">// è·å–èŠ‚ç‚¹æ•´ä¸ªè¡¨è¾¾å¼çš„å‚æ•°ã€åˆ†å‰²æ–¹æ³•ã€åˆ†éš”ç¬¦</span>
        <span class="hljs-keyword">let</span> init = bindingArray.path.node.init;
        <span class="hljs-keyword">let</span> object = init.callee.object.value;
        <span class="hljs-keyword">let</span> property = init.callee.property.value;
        <span class="hljs-keyword">let</span> argument = init.arguments[<span class="hljs-number">0</span>].value;
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ‰§è¡Œ &#x27;3,4,0,5,1,2&#x27;[&#x27;split&#x27;](&#x27;,&#x27;) è¯­å¥</span>
        <span class="hljs-keyword">let</span> array = object[property](argument)
        <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç›´æ¥å–å‚æ•°è¿›è¡Œåˆ†å‰²ï¼Œæ–¹æ³•ä¸é€šç”¨ï¼Œæ¯”å¦‚åˆ†éš”ç¬¦æ¢æˆ | å°±ä¸è¡Œäº†</span>
        <span class="hljs-comment">// let array = init.callee.object.value.split(&#x27;,&#x27;);</span>

        <span class="hljs-comment">// switch è¯­å¥å†…çš„æ§åˆ¶æµè‡ªå¢å˜é‡åï¼Œæœ¬ä¾‹ä¸­æ˜¯ _0x2eff02</span>
        <span class="hljs-keyword">let</span> autoIncrementName = switchNode.discriminant.property.argument.name;
        <span class="hljs-comment">// è·å–æ§åˆ¶æµè‡ªå¢å˜é‡åç»‘å®šçš„èŠ‚ç‚¹</span>
        <span class="hljs-keyword">let</span> bindingAutoIncrement = path.scope.getBinding(autoIncrementName);
        <span class="hljs-comment">// å¯é€‰æ‹©çš„æ“ä½œï¼šåˆ é™¤æ§åˆ¶æµæ•°ç»„ç»‘å®šçš„èŠ‚ç‚¹ã€è‡ªå¢å˜é‡åç»‘å®šçš„èŠ‚ç‚¹</span>
        bindingArray.path.remove();
        bindingAutoIncrement.path.remove();

        <span class="hljs-comment">// å‚¨å­˜æ­£ç¡®é¡ºåºçš„æ§åˆ¶æµè¯­å¥</span>
        <span class="hljs-keyword">let</span> replace = [];
        <span class="hljs-comment">// éå†æ§åˆ¶æµæ•°ç»„ï¼ŒæŒ‰æ­£ç¡®é¡ºåºå– case å†…å®¹</span>
        array.forEach(<span class="hljs-function"><span class="hljs-params">index</span> =&gt;</span> &#123;
                <span class="hljs-keyword">let</span> consequent = switchNode.cases[index].consequent;
                <span class="hljs-comment">// å¦‚æœæœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯ continue è¯­å¥ï¼Œåˆ™åˆ é™¤ ContinueStatement èŠ‚ç‚¹</span>
                <span class="hljs-keyword">if</span> (types.isContinueStatement(consequent[consequent.length - <span class="hljs-number">1</span>])) &#123;
                    consequent.pop();
                &#125;
                <span class="hljs-comment">// concat æ–¹æ³•æ‹¼æ¥å¤šä¸ªæ•°ç»„ï¼Œå³æ­£ç¡®é¡ºåºçš„ case å†…å®¹</span>
                replace = replace.concat(consequent);
            &#125;
        );
        <span class="hljs-comment">// æ›¿æ¢æ•´ä¸ª while èŠ‚ç‚¹ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥</span>
        path.replaceWithMultiple(replace);
        <span class="hljs-comment">// path.replaceInline(replace);</span>
    &#125;
&#125;

traverse(ast, visitor)
<span class="hljs-keyword">const</span> result = generate(ast)
<span class="hljs-built_in">console</span>.log(result.code)</code></pre>
<p>ä»¥ä¸Šä»£ç è¿è¡Œåï¼ŒåŸæ¥çš„ <code>switch-case</code> æ§åˆ¶æµå°±è¢«è¿˜åŸäº†ï¼Œå˜æˆäº†æŒ‰é¡ºåºä¸€è¡Œä¸€è¡Œçš„ä»£ç ï¼Œæ›´åŠ ç®€æ´æ˜äº†ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">let</span> _0x4588f1 = <span class="hljs-number">0x1</span>;
<span class="hljs-keyword">let</span> _0x470e97 = <span class="hljs-number">0x2</span>;
<span class="hljs-keyword">let</span> _0x38cb15 = _0x4588f1 + _0x470e97;
<span class="hljs-keyword">let</span> _0x37b9f3 = <span class="hljs-number">0x5</span> || _0x38cb15;
<span class="hljs-keyword">let</span> _0x1e0e5e = _0x37b9f3[_0x50cee0(<span class="hljs-number">0x2e0</span>, <span class="hljs-number">0x2e8</span>, <span class="hljs-number">0x2e1</span>, <span class="hljs-number">0x2e4</span>)];
<span class="hljs-keyword">let</span> _0x35d732 = [_0x388d4b(-<span class="hljs-number">0x134</span>, -<span class="hljs-number">0x134</span>, -<span class="hljs-number">0x139</span>, -<span class="hljs-number">0x138</span>)](_0x38cb15 &gt;&gt; _0x4588f1);</code></pre>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<p>æœ¬æ–‡æœ‰å‚è€ƒä»¥ä¸‹èµ„æ–™ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒæ¨èçš„åœ¨çº¿å­¦ä¹ èµ„æ–™ï¼š</p>
<ul>
<li>Youtube è§†é¢‘ï¼ŒBabel å…¥é—¨ï¼š<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=UeVq_U5obnE">https://www.youtube.com/watch?v=UeVq_U5obnE</a></li>
<li>å®˜æ–¹æ‰‹å†Œ Babel Handbookï¼š<a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/babel-handbook">https://github.com/jamiebuilds/babel-handbook</a></li>
<li>éå®˜æ–¹ Babel API ä¸­æ–‡æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://evilrecluse.top/Babel-traverse-api-doc/">https://evilrecluse.top/Babel-traverse-api-doc/</a></li>
</ul>
<h2 id="END">END</h2>
<p>Babel ç¼–è¯‘å™¨å›½å†…çš„èµ„æ–™å…¶å®ä¸æ˜¯å¾ˆå¤šï¼Œå¤šçœ‹æºç ã€åŒæ—¶åœ¨çº¿å¯¹ç…§å¯è§†åŒ–çš„ AST è¯­æ³•æ ‘ï¼Œè€å¿ƒä¸€ç‚¹å„¿ä¸€å±‚ä¸€å±‚åˆ†æå³å¯ï¼Œæœ¬æ–‡ä¸­çš„æ¡ˆä¾‹ä¹Ÿåªæ˜¯æœ€åŸºæœ¬æ“ä½œï¼Œå®é™…é‡åˆ°ä¸€äº›æ··æ·†è¿˜å¾—è§†æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚éœ€è¦åŠ ä¸€äº›ç±»å‹åˆ¤æ–­æ¥é™åˆ¶ç­‰ï¼Œåç»­ä¼šç”¨å®æˆ˜æ¥å¸¦é¢†å¤§å®¶è¿›ä¸€æ­¥ç†Ÿæ‚‰è§£æ··æ·†å½“ä¸­çš„å…¶ä»–æ“ä½œã€‚</p>

            </div>
        </article>
    </div>
    <br>
    
        <div class="next-prev-post">
            
                <div class="prev-post">
                    <div class="prev gt-c-content-color-first">
                        ä¸Šä¸€ç¯‡ï¼š<a href="/article/052/" 
                            class="post-title gt-a-link">AST è„±æ··æ·†å®æˆ˜ï¼ŒæŸ ICP å¤‡æ¡ˆå·æŸ¥è¯¢æ¥å£ jsjiami v6 åˆ†æ</a>
                    </div>
                </div>
            
            
                <div class="next-post">
                    <div class="next gt-c-content-color-first">
                        ä¸‹ä¸€ç¯‡ï¼š<a href="/article/050/" 
                            class="post-title gt-a-link">ç½‘æ´›è€…åçˆ¬ç»ƒä¹ å¹³å°ç¬¬ä¸ƒé¢˜ï¼šJSVMPZL åˆä½“éªŒ</a>
                    </div>
                </div>
            
        </div>
    
    

    
    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>

    <div id="gitalk-container"></div>

    <script>
    var gitalk = new Gitalk({
        clientID: 'd19a84b9d9a2ddb2c6b9',
        clientSecret: 'cec9feae5129a6106edc68ce06d167be8eb06021',
        repo: 'trhx.github.io',
        owner: 'TRHX',
        admin: ['TRHX'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false       // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
    </script>


    
</div>

                <div class="site-footer gt-c-content-color-first">
    <div class="footer-main">
        <!-- å»ºè®®ä¿ç•™ç‰ˆæƒä¿¡æ¯æˆ–è€…æ·»åŠ ä¸»é¢˜ä¿¡æ¯åˆ°å‹é“¾ï¼Œæ„Ÿè°¢æ‚¨çš„ç†è§£ -->
        <!-- æ–‡ä»¶ä½ç½®ï¼šlayout/_includes/footer.ejs -->
        <!-- <span style="text-align: right; float: right;">
            Theme 
            <a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a>
             | Powered by
            <a href="https://hexo.io" target="_blank">Hexo</a>
        </span>
        <span style="text-align: left;"></span> -->
        <span>
            <div class="itbob-github-badge">
                <span class="badge-subject">PV</span>
                <span class="badge-value bg-blue" id="busuanzi_value_site_pv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">UV</span>
                <span class="badge-value bg-pink" id="busuanzi_value_site_uv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">WordCount</span>
                <span class="badge-value bg-firebrick post-count">256.8k</span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">Powered</span>
                <span class="badge-value bg-brightgreen"><a href="https://hexo.io" target="_blank">Hexo</a></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">Theme</span>
                <span class="badge-value bg-orange"><a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a></span>
            </div>
        </span>
        <br/>
        <br/>

        <span>
            <img src="/img/footer/icp.png" alt="ICP" style="width:auto; height:18px; margin-bottom:-2px"><a href="https://beian.miit.gov.cn/" target="_blank"> é„‚ICPå¤‡19003281å·-6</a> ä¸¨
            <img src="/img/footer/moeicp.png" alt="MOE ICP" style="width:auto; height:16px; margin-bottom:-2px"><a href="https://icp.gov.moe/" target="_blank"> èŒICPå¤‡20202022å·</a> ä¸¨
            <img src="/img/footer/webify.png" alt="è…¾è®¯äº‘å¼€å‘ Webify" style="width:auto; height:20px; margin-bottom:-5px"><a href="https://webify.cloudbase.net/" target="_blank"> è…¾è®¯äº‘å¼€å‘ Webify</a> ä¸¨
            <a href="https://www.foreverblog.cn/" target="_blank"><img src="/img/footer/foreverblog.png" alt="åå¹´ä¹‹çº¦" style="width:auto; height:14px; margin-bottom:-1px"></a>
        </span>
        <br/>
        <br/>

        <span style="text-align: center; float: center;">
            Copyright Â© 2018-<span id="displayDateTime"></span> <a href="https://www.itbob.cn/" target="_blank">ITBOB.CN</a> ä¸¨
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> ä¸¨
            <span id="sitetime">æ­£åœ¨è½½å…¥ç½‘ç«™è¿è¡Œæ—¶é—´...</span>
            <script>
                function siteTime(){
                    window.setTimeout("siteTime()", 1000);
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth()+1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    /* 
                    Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
                    year - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
                    month - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
                    day - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
                    hours - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
                    minutes - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
                    seconds - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
                    microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
                    */
                    var t1 = Date.UTC(2018,08,10,17,38,00); //åŒ—äº¬æ—¶é—´2018-8-10 17:38:00
                    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
                    var diff = t2-t1;
                    var diffYears = Math.floor(diff/years);
                    var diffDays = Math.floor((diff/days)-diffYears*365);
                    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
                    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
                    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
                    document.getElementById("sitetime").innerHTML="æœ¬ç«™å·²è¿è¡Œäº† "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ† "+diffSeconds+" ç§’";
                }
                siteTime();
            </script>

            <script>
                var copyrightNow = new Date().getFullYear();
                document.getElementById("displayDateTime").innerHTML = copyrightNow;
            </script>
        </span>
    </div>
</div>

            </div>
        </div>
    </body>
</html>