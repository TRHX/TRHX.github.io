<!-- 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
-->

<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Title -->
<title>Loguru：Python 日志终极解决方案 - BOB&#39;S BLOG</title>

<!-- Icon -->
<link rel="icon" href="/img/favicon.png">

<!-- Fonts -->
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" as="style" onload="this.onload=null, this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>


    <!-- KaTeX -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" as="style" onload="this.onload=null, this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"></noscript>


<!-- Style -->

<link rel="stylesheet" href="/styles/main.css">

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-pure@1.0.1/dist/main.css"> -->



<!-- 不蒜子 -->
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script async src="/js/busuanzi.pure.mini.js"></script>

<!-- 打字效果 -->
<!-- https://www.typeitjs.com/ -->
<script src="https://unpkg.com/typeit@8.7.0/dist/index.umd.js"></script>

<script>
    function makeMulti (string) {
        let l = new String(string)
        l = l.substring(l.indexOf("/*") + 3, l.lastIndexOf("*/"))
        return l
    }
    let string = function () {
      /* 
          _____                   _______                   _____          
          /\    \                 /::\    \                 /\    \         
         /::\    \               /::::\    \               /::\    \        
        /::::\    \             /::::::\    \             /::::\    \       
       /::::::\    \           /::::::::\    \           /::::::\    \      
      /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \     
     /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \    
    /::::\   \:::\    \     /:::/    / \:::\    \     /::::\   \:::\    \   
   /::::::\   \:::\    \   /:::/____/   \:::\____\   /::::::\   \:::\    \  
  /:::/\:::\   \:::\ ___\ |:::|    |     |:::|    | /:::/\:::\   \:::\ ___\ 
 /:::/__\:::\   \:::|    ||:::|____|     |:::|    |/:::/__\:::\   \:::|    |
 \:::\   \:::\  /:::|____| \:::\    \   /:::/    / \:::\   \:::\  /:::|____|
  \:::\   \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\/:::/    / 
   \:::\   \::::::/    /     \:::\    /:::/    /     \:::\   \::::::/    /  
    \:::\   \::::/    /       \:::\__/:::/    /       \:::\   \::::/    /   
     \:::\  /:::/    /         \::::::::/    /         \:::\  /:::/    /    
      \:::\/:::/    /           \::::::/    /           \:::\/:::/    /     
       \::::::/    /             \::::/    /             \::::::/    /      
        \::::/    /               \::/____/               \::::/    /       
         \::/____/                 ~~                      \::/____/        
          ~~                                                ~~              
                                                                            
                                WWW.ITBOB.CN
                                
                        有毛的叫程序猿，沒毛的叫程序员。
      */
    }
    console.log(makeMulti(string));
    console.log("\n %c © ITBOB'S BLOG %c https://www.itbob.cn %c © ITRHX'S BLOG %c https://www.itrhx.com \n", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;", "color: #fadfa3; background: #030307; padding:5px 0;", "background: #fadfa3; padding:5px 0;")
</script>


    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">


    <meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BOB'S BLOG" type="application/atom+xml">
</head>
    <body>
        <div class="main gt-bg-theme-color-first">
            <div class="main-content">
                <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/img/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first" id="typeitspan">
            <!-- BOB&#39;S BLOG -->
        </div>
    </a>
    <!-- <span id="typeitspan"></span> -->
    <script>
        new TypeIt('#typeitspan', {
        strings: "BOB'S BLOG",
        speed: 150, 
        afterComplete: function (instance) {
            instance.destroy();
        }
        }).go();
    </script>
    <button aria-label="Navbar Toggler" class="navbar-toggler" type="button" id="changeNavbar">
        <i class="gt-c-content-color-first" style="font-size: 18px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="18px" fill="currentColor">
                <path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z" />
            </svg>
        </i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center; ">
            
                
                    <div class="nav-item">
                        <a href="/" class="menu gt-a-link" target="_self">首页</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/archives/" class="menu gt-a-link" target="_self">归档</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/tags/" class="menu gt-a-link" target="_self">标签</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/friends/" class="menu gt-a-link" target="_self">友链</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="/about/" class="menu gt-a-link" target="_self">关于</a>
                    </div>
                
            
                
                    <div class="nav-item">
                        <a href="https://travellings.link" target="_blank">
                            <img src="/img/travelling.gif" alt="开往-友链接力" width="auto" height="25px">
                        </a>
                    </div>
                
            
        </div>
    </div>
</nav>

<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function() {
        let element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else { 
            element.style.display = 'none';
        }
    }
</script>

                <div class="post-container">
    <div class="post-detail gt-bg-theme-color-second gt-c-content-color-first">
        <article class="gt-post-content">
            <h1 class="post-title">Loguru：Python 日志终极解决方案</h1>
            <div class="post-info">
                <time class="post-time gt-c-content-color-first">
                    · 2021-11-04 ·</time>
                
                    
                        <a href="/tags/Python/" class="post-tag">
                            #Python</a>
                    
                
            </div>
            <hr>
            <div class="post-content gt-c-content-color-first">
                <h2 id="日志的重要性">日志的重要性</h2>
<p>日志的作用非常重要，日志可以记录用户的操作、程序的异常，还可以为数据分析提供依据，日志的存在意义就是为了能够在程序在运行过程中记录错误，方便维护和调试，能够快速定位出错的地方，减少维护成本。每个程序员都应该知道，不是为了记录日志而记录日志，日志也不是随意记的。要实现能够只通过日志文件还原整个程序执行的过程，达到能透明地看到程序里执行情况，每个线程、每个过程到底执行到哪的目的。日志就像飞机的黑匣子一样，应当能够复原异常的整个现场乃至细节！</p>
<h2 id="常见日志记录方式">常见日志记录方式</h2>
<h3 id="一、print">一、print()</h3>
<p>最常见的是把输出函数 <code>print()</code> 当作日志记录的方式，直接打印各种提示信息，常见于个人练习项目里，通常是懒得单独配置日志，而且项目太小不需要日志信息，不需要上线，不需要持续运行，完整的项目不推荐直接打印日志信息，现实中也几乎没有人这么做。</p>
<h3 id="二、自写模板">二、自写模板</h3>
<p>我们可以在不少小项目里面看到作者自己写了一个日志模板，通常利用 <code>print()</code> 或者 <code>sys.stdout</code> 稍微封装一下即可实现简单的日志输出，这里的 <code>sys.stdout</code> 是 Python 中的标准输出流，<code>print()</code> 函数是对 <code>sys.stdout</code> 的高级封装，当我们在 Python 中打印对象调用 <code>print(obj)</code> 时候，事实上是调用了 <code>sys.stdout.write(obj+'\n')</code>，<code>print()</code> 将内容打印到了控制台，然后追加了一个换行符 <code>\n</code>。</p>
<p>自写日志模板适合比较小的项目，可以按照自己的喜好编写模板，不需要太多复杂配置，方便快捷，但是这种记录日志的方式并不是很规范，有可能你自己觉得阅读体验不错，但是别人在接触你的项目的时候往往需要花费一定的时间去学习日志的逻辑、格式、输出方式等，比较大的项目同样不推荐这种方法。</p>
<p>一个简单的自写日志模板举例：</p>
<p>日志模板 <a target="_blank" rel="noopener" href="http://log.py">log.py</a>：</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> traceback
<span class="hljs-keyword">import</span> datetime


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getnowtime</span>():</span>
    <span class="hljs-keyword">return</span> datetime.datetime.now().strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_log</span>(<span class="hljs-params">content, level, *args</span>):</span>
    sys.stdout.write(<span class="hljs-string">&quot;%s - %s - %s\n&quot;</span> % (getnowtime(), level, content))
    <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> args:
        sys.stdout.write(<span class="hljs-string">&quot;%s\n&quot;</span> % arg)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>(<span class="hljs-params">content, *args</span>):</span>
    _log(content, <span class="hljs-string">&#x27;DEBUG&#x27;</span>, *args)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">info</span>(<span class="hljs-params">content, *args</span>):</span>
    _log(content, <span class="hljs-string">&#x27;INFO&#x27;</span>, *args)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">warn</span>(<span class="hljs-params">content, *args</span>):</span>
    _log(content, <span class="hljs-string">&#x27;WARN&#x27;</span>, *args)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">content, *args</span>):</span>
    _log(content, <span class="hljs-string">&#x27;ERROR&#x27;</span>, *args)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exception</span>(<span class="hljs-params">content</span>):</span>
    sys.stdout.write(<span class="hljs-string">&quot;%s - %s\n&quot;</span> % (getnowtime(), content))
    traceback.print_exc(file=sys.stdout)</code></pre>
<p>调用日志模块：</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> log


log.info(<span class="hljs-string">&quot;This is log info!&quot;</span>)
log.warn(<span class="hljs-string">&quot;This is log warn!&quot;</span>)
log.error(<span class="hljs-string">&quot;This is log error!&quot;</span>)
log.debug(<span class="hljs-string">&quot;This is log debug!&quot;</span>)

people_info = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">20</span>&#125;

<span class="hljs-keyword">try</span>:
    gender = people_info[<span class="hljs-string">&quot;gender&quot;</span>]
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> error:
    log.exception(error)</code></pre>
<p>日志输出：</p>
<pre><code class="hljs python"><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> 09:<span class="hljs-number">50</span>:<span class="hljs-number">58</span> - INFO - This <span class="hljs-keyword">is</span> log info!
<span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> 09:<span class="hljs-number">50</span>:<span class="hljs-number">58</span> - WARN - This <span class="hljs-keyword">is</span> log warn!
<span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> 09:<span class="hljs-number">50</span>:<span class="hljs-number">58</span> - ERROR - This <span class="hljs-keyword">is</span> log error!
<span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> 09:<span class="hljs-number">50</span>:<span class="hljs-number">58</span> - DEBUG - This <span class="hljs-keyword">is</span> log debug!
<span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> 09:<span class="hljs-number">50</span>:<span class="hljs-number">58</span> - <span class="hljs-string">&#x27;gender&#x27;</span>
Traceback (most recent call last):
  File <span class="hljs-string">&quot;D:/python3Project/test.py&quot;</span>, line <span class="hljs-number">18</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    gender = people_info[<span class="hljs-string">&quot;gender&quot;</span>]
KeyError: <span class="hljs-string">&#x27;gender&#x27;</span></code></pre>
<h3 id="三、Logging">三、Logging</h3>
<p>在一个完整的项目中，大多数人都会引入专门的日志记录库，而 Python 自带的标准库 logging 就是专门为日志记录而生的，logging 模块定义的函数和类为应用程序和库的开发实现了一个灵活的事件日志系统。由标准库模块提供日志记录 API 的关键好处是所有 Python 模块都可以使用这个日志记录功能。所以，你的应用日志可以将你自己的日志信息与来自第三方模块的信息整合起来。</p>
<p>logging 模块虽然强大，但是其配置也是比较繁琐的，在大型项目中通常需要单独初始化日志、配置日志格式等等，我在日常使用中通常都会对 logging 做如下的封装写法，使日志可以按天保存，保留15天的日志，可以配置是否输出到控制台和文件，如下所示：</p>
<pre><code class="hljs python"><span class="hljs-comment"># 实现按天分割保留日志</span>


<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> logging <span class="hljs-keyword">import</span> handlers


PARENT_DIR = os.path.split(os.path.realpath(__file__))[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 父目录</span>
LOGGING_DIR = os.path.join(PARENT_DIR, <span class="hljs-string">&quot;log&quot;</span>)              <span class="hljs-comment"># 日志目录</span>
LOGGING_NAME = <span class="hljs-string">&quot;test&quot;</span>                                      <span class="hljs-comment"># 日志文件名</span>

LOGGING_TO_FILE = <span class="hljs-literal">True</span>                                     <span class="hljs-comment"># 日志输出文件</span>
LOGGING_TO_CONSOLE = <span class="hljs-literal">True</span>                                  <span class="hljs-comment"># 日志输出到控制台</span>

LOGGING_WHEN = <span class="hljs-string">&#x27;D&#x27;</span>                                         <span class="hljs-comment"># 日志文件切分维度</span>
LOGGING_INTERVAL = <span class="hljs-number">1</span>                                       <span class="hljs-comment"># 间隔少个 when 后，自动重建文件</span>
LOGGING_BACKUP_COUNT = <span class="hljs-number">15</span>                                  <span class="hljs-comment"># 日志保留个数，0 保留所有日志</span>
LOGGING_LEVEL = logging.DEBUG                              <span class="hljs-comment"># 日志等级</span>
LOGGING_suffix = <span class="hljs-string">&quot;%Y.%m.%d.log&quot;</span>                            <span class="hljs-comment"># 旧日志文件名</span>

<span class="hljs-comment"># 日志输出格式</span>
LOGGING_FORMATTER = <span class="hljs-string">&quot;%(levelname)s - %(asctime)s - process:%(process)d - %(filename)s - %(name)s - line:%(lineno)d - %(module)s - %(message)s&quot;</span>


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logging_init</span>():</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(LOGGING_DIR):
        os.makedirs(LOGGING_DIR)
    logger = logging.getLogger()
    logger.setLevel(LOGGING_LEVEL)
    formatter = logging.Formatter(LOGGING_FORMATTER)

    <span class="hljs-keyword">if</span> LOGGING_TO_FILE:
        file_handler = handlers.TimedRotatingFileHandler(filename=os.path.join(LOGGING_DIR, LOGGING_NAME), when=LOGGING_WHEN, interval=LOGGING_INTERVAL, backupCount=LOGGING_BACKUP_COUNT)
        file_handler.suffix = LOGGING_suffix
        file_handler.setFormatter(formatter)
        logger.addHandler(file_handler)

    <span class="hljs-keyword">if</span> LOGGING_TO_CONSOLE:
        stream_handler = logging.StreamHandler(sys.stderr)
        stream_handler.setFormatter(formatter)
        logger.addHandler(stream_handler)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logging_test</span>():</span>
    logging.info(<span class="hljs-string">&quot;This is log info!&quot;</span>)
    logging.warning(<span class="hljs-string">&quot;This is log warn!&quot;</span>)
    logging.error(<span class="hljs-string">&quot;This is log error!&quot;</span>)
    logging.debug(<span class="hljs-string">&quot;This is log debug!&quot;</span>)
    people_info = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">20</span>&#125;

    <span class="hljs-keyword">try</span>:
        gender = people_info[<span class="hljs-string">&quot;gender&quot;</span>]
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> error:
        logging.exception(error)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    logging_init()
    logging_test()</code></pre>
<p>输出日志：</p>
<pre><code class="hljs bash">INFO - 2021-10-19 11:28:10,103 - process:15144 - test.py - root - line:52 - <span class="hljs-built_in">test</span> - This is <span class="hljs-built_in">log</span> info!
WARNING - 2021-10-19 11:28:10,105 - process:15144 - test.py - root - line:53 - <span class="hljs-built_in">test</span> - This is <span class="hljs-built_in">log</span> warn!
ERROR - 2021-10-19 11:28:10,105 - process:15144 - test.py - root - line:54 - <span class="hljs-built_in">test</span> - This is <span class="hljs-built_in">log</span> error!
DEBUG - 2021-10-19 11:28:10,105 - process:15144 - test.py - root - line:55 - <span class="hljs-built_in">test</span> - This is <span class="hljs-built_in">log</span> debug!
ERROR - 2021-10-19 11:28:10,105 - process:15144 - test.py - root - line:61 - <span class="hljs-built_in">test</span> - <span class="hljs-string">&#x27;gender&#x27;</span>
Traceback (most recent call last):
  File <span class="hljs-string">&quot;D:/python3Project/test.py&quot;</span>, line 59, <span class="hljs-keyword">in</span> logging_test
    gender = people_info[<span class="hljs-string">&quot;gender&quot;</span>]
KeyError: <span class="hljs-string">&#x27;gender&#x27;</span></code></pre>
<p>它在控制台中是这样的：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/906ed37334702098905b7cff083f2c6e.png" alt="02.png"></p>
<p>当然，如果你不需要很复杂的功能，希望简洁一点，仅仅需要在控制台输出一下日志的话，也可以只进行简单的配置：</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> logging
logging.basicConfig(level=logging.DEBUG, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)
logging.getLogger()</code></pre>
<h2 id="更优雅的解决方案：Loguru">更优雅的解决方案：Loguru</h2>
<p>对于 logging 模块，即便是简单的使用，也需要自己定义格式，这里介绍一个更加优雅、高效、简洁的第三方模块：loguru，官方的介绍是：Loguru is a library which aims to bring enjoyable logging in Python. Loguru 旨在为 Python 带来愉快的日志记录。这里引用官方的一个 GIF 来快速演示其功能：</p>
<p><img src="https://img-blog.csdnimg.cn/d2cfb68d514240209779ae9dac5a42cb.gif#pic_center" alt="02.gif"></p>
<hr>
<h3 id="安装">安装</h3>
<p>Loguru 仅支持 Python 3.5 及以上的版本，使用 pip 安装即可：</p>
<pre><code class="hljs bash">pip install loguru</code></pre>
<hr>
<h3 id="开箱即用">开箱即用</h3>
<p>Loguru 的主要概念是只有一个：logger</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger

logger.info(<span class="hljs-string">&quot;This is log info!&quot;</span>)
logger.warning(<span class="hljs-string">&quot;This is log warn!&quot;</span>)
logger.error(<span class="hljs-string">&quot;This is log error!&quot;</span>)
logger.debug(<span class="hljs-string">&quot;This is log debug!&quot;</span>)</code></pre>
<p>控制台输出：</p>
<p><img src="https://img-blog.csdnimg.cn/345214edaba24e988379399393ac0a7f.png" alt="03.png"></p>
<p>可以看到不需要手动设置，Loguru 会提前配置一些基础信息，自动输出时间、日志级别、模块名、行号等信息，而且根据等级的不同，还自动设置了不同的颜色，方便观察，真正做到了开箱即用！</p>
<hr>
<h3 id="add-remove">add() / remove()</h3>
<p>如果想自定义日志级别，自定义日志格式，保存日志到文件该怎么办？与 logging 模块不同，不需要 Handler，不需要 Formatter，只需要一个 <code>add()</code> 函数就可以了，例如我们想把日志储存到文件：</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger

logger.add(<span class="hljs-string">&#x27;test.log&#x27;</span>)
logger.debug(<span class="hljs-string">&#x27;this is a debug&#x27;</span>)</code></pre>
<p>我们不需要像 logging 模块一样再声明一个 FileHandler 了，就一行 <code>add()</code> 语句搞定，运行之后会发现目录下 test.log 里面同样出现了刚刚控制台输出的 debug 信息。</p>
<p>与 <code>add()</code> 语句相反，<code>remove()</code> 语句可以删除我们添加的配置：</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger

log_file = logger.add(<span class="hljs-string">&#x27;test.log&#x27;</span>)
logger.debug(<span class="hljs-string">&#x27;This is log debug!&#x27;</span>)
logger.remove(log_file)
logger.debug(<span class="hljs-string">&#x27;This is another log debug!&#x27;</span>)</code></pre>
<p>此时控制台会输出两条 debug 信息：</p>
<pre><code class="hljs bash">2021-10-19 13:53:36.610 | DEBUG    | __main__:&lt;module&gt;:86 - This is <span class="hljs-built_in">log</span> debug!
2021-10-19 13:53:36.611 | DEBUG    | __main__:&lt;module&gt;:88 - This is another <span class="hljs-built_in">log</span> debug!</code></pre>
<p>而 test.log 日志文件里面只有一条 debug  信息，原因就在于我们在第二条 debug 语句之前使用了 <code>remove()</code> 语句。</p>
<hr>
<h3 id="完整参数">完整参数</h3>
<p>Loguru 对输出到文件的配置有非常强大的支持，比如支持输出到多个文件，分级别分别输出，过大创建新文件，过久自动删除等等。 下面我们来详细看一下 <code>add()</code> 语句的详细参数：</p>
<p>基本语法：</p>
<pre><code class="hljs python">add(sink, *, level=<span class="hljs-string">&#x27;DEBUG&#x27;</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;&lt;green&gt;&#123;time:YYYY-MM-DD HH:mm:ss.SSS&#125;&lt;/green&gt; | &lt;level&gt;&#123;level: &lt;8&#125;&lt;/level&gt; | &lt;cyan&gt;&#123;name&#125;&lt;/cyan&gt;:&lt;cyan&gt;&#123;function&#125;&lt;/cyan&gt;:&lt;cyan&gt;&#123;line&#125;&lt;/cyan&gt; - &lt;level&gt;&#123;message&#125;&lt;/level&gt;&#x27;</span>, <span class="hljs-built_in">filter</span>=<span class="hljs-literal">None</span>, colorize=<span class="hljs-literal">None</span>, serialize=<span class="hljs-literal">False</span>, backtrace=<span class="hljs-literal">True</span>, diagnose=<span class="hljs-literal">True</span>, enqueue=<span class="hljs-literal">False</span>, catch=<span class="hljs-literal">True</span>, **kwargs)</code></pre>
<p><strong>基本参数释义：</strong></p>
<ul>
<li><strong>sink</strong>：可以是一个 file 对象，例如 <code>sys.stderr</code> 或 <code>open('file.log', 'w')</code>，也可以是 <code>str</code> 字符串或者 <code>pathlib.Path</code> 对象，即文件路径，也可以是一个方法，可以自行定义输出实现，也可以是一个 logging 模块的 Handler，比如 FileHandler、StreamHandler 等，还可以是 <a target="_blank" rel="noopener" href="https://docs.python.org/3/glossary.html#term-coroutine-function">coroutine function</a>，即一个返回协程对象的函数等。</li>
<li><strong>level</strong>：日志输出和保存级别。</li>
<li><strong>format</strong>：日志格式模板。</li>
<li><strong>filter</strong>：一个可选的指令，用于决定每个记录的消息是否应该发送到 sink。</li>
<li><strong>colorize</strong>：格式化消息中包含的颜色标记是否应转换为用于终端着色的 ansi 代码，或以其他方式剥离。 如果没有，则根据 sink 是否为 tty（电传打字机缩写） 自动做出选择。</li>
<li><strong>serialize</strong>：在发送到 sink 之前，是否应首先将记录的消息转换为 JSON 字符串。</li>
<li><strong>backtrace</strong>：格式化的异常跟踪是否应该向上扩展，超出捕获点，以显示生成错误的完整堆栈跟踪。</li>
<li><strong>diagnose</strong>：异常跟踪是否应显示变量值以简化调试。建议在生产环境中设置 <code>False</code>，避免泄露敏感数据。</li>
<li><strong>enqueue</strong>：要记录的消息是否应在到达 sink 之前首先通过多进程安全队列，这在通过多个进程记录到文件时很有用，这样做的好处还在于使日志记录调用是非阻塞的。</li>
<li><strong>catch</strong>：是否应自动捕获 sink 处理日志消息时发生的错误，如果为 <code>True</code>，则会在 <code>sys.stderr</code> 上显示异常消息，但该异常不会传播到 sink，从而防止应用程序崩溃。</li>
<li>*<strong>*kwargs</strong>：仅对配置协程或文件接收器有效的附加参数（见下文）。</li>
</ul>
<p><strong>当且仅当 sink 是协程函数时，以下参数适用：</strong></p>
<ul>
<li><strong>loop</strong>：将在其中调度和执行异步日志记录任务的事件循环。如果为 <code>None</code>，将使用 <code>asyncio.get_event_loop()</code> 返回的循环。</li>
</ul>
<p><strong>当且仅当 sink 是文件路径时，以下参数适用：</strong></p>
<ul>
<li><strong>rotation</strong>：一种条件，指示何时应关闭当前记录的文件并开始新的文件。</li>
<li>**retention **：过滤旧文件的指令，在循环或程序结束期间会删除旧文件。</li>
<li><strong>compression</strong>：日志文件在关闭时应转换为的压缩或存档格式。</li>
<li><strong>delay</strong>：是在配置 sink 后立即创建文件，还是延迟到第一条记录的消息时再创建。默认为 <code>False</code>。</li>
<li><strong>mode</strong>：内置 <code>open()</code> 函数的打开模式，默认为 <code>a</code>（以追加模式打开文件）。</li>
<li><strong>buffering</strong>：内置 <code>open()</code> 函数的缓冲策略，默认为<code>1</code>（行缓冲文件）。</li>
<li><strong>encoding</strong>：内置 <code>open()</code> 函数的文件编码，如果 <code>None</code>，则默认为 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/locale.html#locale.getpreferredencoding"><code>locale.getpreferredencoding()</code></a>。</li>
<li>*<strong>*kwargs</strong>：其他传递给内置 <code>open()</code> 函数的参数。</li>
</ul>
<p>这么多参数可以见识到 <code>add()</code> 函数的强大之处，仅仅一个函数就能实现 logging 模块的诸多功能，接下来介绍几个比较常用的方法。</p>
<hr>
<h3 id="rotation-日志文件分隔">rotation 日志文件分隔</h3>
<p><code>add()</code> 函数的 rotation 参数，可以实现按照固定时间创建新的日志文件，比如设置每天 0 点新创建一个 log 文件：</p>
<pre><code class="hljs python">logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, rotation=<span class="hljs-string">&#x27;00:00&#x27;</span>)</code></pre>
<p>设置超过 500 MB 新创建一个 log 文件：</p>
<pre><code class="hljs python">logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, rotation=<span class="hljs-string">&quot;500 MB&quot;</span>)</code></pre>
<p>设置每隔一个周新创建一个 log 文件：</p>
<pre><code class="hljs python">logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, rotation=<span class="hljs-string">&#x27;1 week&#x27;</span>)</code></pre>
<hr>
<h3 id="retention-日志保留时间">retention 日志保留时间</h3>
<p><code>add()</code> 函数的 retention 参数，可以设置日志的最长保留时间，比如设置日志文件最长保留 15 天：</p>
<pre><code class="hljs python">logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, retention=<span class="hljs-string">&#x27;15 days&#x27;</span>)</code></pre>
<p>设置日志文件最多保留 10 个：</p>
<pre><code class="hljs python">logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, retention=<span class="hljs-number">10</span>)</code></pre>
<p>也可以是一个 <code>datetime.timedelta</code> 对象，比如设置日志文件最多保留 5 个小时：</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger

logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, retention=datetime.timedelta(hours=<span class="hljs-number">5</span>))</code></pre>
<hr>
<h3 id="compression-日志压缩格式">compression 日志压缩格式</h3>
<p><code>add()</code> 函数的 compression 参数，可以配置日志文件的压缩格式，这样可以更加节省存储空间，比如设置使用 zip 文件格式保存：</p>
<pre><code class="hljs python">logger.add(<span class="hljs-string">&#x27;runtime_&#123;time&#125;.log&#x27;</span>, compression=<span class="hljs-string">&#x27;zip&#x27;</span>)</code></pre>
<p>其格式支持：<code>gz</code>、<code>bz2</code>、<code>xz</code>、<code>lzma</code>、<code>tar</code>、<code>tar.gz</code>、<code>tar.bz2</code>、<code>tar.xz</code></p>
<hr>
<h3 id="字符串格式化">字符串格式化</h3>
<p>Loguru 在输出 log 的时候还提供了非常友好的字符串格式化功能，相当于 <code>str.format()</code>：</p>
<pre><code class="hljs python">logger.info(<span class="hljs-string">&#x27;If you are using Python &#123;&#125;, prefer &#123;feature&#125; of course!&#x27;</span>, <span class="hljs-number">3.6</span>, feature=<span class="hljs-string">&#x27;f-strings&#x27;</span>)</code></pre>
<p>输出：</p>
<pre><code class="hljs python"><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> <span class="hljs-number">14</span>:<span class="hljs-number">59</span>:<span class="hljs-number">06.412</span> | INFO     | __main__:&lt;module&gt;:<span class="hljs-number">3</span> - If you are using Python <span class="hljs-number">3.6</span>, prefer f-strings of course!</code></pre>
<hr>
<h3 id="异常追溯">异常追溯</h3>
<p>在 Loguru 里可以直接使用它提供的装饰器就可以直接进行异常捕获，而且得到的日志是无比详细的：</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger


<span class="hljs-meta">@logger.catch</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_function</span>(<span class="hljs-params">x, y, z</span>):</span>
    <span class="hljs-comment"># An error? It&#x27;s caught anyway!</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (x + y + z)


my_function(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</code></pre>
<p>日志输出：</p>
<pre><code class="hljs python"><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">19</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">51.675</span> | ERROR    | __main__:&lt;module&gt;:<span class="hljs-number">10</span> - An error has been caught <span class="hljs-keyword">in</span> function <span class="hljs-string">&#x27;&lt;module&gt;&#x27;</span>, process <span class="hljs-string">&#x27;MainProcess&#x27;</span> (<span class="hljs-number">30456</span>), thread <span class="hljs-string">&#x27;MainThread&#x27;</span> (<span class="hljs-number">26268</span>):
Traceback (most recent call last):

&gt; File <span class="hljs-string">&quot;D:/python3Project\test.py&quot;</span>, line <span class="hljs-number">10</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    my_function(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    └ &lt;function my_function at <span class="hljs-number">0x014CDFA8</span>&gt;

  File <span class="hljs-string">&quot;D:/python3Project\test.py&quot;</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> my_function
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (x + y + z)
                │   │   └ <span class="hljs-number">0</span>
                │   └ <span class="hljs-number">0</span>
                └ <span class="hljs-number">0</span>

ZeroDivisionError: division by zero</code></pre>
<p>在控制台的输出是这样的：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/3b7fd75ef2a10a5a0dde917280d9224c.png" alt="04.png"></p>
<p>相比 Logging，Loguru 无论是在配置方面、日志输出样式还是异常追踪，都远优于 Logging，使用 Loguru 无疑能提升开发人员效率。本文仅介绍了一些常用的方法，想要详细了解可参考 <a target="_blank" rel="noopener" href="https://loguru.readthedocs.io/">Loguru 官方文档</a>或关注 <a target="_blank" rel="noopener" href="https://github.com/Delgan/loguru">Loguru GitHub</a>。</p>

            </div>
        </article>
    </div>
    <br>
    
        <div class="next-prev-post">
            
                <div class="prev-post">
                    <div class="prev gt-c-content-color-first">
                        上一篇：<a href="/article/043/" 
                            class="post-title gt-a-link">WebSocket 协议爬虫，智慧树扫码登录案例分析</a>
                    </div>
                </div>
            
            
                <div class="next-post">
                    <div class="next gt-c-content-color-first">
                        下一篇：<a href="/article/041/" 
                            class="post-title gt-a-link">认识 SM1/SM2/SM3/SM4/SM7/SM9/ZUC 国密算法</a>
                    </div>
                </div>
            
        </div>
    
    

    
    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>

    <div id="gitalk-container"></div>

    <script>
    var gitalk = new Gitalk({
        clientID: 'd19a84b9d9a2ddb2c6b9',
        clientSecret: 'cec9feae5129a6106edc68ce06d167be8eb06021',
        repo: 'trhx.github.io',
        owner: 'TRHX',
        admin: ['TRHX'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false       // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
    </script>


    
</div>

                <div class="site-footer gt-c-content-color-first">
    <div class="footer-main">
        <!-- 建议保留版权信息或者添加主题信息到友链，感谢您的理解 -->
        <!-- 文件位置：layout/_includes/footer.ejs -->
        <!-- <span style="text-align: right; float: right;">
            Theme 
            <a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a>
             | Powered by
            <a href="https://hexo.io" target="_blank">Hexo</a>
        </span>
        <span style="text-align: left;"></span> -->
        <span>
            <div class="itbob-github-badge">
                <span class="badge-subject">PV</span>
                <span class="badge-value bg-blue" id="busuanzi_value_site_pv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">UV</span>
                <span class="badge-value bg-pink" id="busuanzi_value_site_uv"></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">WordCount</span>
                <span class="badge-value bg-firebrick post-count">256.8k</span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">Powered</span>
                <span class="badge-value bg-brightgreen"><a href="https://hexo.io" target="_blank">Hexo</a></span>
            </div>
            <div class="itbob-github-badge">
                <span class="badge-subject">Theme</span>
                <span class="badge-value bg-orange"><a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a></span>
            </div>
        </span>
        <br/>
        <br/>

        <span>
            <img src="/img/footer/icp.png" alt="ICP" style="width:auto; height:18px; margin-bottom:-2px"><a href="https://beian.miit.gov.cn/" target="_blank"> 鄂ICP备19003281号-6</a> 丨
            <img src="/img/footer/moeicp.png" alt="MOE ICP" style="width:auto; height:16px; margin-bottom:-2px"><a href="https://icp.gov.moe/" target="_blank"> 萌ICP备20202022号</a> 丨
            <img src="/img/footer/webify.png" alt="腾讯云开发 Webify" style="width:auto; height:20px; margin-bottom:-5px"><a href="https://webify.cloudbase.net/" target="_blank"> 腾讯云开发 Webify</a> 丨
            <a href="https://www.foreverblog.cn/" target="_blank"><img src="/img/footer/foreverblog.png" alt="十年之约" style="width:auto; height:14px; margin-bottom:-1px"></a>
        </span>
        <br/>
        <br/>

        <span style="text-align: center; float: center;">
            Copyright © 2018-<span id="displayDateTime"></span> <a href="https://www.itbob.cn/" target="_blank">ITBOB.CN</a> 丨
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> 丨
            <span id="sitetime">正在载入网站运行时间...</span>
            <script>
                function siteTime(){
                    window.setTimeout("siteTime()", 1000);
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth()+1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    /* 
                    Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
                    year - 作为date对象的年份，为4位年份值
                    month - 0-11之间的整数，做为date对象的月份
                    day - 1-31之间的整数，做为date对象的天数
                    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
                    minutes - 0-59之间的整数，做为date对象的分钟数
                    seconds - 0-59之间的整数，做为date对象的秒数
                    microseconds - 0-999之间的整数，做为date对象的毫秒数
                    */
                    var t1 = Date.UTC(2018,08,10,17,38,00); //北京时间2018-8-10 17:38:00
                    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
                    var diff = t2-t1;
                    var diffYears = Math.floor(diff/years);
                    var diffDays = Math.floor((diff/days)-diffYears*365);
                    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
                    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
                    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
                    document.getElementById("sitetime").innerHTML="本站已运行了 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分 "+diffSeconds+" 秒";
                }
                siteTime();
            </script>

            <script>
                var copyrightNow = new Date().getFullYear();
                document.getElementById("displayDateTime").innerHTML = copyrightNow;
            </script>
        </span>
    </div>
</div>

            </div>
        </div>
    </body>
</html>